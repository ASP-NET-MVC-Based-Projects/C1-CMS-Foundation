bespin.tiki.register("::text_editor",{name:"text_editor",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"}});
bespin.tiki.module("text_editor:commands/editing",function(A,u){var w=A("settings").settings,t=A("environment").env,p=A("rangeutils:utils/range");u.backspace=function(){t.view.performBackspaceOrDelete(true)};u.deleteCommand=function(){t.view.performBackspaceOrDelete(false)};u.deleteLines=function(){if(!t.model.readOnly)if(t.model.lines.length!=1){var e=t.view;e.groupChanges(function(){var f=e.getSelectedRange(),o=t.model.lines,h=o.length-1,i;i=f.start.row==h?{col:o[h-1].length,row:h-1}:{col:0,row:f.start.row};
e.replaceCharacters({start:i,end:f.end.row==h?{col:o[h].length,row:h}:{col:0,row:f.end.row+1}},"");e.moveCursorTo(i)})}};var k=function(e,f){var o=f.getSelectedRange().start;e=/^\s*/.exec(e.lines[o.row].substring(0,o.col));f.insertText("\n"+e)};u.insertText=function(e){t.view.insertText(e.text)};u.newline=function(){k(t.model,t.view)};u.joinLines=function(){var e=t.model;if(!e.readOnly){var f=t.view,o=f.getSelectedRange(),h=e.lines,i=o.end.row;h.length!=i&&f.groupChanges(function(){f.replaceCharacters({start:{col:h[i].length,
row:i},end:{col:/^\s*/.exec(h[i+1])[0].length,row:i+1}},"")})}};u.openLine=function(){if(!t.model.readOnly){var e=t.model,f=t.view,o=f.getSelectedRange().end.row;f.moveCursorTo({row:o,col:e.lines[o].length});k(e,f)}};u.tab=function(){var e=t.view;e.groupChanges(function(){var f=w.get("tabstop"),o=e.getSelectedRange(),h="";if(p.isZeroLength(o)){var i=t.model.lines[o.start.row].substring(o.start.col).match(/^\s*/)[0].length;f=f-(o.start.col+i)%f;for(var j=0;j<f;j++)h+=" ";e.replaceCharacters({start:o.start,
end:o.start},h);e.moveCursorTo({col:o.start.col+f+i,row:o.end.row})}else{for(j=0;j<f;j++)h+=" ";for(j=o.start.row-1;j++<o.end.row;){i=j==o.start.row?o.start.col:0;e.replaceCharacters({start:{row:j,col:i},end:{row:j,col:i}},h)}e.setSelection({start:o.start,end:{col:o.end.col+f,row:o.end.row}})}}.bind(this))};u.untab=function(){var e=t.view;e.groupChanges(function(){var f=w.get("tabstop"),o=e.getSelectedRange(),h=t.model.lines,i=0;if(p.isZeroLength(o)){i=Math.min(h[o.start.row].substring(0,o.start.col).match(/\s*$/)[0].length,
(o.start.col-f)%f||f);e.replaceCharacters({start:{col:o.start.col-i,row:o.start.row},end:o.start},"");e.moveCursorTo({row:o.start.row,col:o.end.col-i})}else{for(var j,q=o.start.row-1;q++<o.end.row;){j=q==o.start.row?o.start.col:0;i=Math.min(h[q].substring(j).match(/^\s*/)[0].length,f);e.replaceCharacters({start:{row:q,col:j},end:{row:q,col:j+i}},"")}e.setSelection({start:{row:o.start.row,col:o.start.col},end:{row:o.end.row,col:o.end.col-i}})}}.bind(this))}});
bespin.tiki.module("text_editor:commands/editor",function(A,u){A("bespin:plugins");var w=A("settings").settings,t=A("environment").env;u.findNextCommand=function(){var k=t.view,e=k.editor.searchController,f=k.getSelectedRange();if(e=e.findNext(f.end,true)){k.setSelection(e,true);k.focus()}};u.findPrevCommand=function(){var k=t.view,e=k.editor.searchController,f=k.getSelectedRange();if(e=e.findPrevious(f.start,true)){k.setSelection(e,true);k.focus()}};var p=function(k){var e=t.view,f=e.getSelectedCharacters();
k=k(f);e=e.getSelectedRange();t.model.replaceCharacters(e,k)};u.replaceCommand=function(k){p(function(e){return e.replace(k.search+"/g",k.replace)})};u.entabCommand=function(){tabstop=w.get("tabstop");p(function(k){return k.replace(" {"+tabstop+"}","\t")})};u.detabCommand=function(){tabstop=w.get("tabstop");p(function(k){return k.replace("\t",(new Array(tabstop+1)).join(" "))})};u.trimCommand=function(k){p(function(e){e=e.split("\n");e=e.map(function(f){if(k.side==="left"||k.side==="both")f=f.replace(/^\s+/,
"");if(k.side==="right"||k.side==="both")f=f.replace(/\s+$/,"");return f});return e.join("\n")})};u.ucCommand=function(){p(function(k){return k.toUpperCase()})};u.lcCommand=function(){p(function(k){return k.toLowerCase()})}});
bespin.tiki.module("text_editor:commands/movement",function(A,u){A("rangeutils:utils/range");var w=A("environment").env;u.moveDown=function(){w.view.moveDown()};u.moveLeft=function(){w.view.moveLeft()};u.moveRight=function(){w.view.moveRight()};u.moveUp=function(){w.view.moveUp()};u.selectDown=function(){w.view.selectDown()};u.selectLeft=function(){w.view.selectLeft()};u.selectRight=function(){w.view.selectRight()};u.selectUp=function(){w.view.selectUp()};var t=function(o,h){var i=w.view,j=w.model.lines,
q=i.getSelectedRange(true);h=h?q.end.row:j.length-1;i.moveCursorTo({row:h,col:j[h].length},o)};u.moveLineEnd=function(){t(false,true)};u.selectLineEnd=function(){t(true,true)};u.moveDocEnd=function(){t(false,false)};u.selectDocEnd=function(){t(true,false)};var p=function(o,h){var i=w.view,j=i.getSelectedRange(true);i.moveCursorTo({row:h?j.end.row:0,col:0},o)};u.moveLineStart=function(){p(false,true)};u.selectLineStart=function(){p(true,true)};u.moveDocStart=function(){p(false,false)};u.selectDocStart=
function(){p(true,false)};var k=function(o,h,i,j,q){var r=0,B=false;if(j<0){i--;if(q)r=1}for(;i<h.length&&i>-1;){if(q=o.isDelimiter(h[i]))r++;else B=true;if((q||r>1)&&B)break;i+=j}j<0&&i++;return i},e=function(o){var h=w.view,i=w.model.lines,j=h.getSelectedRange(true).end,q=j.row;j=j.col;var r=i[q],B=false;if(j>=r.length){q++;B=true;if(q<i.length){j=0;r=i[q]}else r=""}j=k(h,r,j,1,B);h.moveCursorTo({row:q,col:j},o)},f=function(o){var h=w.view,i=w.model.lines,j=h.getSelectedRange(true).end,q=j.row;
j=j.col;var r=i[q],B=false;if(j>r.length)j=r.length;else if(j==0){q--;B=true;if(q>-1){r=i[q];j=r.length}else r=""}j=k(h,r,j,-1,B);h.moveCursorTo({row:q,col:j},o)};u.moveNextWord=function(){e(false)};u.selectNextWord=function(){e(true)};u.movePreviousWord=function(){f(false)};u.selectPreviousWord=function(){f(true)};u.selectAll=function(){w.view.selectAll()}});
bespin.tiki.module("text_editor:commands/scrolling",function(A,u){var w=A("environment").env;u.scrollDocStart=function(){w.view.scrollToPosition({col:0,row:0})};u.scrollDocEnd=function(){w.view.scrollToPosition(w.model.range.end)};u.scrollPageDown=function(){w.view.scrollPageDown()};u.scrollPageUp=function(){w.view.scrollPageUp()}});
bespin.tiki.module("text_editor:controllers/layoutmanager",function(A,u){var w=A("bespin:util/util"),t=A("events").Event;A("rangeutils:utils/range");var p=A("syntax_manager").SyntaxManager,k=A("models/textstorage").TextStorage,e=A("bespin:plugins").catalog,f=A("settings").settings,o=A("bespin:util/scratchcanvas"),h={};A=function(){var i=f.get("fontsize"),j=f.get("fontface");j=i+"px "+j;for(var q=o.get(),r="",B=0;B<100;B++)r+="M";j=q.measureStringWidth(j,r)/100;h.characterWidth=j;h.lineHeight=Math.floor(i*
1.6);h.lineAscent=Math.floor(i*1.3)};A();e.registerExtension("settingChange",{match:"font[size|face]",pointer:A});u.LayoutManager=function(i){this.changedTextAtRow=new t;this.invalidatedRects=new t;this.fontDimension=h;if(i.textStorage){i._textStorage=i.textStorage;delete i.textStorage}else this._textStorage=new k;w.mixin(this,i);this._textStorage.changed.add(this.textStorageChanged.bind(this));this.textLines=[{characters:"",colors:[{start:0,end:0,color:"plain"}]}];this.syntaxManager=i=new p(this);
i.attrsChanged.add(this._attrsChanged.bind(this));this._size={width:0,height:0};this.sizeChanged=new t;this._height=0;this._recomputeEntireLayout()};u.LayoutManager.prototype={_maximumWidth:0,_textStorage:null,_size:null,sizeChanged:null,_theme:{},margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:e,syntaxManager:null,textLines:null,_attrsChanged:function(i,j){this.updateTextRows(i,j);this.invalidatedRects(this,this.rectsForRange({start:{row:i,col:0},end:{row:j,col:0}}))},_computeInvalidRects:function(i,
j){var q=this.characterRectForPosition(i.start),r={x:q.x,y:q.y,width:Number.MAX_VALUE,height:q.height};return i.end.row===j.end.row?[r]:[r,{x:0,y:q.y+h.lineHeight,width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.textLines.length-1,col:this._maximumWidth}},_recalculateMaximumWidth:function(){var i=0;this.textLines.forEach(function(j){j=j.characters.length;if(i<j)i=j});this._maximumWidth=i;this.size={width:i,height:this.textLines.length}},_recomputeEntireLayout:function(){var i=
this._textStorage.range;this._recomputeLayoutForRanges(i,i)},_recomputeLayoutForRanges:function(i,j){for(var q=i.start.row,r=i.end.row,B=j.end.row,D=B-q+1,d=this._textStorage.lines,K=this._theme.plain,L=[],l=0;l<D;l++)L[l]={characters:d[q+l],colors:[{start:0,end:null,color:K}]};this.textLines=w.replace(this.textLines,q,r-q+1,L);this._recalculateMaximumWidth();r=this.textLines.length;D=this.syntaxManager;if(this._height!==r)this._height=r;D.invalidateRow(q);this.updateTextRows(q,B+1);this.changedTextAtRow(this,
q);this.invalidatedRects(this,this._computeInvalidRects(i,j))},boundingRect:function(){return this.rectsForRange({start:{row:0,col:0},end:{row:this.textLines.length-1,col:this._maximumWidth}})[0]},characterAtPoint:function(i){var j=this.margin,q=i.x-j.left,r=h.characterWidth,B=this._textStorage;i=B.clampPosition({row:Math.floor((i.y-j.top)/h.lineHeight),col:Math.floor(q/r)});B=B.lines[i.row].length;i.partialFraction=q<0||i.col===B?0:q%r/r;return i},characterRangeForBoundingRect:function(i){var j=
h.lineHeight,q=h.characterWidth,r=this.margin,B=i.x-r.left;r=i.y-r.top;return{start:{row:Math.max(Math.floor(r/j),0),col:Math.max(Math.floor(B/q),0)},end:{row:Math.floor((r+i.height-1)/j),col:Math.floor((B+i.width-1)/q)+1}}},characterRectForPosition:function(i){return this.rectsForRange({start:i,end:{row:i.row,col:i.col+1}})[0]},lineRectForRow:function(i){return this.rectsForRange({start:{row:i,col:0},end:{row:i,col:this._maximumWidth}})[0]},rectForPosition:function(i){var j=this.margin,q=h.characterWidth,
r=h.lineHeight;return{x:j.left+q*i.col,y:j.top+r*i.row,width:q,height:r}},rectsForRange:function(i){var j=h.characterWidth,q=h.lineHeight,r=this._maximumWidth,B=this.margin,D=i.start,d=i.end;i=D.row;var K=D.col;D=d.row;d=d.col;if(i===D)return[{x:B.left+j*K,y:B.top+q*i,width:j*(d-K),height:q}];var L=[],l;if(K===0)l=i;else{l=i+1;L.push({x:B.left+j*K,y:B.top+q*i,width:99999,height:q})}if(d===0)r=D-1;else if(d===r)r=D;else{r=D-1;L.push({x:B.left,y:B.top+q*D,width:j*d,height:q})}L.push({x:B.left,y:B.top+
q*l,width:99999,height:q*(r-l+1)});return L},textStorageChanged:function(i,j){this._recomputeLayoutForRanges(i,j)},updateTextRows:function(i,j){var q=this.textLines;j=this.syntaxManager.getAttrsForRows(i,j);for(var r=0;r<j.length;r++)q[i+r].colors=j[r]}};Object.defineProperties(u.LayoutManager.prototype,{size:{set:function(i){if(i.width!==this._size.width||i.height!==this._size.height){this.sizeChanged(i);this._size=i}},get:function(){return this._size}},textStorage:{get:function(){return this._textStorage}}})});
bespin.tiki.module("text_editor:controllers/search",function(A,u){var w=A("bespin:util/util");A("rangeutils:utils/range");A("bespin:console");u.EditorSearchController=function(t){this.editor=t};u.EditorSearchController.prototype={editor:null,_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(t){var p=[],k=this.searchRegExp,e;for(k.lastIndex=0;;){e=k.exec(t);if(e===null)break;p.push(e);k.lastIndex=e.index+e[0].length}return p},_makeRange:function(t,p){return{start:{row:p,
col:t.index},end:{row:p,col:t.index+t[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,setSearchText:function(t,p){this.searchRegExp=p?new RegExp(t):new RegExp(t.replace(this._escapeString,"\\$1"),"gi");this.isRegExp=p;this.searchText=t},findNext:function(t,p){var k=this.searchRegExp;if(w.none(k))return null;t=t||this.editor.textView.getSelectedRange().end;var e=this.editor.layoutManager.textStorage.lines,f;k.lastIndex=t.col;var o;for(o=t.row;o<e.length;o++){f=k.exec(e[o]);if(!w.none(f))return this._makeRange(f,
o)}if(!p)return null;for(o=0;o<=t.row;o++){f=k.exec(e[o]);if(!w.none(f))return this._makeRange(f,o)}return null},findPrevious:function(t,p){if(w.none(this.searchRegExp))return null;t=t||this.editor.textView.getSelectedRange().start;var k=this.editor.buffer.layoutManager.textStorage.lines,e;e=this._findMatchesInString(k[t.row].substring(0,t.col));if(e.length!==0)return this._makeRange(e[e.length-1],t.row);var f;for(f=t.row-1;f!==-1;f--){e=this._findMatchesInString(k[f]);if(e.length!==0)return this._makeRange(e[e.length-
1],f)}if(!p)return null;for(f=k.length-1;f>=t.row;f--){e=this._findMatchesInString(k[f]);if(e.length!==0)return this._makeRange(e[e.length-1],f)}return null}}});
bespin.tiki.module("text_editor:controllers/undo",function(A,u){var w=A("bespin:console").console,t=A("environment").env;u.EditorUndoController=function(p){this.editor=p;p=this.textView=p.textView;p.beganChangeGroup.add(function(k,e){this._beginTransaction();this._record.selectionBefore=e}.bind(this));p.endedChangeGroup.add(function(k,e){this._record.selectionAfter=e;this._endTransaction()}.bind(this));p.replacedCharacters.add(function(k,e,f){if(!this._inTransaction)throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction");
this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:e,newCharacters:f,newRange:this.editor.layoutManager.textStorage.resultingRangeForReplacement(e,f.split("\n"))});this._deletedCharacters=null}.bind(this));p.willReplaceRange.add(function(k,e){if(!this._inTransaction)throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction");this._deletedCharacters=this.editor.layoutManager.textStorage.getCharacters(e)}.bind(this))};u.EditorUndoController.prototype=
{_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){w.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place");}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction)throw new Error("UndoController._endTransaction() called without a transaction in place");this.editor.buffer.undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=
false},_tryApplyingPatches:function(p){var k=this.editor.layoutManager.textStorage;p.forEach(function(e){k.replaceCharacters(e.oldRange,e.newCharacters)});return true},_undoOrRedo:function(p,k){if(this._inTransaction)throw new Error("UndoController._undoOrRedo() called while in a transaction");if(!this._tryApplyingPatches(p))return false;this.textView.setSelection(k,true);return true},redo:function(p){var k=p.patches.concat();k.reverse();return this._undoOrRedo(k,p.selectionAfter)},undo:function(p){return this._undoOrRedo(p.patches.map(function(k){return{oldCharacters:k.newCharacters,
oldRange:k.newRange,newCharacters:k.oldCharacters,newRange:k.oldRange}}),p.selectionBefore)}};u.undoManagerCommand=function(p,k){t.editor.buffer.undoManager[k.commandExt.name]()}});
bespin.tiki.module("text_editor:models/buffer",function(A,u){var w=A("environment").env,t=A("bespin:util/util"),p=A("bespin:promise").Promise,k=A("models/textstorage").TextStorage,e=A("controllers/layoutmanager").LayoutManager,f=A("undomanager").UndoManager;u.Buffer=function(o,h){this._file=o;this._model=new k(h);this._layoutManager=new e({textStorage:this._model});this.undoManager=new f;if(o)this.reload().then(function(){this._updateSyntaxManagerInitialContext()}.bind(this));else{this.loadPromise=
new p;this.loadPromise.resolve()}h=w.session?w.session.history:null;var i,j,q;if(h&&o&&(i=h.getHistoryForPath(o.path))){j=i.selection;q=i.scroll}this._selectedRange=j||{start:{row:0,col:0},end:{row:0,col:0}};this._scrollOffset=q||{x:0,y:0}};u.Buffer.prototype={undoManager:null,loadPromise:null,_scrollOffset:null,_selectedRange:null,_selectedRangeEndVirtual:null,_layoutManager:null,_file:null,_model:null,save:function(){return this._file.saveContents(this._model.value)},saveAs:function(o){var h=new p;
o.saveContents(this._model.value).then(function(){this._file=o;this._updateSyntaxManagerInitialContext();h.resolve()}.bind(this),function(i){h.reject(i)});return h},reload:function(){var o=this,h;return this.loadPromise=h=this._file.loadContents().then(function(i){o._model.value=i})},_updateSyntaxManagerInitialContext:function(){var o=this._file.extension();this._layoutManager.syntaxManager.setSyntaxFromFileExt(o===null?"":o)},untitled:function(){return t.none(this._file)}};Object.defineProperties(u.Buffer.prototype,
{layoutManager:{get:function(){return this._layoutManager}},syntaxManager:{get:function(){}},file:{get:function(){return this._file}},model:{get:function(){return this._model}}})});
bespin.tiki.module("text_editor:models/textstorage",function(A,u){var w=A("events").Event,t=A("bespin:util/util");A=function(p){this._lines=p!==null&&p!==undefined?p.split("\n"):[""];this.changed=new w;return this};A.prototype={_lines:null,readOnly:false,clampPosition:function(p){var k=this._lines,e=p.row;if(e<0)return{row:0,col:0};else if(e>=k.length)return this.range.end;p=Math.max(0,Math.min(p.col,k[e].length));return{row:e,col:p}},clampRange:function(p){var k=this.clampPosition(p.start);p=this.clampPosition(p.end);
return{start:k,end:p}},deleteCharacters:function(p){this.replaceCharacters(p,"")},displacePosition:function(p,k){var e=k>0,f=this._lines,o=f.length;for(k=Math.abs(k);k!==0;k--)if(e){var h=f[p.row].length;if(p.row===o-1&&p.col===h)return p;p=p.col===h?{row:p.row+1,col:0}:{row:p.row,col:p.col+1}}else{if(p.row===0&&p.col==0)return p;if(p.col===0){f=this._lines;p={row:p.row-1,col:f[p.row-1].length}}else p={row:p.row,col:p.col-1}}return p},getCharacters:function(p){var k=this._lines,e=p.start,f=p.end,
o=e.row;p=f.row;var h=e.col;e=f.col;if(o===p)return k[o].substring(h,e);f=k[o].substring(h);o=k.slice(o+1,p);k=k[p].substring(0,e);return[f].concat(o,k).join("\n")},getLines:function(){return this._lines},getRange:function(){var p=this._lines,k=p.length-1;return{start:{row:0,col:0},end:{row:k,col:p[k].length}}},getValue:function(){return this._lines.join("\n")},insertCharacters:function(p,k){this.replaceCharacters({start:p,end:p},k)},replaceCharacters:function(p,k){if(this.readOnly)throw new Error("Attempt to modify a read-only text storage object");
var e=k.split("\n"),f=e.length,o=this.resultingRangeForReplacement(p,e),h=p.start,i=p.end,j=h.row,q=i.row,r=this._lines;e[0]=r[j].substring(0,h.col)+e[0];e[f-1]+=r[q].substring(i.col);this._lines=t.replace(r,j,q-j+1,e);this.changed(p,o,k)},resultingRangeForReplacement:function(p,k){var e=k.length;p=p.start;return{start:p,end:{row:p.row+e-1,col:(e===1?p.col:0)+k[e-1].length}}},setLines:function(p){this.setValue(p.join("\n"))},setValue:function(p){this.replaceCharacters(this.range,p)}};u.TextStorage=
A;Object.defineProperties(u.TextStorage.prototype,{lines:{get:function(){return this.getLines()},set:function(p){return this.setLines(p)}},range:{get:function(){return this.getRange()}},value:{get:function(){return this.getValue()},set:function(p){this.setValue(p)}}})});
bespin.tiki.module("text_editor:utils/rect",function(A,u){u._distanceFromBounds=function(w,t,p){if(w<t)return w-t;if(w>=p)return w-p;return 0};u.merge=function(w){var t;do{t=false;for(var p=[],k=0;k<w.length;k++){var e=w[k];p.push(e);for(var f=k+1;f<w.length;f++){var o=w[f];if(u.rectsSideBySide(e,o)||u.rectsIntersect(e,o)){w.splice(f,1);p[p.length-1]=u.unionRects(e,o);t=true;break}}}w=p}while(t);return w};u.offsetFromRect=function(w,t){return{x:u._distanceFromBounds(t.x,w.x,u.maxX(w)),y:u._distanceFromBounds(t.y,
w.y,u.maxY(w))}};u.rectsIntersect=function(w,t){w=u.intersectRects(w,t);return w.width!==0&&w.height!==0};u.rectsSideBySide=function(w,t){if(w.x==t.x&&w.width==t.width)return w.y<t.y?w.y+w.height==t.y:t.y+t.height==w.y;else if(w.y==t.y&&w.height==t.height)return w.x<t.x?w.x+w.width==t.x:t.x+t.width==w.x;return false};u.intersectRects=function(w,t){w={x:Math.max(u.minX(w),u.minX(t)),y:Math.max(u.minY(w),u.minY(t)),width:Math.min(u.maxX(w),u.maxX(t)),height:Math.min(u.maxY(w),u.maxY(t))};w.width=Math.max(0,
w.width-w.x);w.height=Math.max(0,w.height-w.y);return w};u.minX=function(w){return w.x||0};u.maxX=function(w){return(w.x||0)+(w.width||0)};u.minY=function(w){return w.y||0};u.maxY=function(w){return(w.y||0)+(w.height||0)};u.pointInRect=function(w,t){return w.x>=u.minX(t)&&w.y>=u.minY(t)&&w.x<=u.maxX(t)&&w.y<=u.maxY(t)};u.unionRects=function(w,t){w={x:Math.min(u.minX(w),u.minX(t)),y:Math.min(u.minY(w),u.minY(t)),width:Math.max(u.maxX(w),u.maxX(t)),height:Math.max(u.maxY(w),u.maxY(t))};w.width=Math.max(0,
w.width-w.x);w.height=Math.max(0,w.height-w.y);return w};u.rectsEqual=function(w,t,p){if(!w||!t)return w==t;if(!p&&p!==0)p=0.1;if(w.y!=t.y&&Math.abs(w.y-t.y)>p)return false;if(w.x!=t.x&&Math.abs(w.x-t.x)>p)return false;if(w.width!=t.width&&Math.abs(w.width-t.width)>p)return false;if(w.height!=t.height&&Math.abs(w.height-t.height)>p)return false;return true}});
bespin.tiki.module("text_editor:views/canvas",function(A,u){var w=A("bespin:util/util"),t=A("utils/rect"),p=A("events").Event;u.CanvasView=function(k,e,f){if(k){this._preventDownsize=e||false;this._clearOnFullInvalid=f||false;this._clippingFrame=this._frame={x:0,y:0,width:0,height:0};this._invalidRects=[];e=document.createElement("canvas");e.setAttribute("style","position: absolute");e.innerHTML="canvas tag not supported by your browser";k.appendChild(e);this.domNode=e;this.clippingChanged=new p;
this.clippingChanged.add(this.clippingFrameChanged.bind(this))}};u.CanvasView.prototype={domNode:null,clippingChanged:null,_canvasContext:null,_canvasId:null,_invalidRects:null,_lastRedrawTime:null,_redrawTimer:null,_clippingFrame:null,_preventDownsize:false,_clearOnFullInvalid:false,_frame:null,_getContext:function(){if(this._canvasContext===null)this._canvasContext=this.domNode.getContext("2d");return this._canvasContext},computeWithClippingFrame:function(k,e){var f=this.clippingFrame;return{x:k+
f.x,y:e+f.y}},minimumRedrawDelay:1E3/30,clippingFrameChanged:function(){this.invalidate()},drawRect:function(){},render:function(){if(!(this._renderTimer||this._redrawTimer))this._renderTimer=setTimeout(this._tryRedraw.bind(this),0)},invalidate:function(){this._invalidRects="all";this.render()},invalidateRect:function(k){var e=this._invalidRects;if(e!=="all"){e.push(k);this.render()}},_tryRedraw:function(){this._renderTimer=null;var k=(new Date).getTime(),e=this._lastRedrawTime,f=this.minimumRedrawDelay;
if(e===null||k-e>=f)this._redraw();else if(this._redrawTimer===null)this._redrawTimer=window.setTimeout(this._redraw.bind(this),f)},_redraw:function(){var k=this.clippingFrame;k={x:Math.round(k.x),y:Math.round(k.y),width:k.width,height:k.height};var e=this._getContext();e.save();e.translate(-k.x,-k.y);var f=this._invalidRects;if(f==="all"){this._clearOnFullInvalid&&e.clearRect(0,0,this.domNode.width,this.domNode.height);this.drawRect(k,e)}else t.merge(f).forEach(function(o){o=t.intersectRects(o,k);
if(o.width!==0&&o.height!==0){e.save();var h=o.x,i=o.y,j=o.width,q=o.height;e.beginPath();e.moveTo(h,i);e.lineTo(h+j,i);e.lineTo(h+j,i+q);e.lineTo(h,i+q);e.closePath();e.clip();this.drawRect(o,e);e.restore()}},this);e.restore();this._invalidRects=[];this._redrawTimer=null;this._lastRedrawTime=(new Date).getTime()}};Object.defineProperties(u.CanvasView.prototype,{clippingFrame:{get:function(){return this._clippingFrame},set:function(k){k=w.mixin(w.clone(this._clippingFrame),k);if(this._clippingFrame===
null||!t.rectsEqual(k,this._clippingFrame)){this._clippingFrame=k;this.clippingChanged()}}},frame:{get:function(){return this._frame},set:function(k){var e=this.domNode,f=e.style,o=this._preventDownsize,h=e.width,i=e.height;f=e.style;f.left=k.x+"px";f.top=k.y+"px";var j,q;if(k.width!==h)if(k.width<h)o||(j=true);else j=true;if(k.height!==i)if(k.height<i)o||(q=true);else q=true;if(j)this.domNode.width=k.width;if(q)this.domNode.height=k.height;this._frame=k;this.clippingFrame={width:k.width,height:k.height}}}})});
bespin.tiki.module("text_editor:views/editor",function(A,u){function w(l){var v=D.plugins.text_editor.provides,C=v.length,J={};if(l){l=l.themestyles;if(l.currentThemeVariables&&l.currentThemeVariables.text_editor)J=l.currentThemeVariables.text_editor}for(;C--;)if(v[C].ep==="themevariable"){l=k.mixin(k.clone(v[C].defaultValue),J[v[C].name]);switch(v[C].name){case "gutter":case "editor":case "scroller":case "highlighterFG":case "highlighterBG":L[v[C].name]=l}}}var t=A("rangeutils:utils/range"),p=A("views/scroller"),
k=A("bespin:util/util"),e=A("models/buffer").Buffer,f=A("completion:controller").CompletionController,o=A("controllers/search").EditorSearchController,h=A("controllers/undo").EditorUndoController,i=A("events").Event,j=A("views/gutter").GutterView;A("controllers/layoutmanager");var q=p.ScrollerCanvasView,r=A("views/text").TextView,B=A("underscore")._,D=A("bespin:plugins").catalog,d=A("keyboard:keyboard").keyboardManager,K=A("settings").settings,L={};w();D.registerExtension("themeChange",{pointer:w});
u.EditorView=function(l){this.elementAppended=new i;var v=this.element=this.container=document.createElement("div");v.style.overflow="visible";v.style.position="relative";this.scrollOffsetChanged=new i;this.willChangeBuffer=new i;this.selectionChanged=new i;this.textChanged=new i;this.gutterView=new j(v,this);this.textView=new r(v,this);var C=new q(this,p.LAYOUT_VERTICAL),J=new q(this,p.LAYOUT_HORIZONTAL);this.verticalScroller=C;this.horizontalScroller=J;this.completionController=new f(this);this.editorUndoController=
new h(this);this.searchController=new o(this);this._textViewSize=this._oldSize={width:0,height:0};this._themeData=L;this.buffer=new e(null,l);this.elementAppended.add(function(){var P=K.get("fontsize"),U=K.get("fontface");this._font=P+"px "+U;D.registerExtension("themeChange",{pointer:this._themeVariableChange.bind(this)});D.registerExtension("settingChange",{match:"font[size|face]",pointer:this._fontSettingChanged.bind(this)});D.registerExtension("dimensionsChanged",{pointer:this.dimensionsChanged.bind(this)});
this._dontRecomputeLayout=false;this._recomputeLayout();v.addEventListener(k.isMozilla?"DOMMouseScroll":"mousewheel",this._onMouseWheel.bind(this),false);C.valueChanged.add(function(X){this.scrollOffset={y:X}}.bind(this));J.valueChanged.add(function(X){this.scrollOffset={x:X}}.bind(this));this.scrollOffsetChanged.add(function(X){this._updateScrollOffsetChanged(X)}.bind(this))}.bind(this))};u.EditorView.prototype={elementAppended:null,textChanged:null,selectionChanged:null,scrollOffsetChanged:null,
willChangeBuffer:null,_textViewSize:null,_textLinesCount:0,_gutterViewWidth:0,_oldSize:null,_buffer:null,_dontRecomputeLayout:true,_themeData:null,_layoutManagerSizeChanged:function(l){var v=this.layoutManager.fontDimension;this._textViewSize={width:l.width*v.characterWidth,height:l.height*v.lineHeight};if(this._textLinesCount!==l.height){this.gutterView.computeWidth()!==this._gutterViewWidth?this._recomputeLayout(true):this.gutterView.invalidate();this._textLinesLength=l.height}this._updateScrollers();
this.scrollOffset={}},_updateScrollers:function(){if(!this._dontRecomputeLayout){var l=this.textViewPaddingFrame,v=this._textViewSize.width,C=this._textViewSize.height,J=this.scrollOffset,P=this.verticalScroller,U=this.horizontalScroller;if(C<l.height)P.isVisible=false;else{P.isVisible=true;P.proportion=l.height/C;P.maximum=C-l.height;P.value=J.y}if(v<l.width)U.isVisible=false;else{U.isVisible=true;U.proportion=l.width/v;U.maximum=v-l.width;U.value=J.x}}},_onMouseWheel:function(l){var v=0;if(l.wheelDelta)v=
-l.wheelDelta;else if(l.detail)v=l.detail*40;var C=true;if(l.axis){if(l.axis==l.HORIZONTAL_AXIS)C=false}else if(l.wheelDeltaY||l.wheelDeltaX){if(l.wheelDeltaX==l.wheelDelta)C=false}else if(l.shiftKey)C=false;C?this.scrollBy(0,v):this.scrollBy(v*5,0);k.stopEvent(l)},scrollTo:function(l){this.scrollOffset=l},scrollBy:function(l,v){this.scrollOffset={x:this.scrollOffset.x+l,y:this.scrollOffset.y+v}},_recomputeLayout:function(l){if(!this._dontRecomputeLayout){var v=this.container.offsetWidth,C=this.container.offsetHeight;
if(!(!l&&v==this._oldSize.width&&C==this._oldSize.height)){this._oldSize={width:v,height:C};this._gutterViewWidth=l=this.gutterView.computeWidth();this.gutterView.frame={x:0,y:0,width:l,height:C};this.textView.frame={x:l,y:0,width:v-l,height:C};var J=this._themeData.scroller.padding,P=this._themeData.scroller.thickness;this.horizontalScroller.frame={x:l+J,y:C-(P+J),width:v-(l+2*J+P),height:P};this.verticalScroller.frame={x:v-(J+P),y:J,width:P,height:C-(2*J+P)};this.scrollOffset={};this._updateScrollers();
this.gutterView.invalidate();this.textView.invalidate();this.verticalScroller.invalidate();this.horizontalScroller.invalidate()}}},dimensionsChanged:function(){this._recomputeLayout()},_font:null,_fontSettingChanged:function(){var l=K.get("fontsize"),v=K.get("fontface");this._font=l+"px "+v;this.layoutManager._recalculateMaximumWidth();this._layoutManagerSizeChanged(this.layoutManager.size);this.textView.invalidate()},_themeVariableChange:function(){this._recomputeLayout(true)},_updateScrollOffsetChanged:function(l){this.verticalScroller.value=
l.y;this.horizontalScroller.value=l.x;this.textView.clippingFrame={x:l.x,y:l.y};this.gutterView.clippingFrame={y:l.y};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate()},processKeyEvent:function(l,v,C){C=B(C).clone();C.completing=this.completionController.isCompleting();return d.processKeyEvent(l,v,C)},convertTextViewPoint:function(l){var v=this.scrollOffset;return{x:l.x-v.x+this._gutterViewWidth,y:l.y-v.y}},replace:function(l,v,C){if(!t.isRange(l))throw new Error('replace(): expected range but found "'+
l+"'");if(!k.isString(v))throw new Error('replace(): expected text string but found "'+text+'"');var J=t.normalizeRange(l),P=this.textView,U=P.getSelectedRange(false);return P.groupChanges(function(){P.replaceCharacters(J,v);if(C)P.setSelection(U);else{var X=v.split("\n");X=X.length>1?{row:l.start.row+X.length-1,col:X[X.length-1].length}:t.addPositions(l.start,{row:0,col:v.length});P.moveCursorTo(X)}})},getText:function(l){if(!t.isRange(l))throw new Error('getText(): expected range but found "'+l+
'"');return this.layoutManager.textStorage.getCharacters(t.normalizeRange(l))},setLineNumber:function(l){if(!k.isNumber(l))throw new Error("setLineNumber(): lineNumber must be a number");this.textView.moveCursorTo({row:l-1,col:0})},setCursor:function(l){if(!t.isPosition(l))throw new Error('setCursor(): expected position but found "'+l+'"');this.textView.moveCursorTo(l)},changeGroup:function(l){return this.textView.groupChanges(function(){l(this)}.bind(this))},addTags:function(l){this.completionController.tags.add(l)}};
Object.defineProperties(u.EditorView.prototype,{themeData:{get:function(){return this._themeData},set:function(){throw new Error("themeData can't be changed directly. Use themeManager.");}},font:{get:function(){return this._font},set:function(){throw new Error("font can't be changed directly. Use settings fontsize and fontface.");}},buffer:{set:function(l){if(l!==this._buffer){if(!l.loadPromise.isResolved())throw new Error("buffer.set(): the new buffer must first be loaded!");if(this._buffer!==null){this.layoutManager.sizeChanged.remove(this);
this.layoutManager.textStorage.changed.remove(this);this.textView.selectionChanged.remove(this)}this.willChangeBuffer(l);D.publish(this,"editorChange","buffer",l);this.layoutManager=l.layoutManager;this._buffer=l;var v=this.layoutManager,C=this.textView;v.sizeChanged.add(this,this._layoutManagerSizeChanged.bind(this));v.textStorage.changed.add(this,this.textChanged.bind(this));C.selectionChanged.add(this,this.selectionChanged.bind(this));this.textView.setSelection(l._selectedRange,false);this.scrollOffsetChanged(l._scrollOffset);
this.layoutManager.sizeChanged(this.layoutManager.size);this._recomputeLayout()}},get:function(){return this._buffer}},frame:{get:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},textViewPaddingFrame:{get:function(){var l=k.clone(this.textView.frame),v=this.textView.padding;l.width-=v.left+v.right;l.height-=v.top+v.bottom;return l}},scrollOffset:{set:function(l){if(l.x===undefined)l.x=this.scrollOffset.x;if(l.y===undefined)l.y=this.scrollOffset.y;var v=this.textViewPaddingFrame;
if(l.y<0)l.y=0;else if(this._textViewSize.height<v.height)l.y=0;else if(l.y+v.height>this._textViewSize.height)l.y=this._textViewSize.height-v.height;if(l.x<0)l.x=0;else if(this._textViewSize.width<v.width)l.x=0;else if(l.x+v.width>this._textViewSize.width)l.x=this._textViewSize.width-v.width;if(!(l.x===this.scrollOffset.x&&l.y===this.scrollOffset.y)){this.buffer._scrollOffset=l;this.scrollOffsetChanged(l);D.publish(this,"editorChange","scrollOffset",l)}},get:function(){return this.buffer._scrollOffset}},
readOnly:{get:function(){return this._buffer.model.readOnly},set:function(l){this._buffer.model.readOnly=l}},focus:{get:function(){return this.textView.hasFocus},set:function(l){if(!k.isBoolean(l))throw new Error('set focus: expected boolean but found "'+l+'"');this.textView.hasFocus=l}},selection:{get:function(){return k.clone(this.textView.getSelectedRange(false))},set:function(l){if(!t.isRange(l))throw new Error("set selection: position/selection must be supplied");this.textView.setSelection(l)}},
selectedText:{get:function(){return this.getText(this.selection)},set:function(l){if(!k.isString(l))throw new Error('set selectedText: expected string but found "'+l+'"');return this.replace(this.selection,l)}},value:{get:function(){return this.layoutManager.textStorage.value},set:function(l){if(!k.isString(l))throw new Error('set value: expected string but found "'+l+'"');return this.replace(this.layoutManager.textStorage.range,l,false)}},syntax:{get:function(){return this.layoutManager.syntaxManager.getSyntax()},
set:function(l){if(!k.isString(l))throw new Error('set syntax: expected string but found "'+newValue+'"');return this.layoutManager.syntaxManager.setSyntax(l)}}})});
bespin.tiki.module("text_editor:views/gutter",function(A,u){var w=A("bespin:util/util"),t=A("bespin:plugins").catalog,p=A("utils/rect"),k=A("views/canvas").CanvasView;u.GutterView=function(e,f){k.call(this,e,true);this.editor=f;this.domNode.addEventListener("click",this._click.bind(this),false)};u.GutterView.prototype=new k;w.mixin(u.GutterView.prototype,{_decorationSpacing:2,drawRect:function(e,f){var o=this.editor.themeData.gutter;f.fillStyle=o.backgroundColor;f.fillRect(e.x,e.y,e.width,e.height);
f.save();f.translate(o.paddingLeft-0.5,-0.5);o=this.editor.layoutManager;var h=o.characterRangeForBoundingRect(e);e=Math.min(h.end.row,o.textLines.length-1);for(var i=o.fontDimension.lineAscent,j=this._loadedDecorations(true),q=[],r=0;r<j.length;r++)q.push(j[r].computeWidth(this));for(h=h.start.row;h<=e;h++){f.save();r=o.lineRectForRow(h).y;f.translate(0,r);for(r=0;r<j.length;r++){j[r].drawDecoration(this,f,i,h);f.translate(q[r]+this._decorationSpacing,0)}f.restore()}f.restore()},computeWidth:function(){var e=
this.editor.themeData.gutter;e=e.paddingLeft+e.paddingRight;for(var f=this._loadedDecorations(true),o=0;o<f.length;o++)e+=f[o].computeWidth(this);e+=(f.length-1)*this._decorationSpacing;return e},_click:function(e){var f={x:e.layerX,y:e.layerY};if(p.pointInRect(f,this.frame))if((e=this._decorationAtPoint(f))&&"selected"in e){f=this.editor.layoutManager.characterAtPoint(this.computeWithClippingFrame(f.x,f.y));e.selected(this,f.row)}},_loadedDecorations:function(e){for(var f=[],o=t.getExtensions("gutterDecoration"),
h=0;h<o.length;h++){var i=o[h].load();if(i.isResolved())i.then(f.push.bind(f));else e&&i.then(this.invalidate.bind(this))}return f},_decorationAtPoint:function(e){var f=this.editor.themeData.gutter;if(e.x>f.paddingLeft){var o=this._loadedDecorations(false);f=f.paddingLeft;for(var h=0;h<o.length;h++){var i=o[h],j=i.computeWidth(this);if(e.x<f+j)return i;f+=j+this._decorationSpacing}}return null}});u.lineNumbers={drawDecoration:function(e,f,o,h){e=e.editor;f.fillStyle=e.themeData.gutter.color;f.font=
e.font;f.fillText(""+(h+1),0,o)},computeWidth:function(e){e=e.editor.layoutManager;return e.fontDimension.characterWidth*(""+e.textLines.length).length}}});
bespin.tiki.module("text_editor:views/scroller",function(A,u){var w=A("bespin:util/util"),t=A("events").Event,p=A("bespin:console").console,k=A("utils/rect"),e=A("views/canvas").CanvasView,f=u.LAYOUT_HORIZONTAL=0,o=u.LAYOUT_VERTICAL=1;u.ScrollerCanvasView=function(h,i){e.call(this,h.container,false,true);this.editor=h;this.layoutDirection=i;h=function(j,q,r){r=r||this.domNode;r.addEventListener(j,function(B){q.call(this,B);w.stopEvent(B)}.bind(this),false)}.bind(this);h("mouseover",this.mouseEntered);
h("mouseout",this.mouseExited);h("mousedown",this.mouseDown);h("mouseup",this.mouseUp,window);h("mousemove",this.mouseMove,window);this.valueChanged=new t};u.ScrollerCanvasView.prototype=new e;w.mixin(u.ScrollerCanvasView.prototype,{lineHeight:20,proportion:0,layoutDirection:o,_isVisible:false,_maximum:0,_value:0,valueChanged:null,padding:{left:0,bottom:0,top:0,right:0},_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,
_drawNib:function(h){var i=this.editor.themeData.scroller,j,q;j=i.nibStyle;q=i.nibArrowStyle;i=i.nibStrokeStyle;var r=Math.floor(7.5);h.fillStyle=j;h.beginPath();h.arc(0,0,Math.floor(7.5),0,Math.PI*2,true);h.closePath();h.fill();h.strokeStyle=i;h.stroke();h.fillStyle=q;h.beginPath();h.moveTo(0,-r+3);h.lineTo(-r+3,r-5);h.lineTo(r-3,r-5);h.closePath();h.fill()},_drawNibs:function(h,i){var j=this._getClientThickness(),q=this._value,r=this._maximum,B=this._isHighlighted();if(B||q!==0){h.save();h.translate(8,
j/2);h.rotate(Math.PI*1.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}if(B||q!==r){h.save();h.translate(this._getClientLength()-8,j/2);h.rotate(Math.PI*0.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}},_getClientFrame:function(){var h=this.frame,i=this.padding;return{x:i.left,y:i.top,width:h.width-(i.left+i.right),height:h.height-(i.top+i.bottom)}},_getClientLength:function(){var h=this._getClientFrame();switch(this.layoutDirection){case f:return h.width;case o:return h.height;default:p.error("unknown layout direction");
return null}},_getClientThickness:function(){var h=this.padding,i=this.editor.themeData.scroller.thickness;switch(this.layoutDirection){case o:return i-(h.left+h.right);case f:return i-(h.top+h.bottom);default:p.error("unknown layout direction");return null}},_getFrameLength:function(){switch(this.layoutDirection){case f:return this.frame.width;case o:return this.frame.height;default:p.error("unknown layout direction");return null}},_getGutterFrame:function(){var h=this._getClientFrame(),i=this._getClientThickness();
switch(this.layoutDirection){case o:return{x:h.x,y:h.y+15,width:i,height:Math.max(0,h.height-30)};case f:return{x:h.x+15,y:h.y,width:Math.max(0,h.width-30),height:i};default:p.error("unknown layout direction");return null}},_getGutterLength:function(){var h=this._getGutterFrame(),i;switch(this.layoutDirection){case f:i=h.width;break;case o:i=h.height;break;default:p.error("unknown layout direction");break}return i},_getHandleFrame:function(){var h=this._getGutterFrame(),i=this._getHandleOffset(),
j=this._getHandleLength();switch(this.layoutDirection){case o:return{x:h.x,y:h.y+i,width:h.width,height:j};case f:return{x:h.x+i,y:h.y,width:j,height:h.height}}},_getHandleLength:function(){var h=this._getGutterLength();return Math.max(h*this.proportion,20)},_getHandleOffset:function(){var h=this._maximum;if(h===0)return 0;var i=this._getGutterLength(),j=this._getHandleLength();return(i-j)*this._value/h},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},
_segmentForMouseEvent:function(h){h={x:h.layerX,y:h.layerY};var i=this._getClientFrame(),j=this.padding;if(!k.pointInRect(h,i))return null;var q=this.layoutDirection;switch(q){case f:if(h.x-j.left<15)return"nib-start";else if(h.x>=i.width-15)return"nib-end";break;case o:if(h.y-j.top<15)return"nib-start";else if(h.y>=i.height-15)return"nib-end";break;default:p.error("unknown layout direction");break}j=this._getHandleFrame();if(k.pointInRect(h,j))return"handle";switch(q){case f:if(h.x<j.x)return"gutter-before";
else if(h.x>=j.x+j.width)return"gutter-after";break;case o:if(h.y<j.y)return"gutter-before";else if(h.y>=j.y+j.height)return"gutter-after";break;default:p.error("unknown layout direction");break}p.error("_segmentForMouseEvent: point ",h," outside view with handle frame ",j," and client frame ",i);return null},adjustFrame:function(){var h=this.frame;this.set("layout",{left:0,top:0,width:h.width,height:h.height})},drawRect:function(h,i){if(this._isVisible){var j=this._isHighlighted();h=this.editor.themeData.scroller;
var q=j?h.fullAlpha:h.particalAlpha,r=this.frame;i.clearRect(0,0,r.width,r.height);i.save();r=this.padding;i.translate(r.left,r.top);this._getHandleFrame();r=this._getGutterLength();var B=this._getClientThickness(),D=B/2,d=this.layoutDirection,K=this._getHandleOffset()+15,L=this._getHandleLength();if(d===o){i.translate(B+1,0);i.rotate(Math.PI*0.5)}if(!(r<=L)){i.globalAlpha=q;if(j){j=this._getClientLength();i.fillStyle=h.trackFillStyle;i.fillRect(8.5,0.5,j-16,B-1);i.strokeStyle=h.trackStrokeStyle;
i.strokeRect(8.5,0.5,j-16,B-1)}j=function(){i.beginPath();i.arc(K+D+0.5,D,D-0.5,Math.PI/2,3*Math.PI/2,false);i.arc(K+L-D-0.5,D,D-0.5,3*Math.PI/2,Math.PI/2,false);i.lineTo(K+D+0.5,B-0.5);i.closePath()};j();r=i.createLinearGradient(K,0,K,B);r.addColorStop(0,h.barFillGradientTopStart);r.addColorStop(0.4,h.barFillGradientTopStop);r.addColorStop(0.41,h.barFillStyle);r.addColorStop(0.8,h.barFillGradientBottomStart);r.addColorStop(1,h.barFillGradientBottomStop);i.fillStyle=r;i.fill();i.save();i.clip();i.fillStyle=
h.barFillStyle;i.beginPath();i.moveTo(K+D*0.4,D*0.6);i.lineTo(K+D*0.9,B*0.4);i.lineTo(K,B*0.4);i.closePath();i.fill();i.beginPath();i.moveTo(K+L-D*0.4,0+D*0.6);i.lineTo(K+L-D*0.9,0+B*0.4);i.lineTo(K+L,0+B*0.4);i.closePath();i.fill();i.restore();i.save();j();i.strokeStyle=h.trackStrokeStyle;i.stroke();i.restore();this._drawNibs(i,q);i.restore()}}},_repeatAction:function(h,i){if(h()!==false){var j=function(){this._repeatAction(h,100)}.bind(this);this._scrollTimer=setTimeout(j,i)}},_scrollByDelta:function(h){this.value=
this._value+h},_scrollUpOneLine:function(){this._scrollByDelta(-this.lineHeight);return true},_scrollDownOneLine:function(){this._scrollByDelta(this.lineHeight);return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case "gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case "gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false}return true},mouseDown:function(h){this._mouseEventPosition=
h;this._mouseOverHandle=false;this._getGutterLength();switch(this._segmentForMouseEvent(h)){case "nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case "nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case "gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case "gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case "handle":break;default:p.error("_segmentForMouseEvent returned an unknown value");break}switch(this.layoutDirection){case f:this._mouseDownScreenPoint=
h.pageX;break;case o:this._mouseDownScreenPoint=h.pageY;break;default:p.error("unknown layout direction");break}},mouseMove:function(h){if(this._mouseDownScreenPoint!==null){if(this._segmentForMouseEvent(h)=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){clearTimeout(this._scrollTimer);this._scrollTimer=null}var i;switch(this.layoutDirection){case f:i=h.pageX;break;case o:i=h.pageY;break;default:p.error("unknown layout direction");break}var j=i-this._mouseDownScreenPoint,
q=this._maximum,r=this._value,B=this._getGutterLength(),D=this._getHandleLength();this.value=r+q*j/(B-D);this._mouseDownScreenPoint=i}this._mouseEventPosition=h}},mouseEntered:function(){this._isMouseOver=true;this.invalidate()},mouseExited:function(){this._isMouseOver=false;this.invalidate()},mouseUp:function(){this._mouseDownValue=this._mouseDownScreenPoint=null;if(this._scrollTimer){clearTimeout(this._scrollTimer);this._scrollTimer=null}this.invalidate()}});Object.defineProperties(u.ScrollerCanvasView.prototype,
{isVisible:{set:function(h){if(this._isVisible!==h){this._isVisible=h;this.domNode.style.display=h?"block":"none";h&&this.invalidate()}}},maximum:{set:function(h){if(this._value>this._maximum)this._value=this._maximum;if(h!==this._maximum){this._maximum=h;this.invalidate()}}},value:{set:function(h){if(h<0)h=0;else if(h>this._maximum)h=this._maximum;if(h!==this._value){this._value=h;this.valueChanged(h);this.invalidate()}}}})});
bespin.tiki.module("text_editor:views/text",function(A,u){var w=A("bespin:plugins").catalog,t=A("bespin:util/util"),p=A("events").Event,k=A("views/canvas").CanvasView;A("controllers/layoutmanager");var e=A("rangeutils:utils/range"),f=A("utils/rect"),o=A("views/textinput").TextInput,h=A("bespin:console").console,i=A("settings").settings;u.TextView=function(j,q){k.call(this,j,true);this.editor=q;this.padding={top:0,bottom:30,left:0,right:30};this.clippingChanged.add(this.clippingFrameChanged.bind(this));
var r=this.domNode;r.style.cursor="text";r.addEventListener("click",this.click.bind(this),false);r.addEventListener("mousedown",this.mouseDown.bind(this),false);r.addEventListener("mousemove",this.mouseMove.bind(this),false);window.addEventListener("mouseup",this.mouseUp.bind(this),false);q.willChangeBuffer.add(this.editorWillChangeBuffer.bind(this));this.selectionChanged=new p;this.beganChangeGroup=new p;this.endedChangeGroup=new p;this.willReplaceRange=new p;this.replacedCharacters=new p;this.textInput=
new o(j,this)};u.TextView.prototype=new k;t.mixin(u.TextView.prototype,{_dragPoint:null,_dragTimer:null,_enclosingScrollView:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_hasFocus:false,_mouseIsDown:false,selectionChanged:null,beganChangeGroup:null,endedChangeGroup:null,willReplaceRange:null,replacedCharacters:null,editorWillChangeBuffer:function(j){if(this.editor.layoutManager){var q=this.editor.layoutManager;
q.invalidatedRects.remove(this);q.changedTextAtRow.remove(this)}q=j.layoutManager;q.invalidatedRects.add(this,this.layoutManagerInvalidatedRects.bind(this));q.changedTextAtRow.add(this,this.layoutManagerChangedTextAtRow.bind(this))},didFocus:function(){this._setFocus(true,true)},didBlur:function(){this._setFocus(false,true)},_drag:function(){var j=this._dragPoint,q=f.offsetFromRect(this.clippingFrame,j);this.moveCursorTo(this._selectionPositionForPoint({x:j.x-q.x,y:j.y-q.y}),true)},_drawInsertionPoint:function(j,
q){if(this._insertionPointVisible){var r=this.editor.layoutManager.characterRectForPosition(this.editor.buffer._selectedRange.start);j=Math.floor(r.x);var B=r.y,D=Math.ceil(r.width);r=r.height;q.save();var d=this.editor.themeData.editor;if(this._hasFocus){q.strokeStyle=d.cursorColor;q.beginPath();q.moveTo(j+0.5,B);q.lineTo(j+0.5,B+r);q.closePath();q.stroke()}else{q.fillStyle=d.unfocusedCursorBackgroundColor;q.fillRect(j+0.5,B,D-0.5,r);q.strokeStyle=d.unfocusedCursorColor;q.strokeRect(j+0.5,B+0.5,
D-1,r-1)}q.restore()}},_drawLines:function(j,q){var r=this.editor,B=r.layoutManager,D=B.textLines,d=B.fontDimension.lineAscent,K=r.themeData;r=K.highlighterFG;K=K.highlighterBG;q.save();q.font=this.editor.font;var L=B.characterRangeForBoundingRect(j),l=L.start;L=L.end;for(var v=L.row,C=l.row;C<=v;C++){var J=D[C];if(!t.none(J)){var P=J.characters,U=P.length,X=Math.min(L.col,U);j=l.col;if(!(j>=U)){J=J.colors;if(J==null)J=[];for(U=0;U<J.length&&j<J[U].start;)U++;for(var aa=U<J.length?J[U].start:j;aa<
X;){j=J[U];var ba=j!=null?j.end:X,$=j!=null?j.tag:"plain";j=B.characterRectForPosition({row:C,col:aa});if(K.hasOwnProperty($)){var fa=B.characterRectForPosition({row:C,col:ba-1});q.fillStyle=K[$];q.fillRect(j.x,j.y,fa.x-j.x+fa.width,fa.height)}$=r.hasOwnProperty($)?r[$]:"red";aa=P.substring(aa,ba);q.fillStyle=$;q.fillText(aa,j.x,j.y+d);aa=ba;U++}}}}q.restore()},_drawSelectionHighlight:function(j,q){j=this.editor.themeData.editor;j=this._hasFocus?j.selectedTextBackgroundColor:j.unfocusedCursorBackgroundColor;
var r=this.editor.layoutManager;q.save();var B=e.normalizeRange(this.editor.buffer._selectedRange);q.fillStyle=j;r.rectsForRange(B).forEach(function(D){q.fillRect(D.x,D.y,D.width,D.height)});q.restore()},_drawSelection:function(j,q){this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?this._drawInsertionPoint(j,q):this._drawSelectionHighlight(j,q)},_getVirtualSelection:function(j){var q=this.editor.buffer._selectedRange,r=this.editor.buffer._selectedRangeEndVirtual;return{start:j&&r?r:q.start,
end:r||q.end}},_invalidateSelection:function(){var j=function(B){return{x:B.x-1,y:B.y,width:B.width+2,height:B.height}},q=this.editor.layoutManager,r=e.normalizeRange(this.editor.buffer._selectedRange);if(this._rangeIsInsertionPoint(r)){q=q.characterRectForPosition(r.start);this.invalidateRect(j(q))}else q.rectsForRange(r).forEach(function(B){this.invalidateRect(j(B))},this)},_isReadOnly:function(){return this.editor.layoutManager.textStorage.readOnly},_keymappingChanged:function(){this._keyBuffer=
"";this._keyState="start"},_performVerticalKeyboardSelection:function(j){var q=this.editor.buffer._selectedRangeEndVirtual;this.moveCursorTo(e.addPositions(q!==null?q:this.editor.buffer._selectedRange.end,{row:j,col:0}),true,true)},_rangeIsInsertionPoint:function(j){return e.isZeroLength(j)},_rearmInsertionPointBlinkTimer:function(){this._insertionPointVisible||this.blinkInsertionPoint();this._insertionPointBlinkTimer!==null&&clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=
setInterval(this.blinkInsertionPoint.bind(this),750)},_repositionSelection:function(){var j=this.editor.layoutManager.textLines,q=j.length,r=this.editor.buffer._selectedRange,B=Math.min(r.start.row,q-1);q=Math.min(r.end.row,q-1);var D=j[q];this.setSelection({start:{row:B,col:Math.min(r.start.col,j[B].characters.length)},end:{row:q,col:Math.min(r.end.col,D.characters.length)}})},_scrollPage:function(j){this.editor.scrollBy(0,(this.clippingFrame.height+this.editor.layoutManager.fontDimension.lineAscent)*
(j?-1:1))},_scrollWhileDragging:function(){var j=this._dragPoint;j=this.computeWithClippingFrame(j.layerX,j.layerY);t.mixin(this._dragPoint,j);this._drag()},_selectionPositionForPoint:function(j){j=this.editor.layoutManager.characterAtPoint(j);return j.partialFraction<0.5?j:e.addPositions(j,{row:0,col:1})},_syntaxManagerUpdatedSyntaxForRows:function(j,q){if(j!==q){var r=this.editor.layoutManager;r.updateTextRows(j,q);r.rectsForRange({start:{row:j,col:0},end:{row:q,col:0}}).forEach(this.invalidateRect,
this)}},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},copy:function(){return this.getSelectedCharacters()},cut:function(){var j=this.getSelectedCharacters();j!=""&&this.performBackspaceOrDelete(false);return j},click:function(){this.focus()},drawRect:function(j,q){q.fillStyle=this.editor.themeData.editor.backgroundColor;q.fillRect(j.x,j.y,j.width,j.height);this._drawSelection(j,q);this._drawLines(j,q)},focus:function(){this.textInput.focus()},
getInsertionPointPosition:function(){var j=this.editor;j=j.layoutManager.characterRectForPosition(j.buffer._selectedRange.start);return{x:j.x,y:j.y}},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?"":this.editor.layoutManager.textStorage.getCharacters(e.normalizeRange(this.editor.buffer._selectedRange))},getSelectedRange:function(j){return j?this.editor.buffer._selectedRange:e.normalizeRange(this.editor.buffer._selectedRange)},groupChanges:function(j){if(this._isReadOnly())return false;
if(this._inChangeGroup){j();return true}this._inChangeGroup=true;this.beganChangeGroup(this,this.editor.buffer._selectedRange);try{j()}catch(q){h.error("Error in groupChanges(): "+q);this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return false}finally{this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return true}},insertText:function(j){if(this._isReadOnly())return false;this.groupChanges(function(){var q=e.normalizeRange(this.editor.buffer._selectedRange);
this.replaceCharacters(q,j);var r=j.split("\n");this.moveCursorTo(r.length>1?{row:q.start.row+r.length-1,col:r[r.length-1].length}:e.addPositions(q.start,{row:0,col:j.length}))}.bind(this));return true},isDelimiter:function(j){return"\"',;.!~@#$%^&*?[]<>():/\\-+ \t".indexOf(j)!==-1},keyDown:function(j){if(j.charCode===0||j._charCode===0)return this.editor.processKeyEvent(j,this,{isTextView:true});else if(j.keyCode===9)j.preventDefault();else return false},layoutManagerChangedTextAtRow:function(){this._repositionSelection()},
layoutManagerInvalidatedRects:function(j,q){q.forEach(this.invalidateRect,this)},mouseDown:function(j){this._mouseIsDown=this.hasFocus=true;var q=this.computeWithClippingFrame(j.layerX,j.layerY);t.mixin(q,{layerX:j.layerX,layerY:j.layerY});switch(j.detail){case 1:var r=this._selectionPositionForPoint(q);this.moveCursorTo(r,j.shiftKey);break;case 2:r=this._selectionPositionForPoint(q);var B=this.editor.layoutManager.textStorage.lines[r.row];if(B.length===0)return true;r.col-=r.col==B.length?1:0;var D=
!this.isDelimiter(B[r.col]),d=this,K=function(L,l){for(;L>-1&&L<B.length;L+=l)if(d.isDelimiter(B[L])===D)break;return L+(l==1?0:1)};j=K(r.col,-1);K=K(r.col,1);this.moveCursorTo({row:r.row,col:j});this.moveCursorTo({row:r.row,col:K},true);break;case 3:j=this.editor.layoutManager.textStorage.lines;r=this._selectionPositionForPoint(q);this.setSelection({start:{row:r.row,col:0},end:{row:r.row,col:j[r.row].length}});break}this._dragPoint=q;this._dragTimer=setInterval(this._scrollWhileDragging.bind(this),
100)},mouseMove:function(j){if(this._mouseIsDown){this._dragPoint=this.computeWithClippingFrame(j.layerX,j.layerY);t.mixin(this._dragPoint,{layerX:j.layerX,layerY:j.layerY});this._drag()}},mouseUp:function(){this._mouseIsDown=false;if(this._dragTimer!==null){clearInterval(this._dragTimer);this._dragTimer=null}},moveCursorTo:function(j,q,r){var B=this.editor.layoutManager.textStorage,D=B.clampPosition(j);this.setSelection({start:q?this.editor.buffer._selectedRange.start:D,end:D});if(r){q=B.lines.length;
r=j.row;B=j.col;this.editor.buffer._selectedRangeEndVirtual=r>0&&r<q?j:{row:r<1?0:q-1,col:B}}else this.editor.buffer._selectedRangeEndVirtual=null;this.scrollToPosition(this.editor.buffer._selectedRange.end)},moveDown:function(){var j=this._getVirtualSelection();j=e.normalizeRange(j);j=this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?j.end:{row:j.end.row,col:j.start.col};j=e.addPositions(j,{row:1,col:0});this.moveCursorTo(j,false,true)},moveLeft:function(){var j=e.normalizeRange(this.editor.buffer._selectedRange);
this._rangeIsInsertionPoint(j)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(j.start,-1)):this.moveCursorTo(j.start)},moveRight:function(){var j=e.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(j)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(j.end,1)):this.moveCursorTo(j.end)},moveUp:function(){var j=e.normalizeRange(this._getVirtualSelection(true));position=e.addPositions({row:j.start.row,col:this._getVirtualSelection().end.col},
{row:-1,col:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(j,q){if(this._isReadOnly())return false;this.groupChanges(function(){j=e.normalizeRange(j);this.willReplaceRange(this,j);this.editor.layoutManager.textStorage.replaceCharacters(j,q);this.replacedCharacters(this,j,q)}.bind(this));return true},performBackspaceOrDelete:function(j){if(this._isReadOnly())return false;var q=this.editor.layoutManager.textStorage,
r=q.lines,B="";B=0;var D=i.get("tabstop"),d=this.getSelectedRange();if(e.isZeroLength(d))if(j){j=d.start;B=r[j.row];B=B.substring(0,j.col).match(/\s*$/)[0].length<D||(j.col-D)%D!=0?1:D;d={start:q.displacePosition(j,B*-1),end:d.end}}else{j=d.end;B=r[j.row];B=B.substring(j.col).match(/^\s*/)[0].length<D?1:D;d={start:d.start,end:q.displacePosition(d.end,B)}}this.groupChanges(function(){this.replaceCharacters(d,"");this.moveCursorTo(d.start)}.bind(this));return true},resetKeyBuffers:function(){this._keyMetaBuffer=
this._keyBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(j){var q=this.editor.layoutManager.characterRectForPosition(j);j=q.x;var r=q.y,B=q.width;q=q.height;var D=this.clippingFrame,d=D.x,K=D.y,L=this.padding,l=D.width-L.right;D=D.height-L.bottom;this.editor.scrollTo({x:j>=d+30&&j+B<d+l?d:j-l/2+B/2,y:r>=K&&r+q<K+D?K:r-D/2+q/2})},selectAll:function(){var j=this.editor.layoutManager.textStorage.lines,q=j.length-
1;this.setSelection({start:{row:0,col:0},end:{row:q,col:j[q].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,-1),true)},selectRight:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,1),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(j,
q){var r=this.editor.layoutManager.textStorage;j=r.clampRange(j);if(!e.equal(j,this.editor.buffer._selectedRange)){this._invalidateSelection();this.editor.buffer._selectedRange=j=r.clampRange(j);this._invalidateSelection();this._hasFocus&&this._rearmInsertionPointBlinkTimer();q&&this.scrollToPosition(j.end);this.selectionChanged(j);w.publish(this.editor,"editorChange","selection",j)}},textInserted:function(j){if(j!=="\n")if(!this.editor.processKeyEvent(j,this,{isTextView:true,isCommandKey:false})){this.insertText(j);
this.resetKeyBuffers()}},_setFocus:function(j,q){if(j!=this._hasFocus)if(this._hasFocus=j){this._rearmInsertionPointBlinkTimer();this._invalidateSelection();q||this.textInput.focus()}else{if(this._insertionPointBlinkTimer){clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=null}this._insertionPointVisible=true;this._invalidateSelection();q||this.textInput.blur()}}});Object.defineProperties(u.TextView.prototype,{hasFocus:{get:function(){return this._hasFocus},set:function(j){this._setFocus(j,
false)}}})});
bespin.tiki.module("text_editor:views/textinput",function(A,u){var w=A("bespin:util/util");A("events");var t=A("rangeutils:utils/range"),p=A("keyboard:keyutil");u.TextInput=function(k,e){var f=this.domNode=document.createElement("textarea");f.setAttribute("style","position: absolute; z-index: -99999; width: 0px; height: 0px; margin: 0px; outline: none; border: 0;");k.appendChild(f);this.delegate=e;this._attachEvents()};u.TextInput.prototype={_composing:false,domNode:null,delegate:null,_textFieldChanged:function(){if(!(this._composing||
this._ignore)){var k=this.domNode,e=k.value;if(e!=""){k.value="";this._textInserted(e)}}},_copy:function(){var k=false,e=this.delegate;if(e&&e.copy)k=e.copy();return k},_cut:function(){var k=false,e=this.delegate;if(e&&e.cut)k=e.cut();return k},_textInserted:function(k){var e=this.delegate;e&&e.textInserted&&e.textInserted(k)},_setValueAndSelect:function(k){var e=this.domNode;e.value=k;e.select()},focus:function(){this.domNode.focus()},blur:function(){this.domNode.blur()},_attachEvents:function(){var k=
this.domNode,e=this;k.addEventListener("focus",function(){e.delegate&&e.delegate.didFocus&&e.delegate.didFocus()},false);k.addEventListener("blur",function(){e.delegate&&e.delegate.didBlur&&e.delegate.didBlur()},false);p.addKeyDownListener(k,function(i){return e.delegate&&e.delegate.keyDown?e.delegate.keyDown(i):false});if(w.isWebKit){w.isChrome||k.addEventListener("compositionend",function(i){e._textInserted(i.data)},false);k.addEventListener("textInput",function(i){e._textInserted(i.data)},false);
k.addEventListener("paste",function(i){e._textInserted(i.clipboardData.getData("text/plain"));i.preventDefault()},false)}else{k.addEventListener("input",function(){e._textFieldChanged()},false);k.addEventListener("compositionstart",function(){e._composing=true},false);k.addEventListener("compositionend",function(){e._composing=false;e._textFieldChanged()},false);k.addEventListener("paste",function(){e._setValueAndSelect("");window.setTimeout(function(){e._textFieldChanged()},0)},false);this.delegate.selectionChanged.add(function(i){if(t.isZeroLength(i))wasSelection=
false;else{k.value="z";k.select();wasSelection=true}}.bind(this))}var f=function(i){i=i.type.indexOf("copy")!=-1?e._copy():e._cut();e._setValueAndSelect(i)};if(w.isWebKit&&!w.isChrome&&w.isMac){var o=(new Date).getTime(),h=function(i){var j=i.type.indexOf("cut")!=-1;if(!(j&&(new Date).getTime()-o<10)){f(i);if(j)o=(new Date).getTime()}};k.addEventListener("beforecopy",h,false);k.addEventListener("beforecut",h,false)}else{h=false;if(w.isMozilla)h=function(i){f(i);e._ignore=true;window.setTimeout(function(){e._setValueAndSelect("");
e._ignore=false},0)};k.addEventListener("copy",h||f,false);k.addEventListener("cut",h||f,false)}}}});bespin.tiki.module("text_editor:index",function(){});bespin.tiki.register("::less",{name:"less",dependencies:{}});
bespin.tiki.module("less:index",function(A,u){function w(e){if(e instanceof k.Dimension)return parseFloat(e.unit=="%"?e.value/100:e.value);else if(typeof e==="number")return e;else throw{error:"RuntimeError",message:"color functions take numbers as parameters"};}function t(e){return Math.min(1,Math.max(0,e))}if(!Array.isArray)Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e instanceof Array};if(!Array.prototype.forEach)Array.prototype.forEach=function(e,f){for(var o=
this.length>>>0,h=0;h<o;h++)h in this&&e.call(f,this[h],h,this)};if(!Array.prototype.map)Array.prototype.map=function(e,f){for(var o=this.length>>>0,h=new Array(o),i=0;i<o;i++)if(i in this)h[i]=e.call(f,this[i],i,this);return h};if(!Array.prototype.filter)Array.prototype.filter=function(e,f){for(var o=[],h=0;h<this.length;h++)e.call(f,this[h])&&o.push(this[h]);return o};if(!Array.prototype.reduce)Array.prototype.reduce=function(e){var f=this.length>>>0,o=0;if(f===0&&arguments.length===1)throw new TypeError;
if(arguments.length>=2)var h=arguments[1];else{do{if(o in this){h=this[o++];break}if(++o>=f)throw new TypeError;}while(1)}for(;o<f;o++)if(o in this)h=e.call(null,h,this[o],o,this);return h};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e,f){var o=this.length;f=f||0;if(!o)return-1;if(f>=o)return-1;if(f<0)f+=o;for(;f<o;f++)if(Object.prototype.hasOwnProperty.call(this,f))if(e===this[f])return f;return-1};if(!Object.keys)Object.keys=function(e){var f=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,
o)&&f.push(o);return f};if(!String.prototype.trim)String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")};if(typeof A!=="undefined")var p=u,k={};else p=k={};p.Parser=function(e){function f(l){var v,C,J;if(l instanceof Function)return l.call(D.parsers);else if(typeof l==="string"){v=h.charAt(i)===l?l:null;C=1}else{if(i>=B+r[j].length&&j<r.length-1)B+=r[j++].length;l.lastIndex=J=i-B;if(v=l.exec(r[j])){C=v[0].length;if(l.lastIndex-C!==J)return}}if(v){i+=C;for(C=
B+r[j].length;i<=C;){l=h.charCodeAt(i);if(!(l===32||l===10||l===9))break;i++}return typeof v==="string"?v:v.length===1?v[0]:v}}function o(l){var v;if(typeof l==="string")return h.charAt(i)===l;else{l.lastIndex=i;if((v=l.exec(h))&&l.lastIndex-v[0].length===i)return v}}var h,i,j,q,r,B,D,d=this,K=function(){},L=this.imports={paths:e&&e.paths||[],queue:[],files:{},push:function(l,v){var C=this;this.queue.push(l);p.Parser.importer(l,this.paths,function(J){C.queue.splice(C.queue.indexOf(l),1);C.files[l]=
J;v(J);C.queue.length===0&&K()})}};this.env=e||{};this.optimization="optimization"in this.env?this.env.optimization:1;return D={imports:L,parse:function(l,v){var C,J,P=null;i=j=B=q=0;r=[];h=l.replace(/\r\n/g,"\n");if(d.optimization>0){h=h.replace(/\/\*(?:[^*]|\*+[^\/*])*\*+\//g,function(aa){return d.optimization>1?"":aa.replace(/\n(\s*\n)+/g,"\n")});r=h.split(/^(?=\n)/mg)}else r=[h];C=new k.Ruleset([],f(this.parsers.primary));C.root=true;C.toCSS=function(aa){var ba,$;return function(){try{return aa.call(this)}catch(fa){$=
h.split("\n");ba=(h.slice(0,fa.index).match(/\n/g)||"").length+1;for(var ja=fa.index,ka=-1;ja>=0&&h.charAt(ja)!=="\n";ja--)ka++;throw{name:"NameError",message:fa.message,line:ba,column:ka,extract:[$[ba-2],$[ba-1],$[ba]]};}}}(C.toCSS);if(i<h.length-1){i=q;J=h.split("\n");l=(h.slice(0,i).match(/\n/g)||"").length+1;for(var U=i,X=-1;U>=0&&h.charAt(U)!=="\n";U--)X++;P={name:"ParseError",message:"Syntax Error on line "+l,filename:e.filename,line:l,column:X,extract:[J[l-2],J[l-1],J[l]]}}if(this.imports.queue.length>
0)K=function(){v(P,C)};else v(P,C)},parsers:{primary:function(){for(var l,v=[];l=f(this.mixin.definition)||f(this.rule)||f(this.ruleset)||f(this.mixin.call)||f(this.comment)||f(/[\n\s]+/g)||f(this.directive);)v.push(l);return v},comment:function(){var l;if(h.charAt(i)==="/")return(l=f(/\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/g))?new k.Comment(l):f(/\/\/.*/g)},entities:{quoted:function(){var l;if(!(h.charAt(i)!=='"'&&h.charAt(i)!=="'"))if(l=f(/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/g))return new k.Quoted(l[0],
l[1]||l[2])},keyword:function(){var l;if(l=f(/[A-Za-z-]+/g))return new k.Keyword(l)},call:function(){var l,v;if(l=f(/([a-zA-Z0-9_-]+|%)\(/g)){if(l[1].toLowerCase()==="alpha")return f(this.alpha);v=f(this.entities.arguments);if(f(")"))if(l)return new k.Call(l[1],v)}},arguments:function(){for(var l=[],v;v=f(this.expression);){l.push(v);if(!f(","))break}return l},literal:function(){return f(this.entities.dimension)||f(this.entities.color)||f(this.entities.quoted)},url:function(){var l;if(!(h.charAt(i)!==
"u"||!f(/url\(/g))){l=f(this.entities.quoted)||f(/[-a-zA-Z0-9_%@$\/.&=:;#+?]+/g);if(!f(")"))throw new Error("missing closing ) for url()");return new k.URL(l.value?l:new k.Anonymous(l))}},variable:function(){var l,v=i;if(h.charAt(i)==="@"&&(l=f(/@[a-zA-Z0-9_-]+/g)))return new k.Variable(l,v)},color:function(){var l;if(h.charAt(i)==="#"&&(l=f(/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/g)))return new k.Color(l[1])},dimension:function(){var l;l=h.charCodeAt(i);if(!(l>57||l<45||l===47))if(l=f(/(-?[0-9]*\.?[0-9]+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm)?/g))return new k.Dimension(l[1],
l[2])}},variable:function(){var l;if(h.charAt(i)==="@"&&(l=f(/(@[a-zA-Z0-9_-]+)\s*:/g)))return l[1]},shorthand:function(){var l,v;if(o(/[@\w.-]+\/[@\w.-]+/g))if((l=f(this.entity))&&f("/")&&(v=f(this.entity)))return new k.Shorthand(l,v)},mixin:{call:function(){for(var l=[],v,C,J,P=i;v=f(/[#.][a-zA-Z0-9_-]+/g);){l.push(new k.Element(C,v));C=f(">")}f("(")&&(J=f(this.entities.arguments))&&f(")");if(l.length>0&&(f(";")||o("}")))return new k.mixin.Call(l,J,P)},definition:function(){var l,v=[],C,J;if(!(h.charAt(i)!==
"."||o(/[^{]*(;|})/g)))if(l=f(/([#.][a-zA-Z0-9_-]+)\s*\(/g)){for(l=l[1];C=f(/@[\w-]+/g)||f(this.entities.literal)||f(this.entities.keyword);){if(C[0]==="@")if(f(":"))if(J=f(this.expression))v.push({name:C,value:J});else throw new Error("Expected value");else v.push({name:C});else v.push({value:C});if(!f(","))break}if(!f(")"))throw new Error("Expected )");if(C=f(this.block))return new k.mixin.Definition(l,v,C)}}},entity:function(){return f(this.entities.literal)||f(this.entities.variable)||f(this.entities.url)||
f(this.entities.call)||f(this.entities.keyword)},end:function(){return f(";")||o("}")},alpha:function(){var l;if(f(/opacity=/gi))if(l=f(/[0-9]+/g)||f(this.entities.variable)){if(!f(")"))throw new Error("missing closing ) for alpha()");return new k.Alpha(l)}},element:function(){var l;c=f(this.combinator);if(l=f(/[.#:]?[a-zA-Z0-9_-]+/g)||f("*")||f(this.attribute)||f(/\([^)@]+\)/g))return new k.Element(c,l)},combinator:function(){var l;return(l=f(/[+>~]/g)||f("&")||f(/::/g))?new k.Combinator(l):new k.Combinator(h.charAt(i-
1)===" "?" ":null)},selector:function(){for(var l,v=[];l=f(this.element);)v.push(l);if(v.length>0)return new k.Selector(v)},tag:function(){return f(/[a-zA-Z][a-zA-Z-]*[0-9]?/g)||f("*")},attribute:function(){var l="",v,C,J;if(f("[")){if(v=f(/[a-z-]+/g)||f(this.entities.quoted))l=(J=f(/[|~*$^]?=/g))&&(C=f(this.entities.quoted)||f(/[\w-]+/g))?[v,J,C.toCSS?C.toCSS():C].join(""):v;if(f("]"))if(l)return"["+l+"]"}},block:function(){var l;if(f("{")&&(l=f(this.primary))&&f("}"))return l},ruleset:function(){var l=
[],v,C,J=i;if(v=o(/([a-z.#: _-]+)[\s\n]*\{/g)){i+=v[0].length-1;l=[new k.Selector([new k.Element(null,v[1])])]}else{for(;v=f(this.selector);){l.push(v);if(!f(","))break}v&&f(this.comment)}if(l.length>0&&(C=f(this.block)))return new k.Ruleset(l,C);else{q=i;i=J}},rule:function(){var l,v=i;if(name=f(this.property)||f(this.variable)){if(name.charAt(0)!="@"&&(match=o(/([^@+\/*(;{}-]*);/g))){i+=match[0].length-1;l=new k.Anonymous(match[1])}else l=name==="font"?f(this.font):f(this.value);if(f(this.end))return new k.Rule(name,
l,v);else{q=i;i=v}}},"import":function(){var l;if(f(/@import\s+/g)&&(l=f(this.entities.quoted)||f(this.entities.url))&&f(";"))return new k.Import(l,L)},directive:function(){var l,v,C;if(h.charAt(i)==="@")if(v=f(this["import"]))return v;else if(l=f(/@media|@page/g)){C=f(/[^{]+/g).trim();if(v=f(this.block))return new k.Directive(l+" "+C,v)}else if(l=f(/@[-a-z]+/g))if(l==="@font-face"){if(v=f(this.block))return new k.Directive(l,v)}else if((v=f(this.entity))&&f(";"))return new k.Directive(l,v)},font:function(){for(var l=
[],v=[],C;C=f(this.shorthand)||f(this.entity);)v.push(C);l.push(new k.Expression(v));if(f(","))for(;C=f(this.expression);){l.push(C);if(!f(","))break}return new k.Value(l,f(this.important))},value:function(){for(var l,v=[];l=f(this.expression);){v.push(l);if(!f(","))break}l=f(this.important);if(v.length>0)return new k.Value(v,l)},important:function(){return f(/!\s*important/g)},sub:function(){var l;if(f("(")&&(l=f(this.expression))&&f(")"))return l},multiplication:function(){var l,v,C,J;if(l=f(this.operand)){for(;(C=
f(/[\/*]/g))&&(v=f(this.operand));)J=new k.Operation(C,[J||l,v]);return J||l}},addition:function(){var l,v,C,J;if(l=f(this.multiplication)){for(;(C=f(/[-+]\s+/g)||h.charAt(i-1)!=" "&&f(/[-+]/g))&&(v=f(this.multiplication));)J=new k.Operation(C,[J||l,v]);return J||l}},operand:function(){return f(this.sub)||f(this.entities.dimension)||f(this.entities.color)||f(this.entities.variable)},expression:function(){for(var l,v=[];l=f(this.addition)||f(this.entity);)v.push(l);if(v.length>0)return new k.Expression(v)},
property:function(){var l;if(l=f(/(\*?-?[-a-z_0-9]+)\s*:/g))return l[1]}}}};p.Parser.importer=null;k.functions={rgb:function(e,f,o){return this.rgba(e,f,o,1)},rgba:function(e,f,o,h){e=[e,f,o].map(function(i){return w(i)});h=w(h);return new k.Color(e,h)},hsl:function(e,f,o){return this.hsla(e,f,o,1)},hsla:function(e,f,o,h){function i(r){r=r<0?r+1:r>1?r-1:r;return r*6<1?q+(j-q)*r*6:r*2<1?j:r*3<2?q+(j-q)*(2/3-r)*6:q}e=(w(e)%360+360)%360/360;f=w(f);o=w(o);h=w(h);var j=o<=0.5?o*(f+1):o+f-o*f,q=o*2-j;return this.rgba(i(e+
1/3)*255,i(e)*255,i(e-1/3)*255,h)},opacity:function(e,f){w(f);return new k.Color(e.rgb,w(f))},saturate:function(e,f){e=e.toHSL();e.s+=f.value/100;e.s=t(e.s);return this.hsl(e.h,e.s,e.l)},desaturate:function(e,f){e=e.toHSL();e.s-=f.value/100;e.s=t(e.s);return this.hsl(e.h,e.s,e.l)},lighten:function(e,f){e=e.toHSL();e.l*=1+f.value/100;e.l=t(e.l);return this.hsl(e.h,e.s,e.l)},darken:function(e,f){e=e.toHSL();e.l*=1-f.value/100;e.l=t(e.l);return this.hsl(e.h,e.s,e.l)},greyscale:function(e){return this.desaturate(e,
new k.Dimension(100))},e:function(e){return new k.Anonymous(e)},"%":function(e){for(var f=Array.prototype.slice.call(arguments,1),o=e.content,h=0;h<f.length;h++)o=o.replace(/%s/,f[h].content).replace(/%[da]/,f[h].toCSS());o=o.replace(/%%/g,"%");return new k.Quoted('"'+o+'"',o)}};k.Alpha=function(e){this.value=e};k.Alpha.prototype={toCSS:function(){return"alpha(opacity="+this.value.toCSS()+")"},eval:function(){return this}};k.Anonymous=function(e){this.value=e.content||e};k.Anonymous.prototype={toCSS:function(){return this.value},
eval:function(){return this}};k.Call=function(e,f){this.name=e;this.args=f};k.Call.prototype={eval:function(e){var f=this.args.map(function(o){return o.eval(e)});return this.name in k.functions?k.functions[this.name].apply(k.functions,f):new k.Anonymous(this.name+"("+f.map(function(o){return o.toCSS()}).join(", ")+")")},toCSS:function(e){return this.eval(e).toCSS()}};k.Color=function(e,f){if(Array.isArray(e)){this.rgb=e;this.alpha=f}else this.rgb=e.length==6?e.match(/.{2}/g).map(function(o){return parseInt(o,
16)}):e.split("").map(function(o){return parseInt(o+o,16)})};k.Color.prototype={eval:function(){return this},toCSS:function(){return this.alpha&&this.alpha<1?"rgba("+this.rgb.concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(e){e=Math.round(e);e=(e>255?255:e<0?0:e).toString(16);return e.length===1?"0"+e:e}).join("")},operate:function(e,f){var o=[];f instanceof k.Color||(f=f.toColor());for(var h=0;h<3;h++)o[h]=k.operate(e,this.rgb[h],f.rgb[h]);return new k.Color(o)},toHSL:function(){var e=
this.rgb[0]/255,f=this.rgb[1]/255,o=this.rgb[2]/255,h=Math.max(e,f,o),i=Math.min(e,f,o),j,q=(h+i)/2,r=h-i;if(h===i)j=i=0;else{i=q>0.5?r/(2-h-i):r/(h+i);switch(h){case e:j=(f-o)/r+(f<o?6:0);break;case f:j=(o-e)/r+2;break;case o:j=(e-f)/r+4;break}j/=6}return{h:j*360,s:i,l:q}}};k.Comment=function(e){this.value=e};k.Comment.prototype={toCSS:function(){return this.value}};k.Dimension=function(e,f){this.value=parseFloat(e);this.unit=f||null};k.Dimension.prototype={eval:function(){return this},toColor:function(){return new k.Color([this.value,
this.value,this.value])},toCSS:function(){return this.value+this.unit},operate:function(e,f){return new k.Dimension(k.operate(e,this.value,f.value),this.unit||f.unit)}};k.Directive=function(e,f){this.name=e;if(Array.isArray(f))this.ruleset=new k.Ruleset([],f);else this.value=f};k.Directive.prototype={toCSS:function(e,f){if(this.ruleset){this.ruleset.root=true;return this.name+" {\n  "+this.ruleset.toCSS(e,f).trim().replace(/\n/g,"\n  ")+"\n}\n"}else return this.name+" "+this.value.toCSS()+";\n"},
eval:function(e){e.frames.unshift(this);this.ruleset&&this.ruleset.evalRules(e);e.frames.shift();return this},variable:function(e){return k.Ruleset.prototype.variable.call(this.ruleset,e)},find:function(){return k.Ruleset.prototype.find.apply(this.ruleset,arguments)},rulesets:function(){return k.Ruleset.prototype.rulesets.apply(this.ruleset)}};k.Element=function(e,f){this.combinator=e instanceof k.Combinator?e:new k.Combinator(e);this.value=f.trim()};k.Element.prototype.toCSS=function(){return this.combinator.toCSS()+
this.value};k.Combinator=function(e){this.value=e===" "?" ":e?e.trim():""};k.Combinator.prototype.toCSS=function(){switch(this.value){case "":return"";case " ":return" ";case "&":return"";case ":":return" :";case "::":return"::";case "+":return" + ";case "~":return" ~ ";case ">":return" > "}};k.Expression=function(e){this.value=e};k.Expression.prototype={eval:function(e){return this.value.length>1?new k.Expression(this.value.map(function(f){return f.eval(e)})):this.value[0].eval(e)},toCSS:function(){return this.value.map(function(e){return e.toCSS()}).join(" ")}};
k.Import=function(e,f){var o=this;this._path=e;this.path=e instanceof k.Quoted?/\.(le?|c)ss$/.test(e.content)?e.content:e.content+".less":e.value.content||e.value;(this.css=/css$/.test(this.path))||f.push(this.path,function(h){o.root=h})};k.Import.prototype={toCSS:function(){return this.css?"@import "+this._path.toCSS()+";\n":""},eval:function(){if(this.css)return this;else{for(var e=0;e<this.root.rules.length;e++)this.root.rules[e]instanceof k.Import&&Array.prototype.splice.apply(this.root.rules,
[e,1].concat(this.root.rules[e].eval()));return this.root.rules}}};k.Keyword=function(e){this.value=e};k.Keyword.prototype={eval:function(){return this},toCSS:function(){return this.value}};k.mixin={};k.mixin.Call=function(e,f,o){this.selector=new k.Selector(e);this.arguments=f;this.index=o};k.mixin.Call.prototype={eval:function(e){for(var f,o=[],h=false,i=0;i<e.frames.length;i++)if((f=e.frames[i].find(this.selector)).length>0){for(i=0;i<f.length;i++)if(f[i].match(this.arguments,e))try{Array.prototype.push.apply(o,
f[i].eval(this.arguments,e).rules);h=true}catch(j){throw{message:j.message,index:this.index};}if(h)return o;else throw{message:"No matching definition was found for `"+this.selector.toCSS().trim()+"("+this.arguments.map(function(q){return q.toCSS()}).join(", ")+")`",index:this.index};}throw{message:this.selector.toCSS().trim()+" is undefined",index:this.index};}};k.mixin.Definition=function(e,f,o){this.name=e;this.selectors=[new k.Selector([new k.Element(null,e)])];this.params=f;this.arity=f.length;
this.rules=o;this._lookups={};this.required=f.reduce(function(h,i){return i.name&&!i.value?h+1:h},0)};k.mixin.Definition.prototype={toCSS:function(){return""},variable:function(e){return k.Ruleset.prototype.variable.call(this,e)},find:function(){return k.Ruleset.prototype.find.apply(this,arguments)},rulesets:function(){return k.Ruleset.prototype.rulesets.apply(this)},eval:function(e,f){for(var o=new k.Ruleset(null,[]),h=0,i;h<this.params.length;h++)if(this.params[h].name)if(i=e&&e[h]||this.params[h].value)o.rules.unshift(new k.Rule(this.params[h].name,
i.eval(f)));else throw{message:"wrong number of arguments for "+this.name+" ("+e.length+" for "+this.arity+")"};return(new k.Ruleset(null,this.rules)).evalRules({frames:[this,o].concat(f.frames)})},match:function(e,f){var o=e&&e.length||0;if(o<this.required)return false;for(var h=0;h<Math.min(o,this.arity);h++)if(!this.params[h].name)if(!e[h].wildcard)if(e[h].eval(f).toCSS()!=this.params[h].value.eval(f).toCSS())return false;return true}};k.Operation=function(e,f){this.op=e.trim();this.operands=f};
k.Operation.prototype.eval=function(e){var f=this.operands[0].eval(e);e=this.operands[1].eval(e);var o;if(f instanceof k.Dimension&&e instanceof k.Color)if(this.op==="*"||this.op==="+"){o=e;e=f;f=o}else throw{name:"OperationError",message:"Can't substract or divide a color from a number"};return f.operate(this.op,e)};k.operate=function(e,f,o){switch(e){case "+":return f+o;case "-":return f-o;case "*":return f*o;case "/":return f/o}};k.Quoted=function(e,f){this.value=e;this.content=f};k.Quoted.prototype=
{toCSS:function(){return this.value},eval:function(){return this}};k.Rule=function(e,f,o){this.name=e;this.value=f instanceof k.Value?f:new k.Value([f]);this.index=o;this.variable=e.charAt(0)==="@"?true:false};k.Rule.prototype.toCSS=function(){return this.variable?"":this.name+": "+this.value.toCSS()+";"};k.Rule.prototype.eval=function(e){return new k.Rule(this.name,this.value.eval(e))};k.Value=function(e){this.value=e;this.is="value"};k.Value.prototype={eval:function(e){return this.value.length===
1?this.value[0].eval(e):new k.Value(this.value.map(function(f){return f.eval(e)}))},toCSS:function(){return this.value.map(function(e){return e.toCSS()}).join(", ")}};k.Shorthand=function(e,f){this.a=e;this.b=f};k.Shorthand.prototype={toCSS:function(e){return this.a.toCSS(e)+"/"+this.b.toCSS(e)},eval:function(){return this}};k.Ruleset=function(e,f){this.selectors=e;this.rules=f;this._lookups={}};k.Ruleset.prototype={eval:function(){return this},evalRules:function(e){var f=[];this.rules.forEach(function(o){if(o.evalRules)f.push(o.evalRules(e));
else o instanceof k.mixin.Call?Array.prototype.push.apply(f,o.eval(e)):f.push(o.eval(e))});this.rules=f;return this},match:function(e){return!e||e.length===0},variable:function(e){return this._variables?this._variables[e]:(this._variables=this.rules.reduce(function(f,o){if(o instanceof k.Rule&&o.variable===true)f[o.name]=o;return f},{}))[e]},rulesets:function(){return this._rulesets?this._rulesets:(this._rulesets=this.rules.filter(function(e){if(e instanceof k.Ruleset||e instanceof k.mixin.Definition)return e}))},
find:function(e,f){f=f||this;var o=[],h=e.toCSS();if(h in this._lookups)return this._lookups[h];this.rulesets().forEach(function(i){if(i!==f)for(var j=0;j<i.selectors.length;j++)if(e.match(i.selectors[j])){e.elements.length>1?Array.prototype.push.apply(o,i.find(new k.Selector(e.elements.slice(1)),f)):o.push(i);break}});return this._lookups[h]=o},toCSS:function(e,f){var o=[],h=[],i=[],j=[];if(this.root){e=[];f={frames:[]};for(var q=0;q<this.rules.length;q++)this.rules[q]instanceof k.Import&&Array.prototype.splice.apply(this.rules,
[q,1].concat(this.rules[q].eval(f)))}else if(e.length===0)j=this.selectors.map(function(B){return[B]});else for(q=0;q<this.selectors.length;q++)for(var r=0;r<e.length;r++)j.push(e[r].concat([this.selectors[q]]));f.frames.unshift(this);for(q=0;q<this.rules.length;q++)this.rules[q]instanceof k.mixin.Call&&Array.prototype.splice.apply(this.rules,[q,1].concat(this.rules[q].eval(f)));for(q=0;q<this.rules.length;q++){e=this.rules[q];if(e instanceof k.Directive)i.push(e.eval(f).toCSS(j,f));else if(e.rules)i.push(e.toCSS(j,
f));else if(e instanceof k.Comment)this.root?i.push(e.toCSS()):h.push(e.toCSS());else if(e.toCSS&&!e.variable)h.push(e.eval(f).toCSS());else e.value&&!e.variable&&h.push(e.value.toString())}i=i.join("");if(this.root)o.push(h.join("\n"));else if(h.length>0){j=j.map(function(B){return B.map(function(D){return D.toCSS()}).join("").trim()}).join(j.length>3?",\n":", ");o.push(j," {\n  "+h.join("\n  ")+"\n}\n")}o.push(i);f.frames.shift();return o.join("")}};k.Selector=function(e){this.elements=e;if(this.elements[0].combinator.value===
"")this.elements[0].combinator.value=" "};k.Selector.prototype.match=function(e){return this.elements[0].value===e.elements[0].value?true:false};k.Selector.prototype.toCSS=function(){if(this._css)return this._css;return this._css=this.elements.map(function(e){return typeof e==="string"?" "+e.trim():e.toCSS()}).join("")};k.URL=function(e){this.value=e};k.URL.prototype={toCSS:function(){return"url("+this.value.toCSS()+")"},eval:function(){return this}};k.Variable=function(e,f){this.name=e;this.index=
f};k.Variable.prototype={eval:function(e){var f,o,h=this.name;if(f=k.find(e.frames,function(i){if(o=i.variable(h))return o.value.eval(e)}))return f;else throw{message:"variable "+this.name+" is undefined",index:this.index};}};k.find=function(e,f){for(var o=0,h;o<e.length;o++)if(h=f.call(e,e[o]))return h;return null};(function(){function e(D){for(var d=0;d<r.length;d++)f(r[d],D)}function f(D,d){var K=typeof localStorage!=="undefined"&&localStorage.getItem(D.href),L=K&&JSON.parse(K);h(D.href,function(l,
v){if(L&&(new Date(v)).valueOf()===(new Date(L.timestamp)).valueOf()){o(L.css,D);d(null,D,{local:true})}else(new p.Parser({optimization:3})).parse(l,function(C,J){if(C)return q(C,D.href);try{d(J,D,{local:false,lastModified:v})}catch(P){q(P,D.href)}})},function(l){throw new Error("Couldn't load "+D.href+" ("+l+")");})}function o(D,d,K){var L=document.createElement("style");L.type="text/css";L.media="screen";L.title="less-sheet";if(d){L.title=d.title||d.href.match(/(?:^|\/)([-\w]+)\.[a-z]+$/i)[1];K&&
typeof localStorage!=="undefined"&&localStorage.setItem(d.href,JSON.stringify({timestamp:K,css:D}))}if(L.styleSheet)L.styleSheet.cssText=D;else L.appendChild(document.createTextNode(D));document.getElementsByTagName("head")[0].appendChild(L)}function h(D,d,K){var L=i();if(window.location.protocol==="file:"){L.open("GET",D,false);L.send(null);L.status===0?d(L.responseText):K(L.status)}else{L.open("GET",D,true);L.onreadystatechange=function(){if(L.readyState==4)if(L.status>=200&&L.status<300)d(L.responseText,
L.getResponseHeader("Last-Modified"));else typeof K==="function"&&K(L.status)};L.send(null)}}function i(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(D){j("less: browser doesn't support AJAX.");return null}}function j(D){p.env=="development"&&typeof console!=="undefined"&&console.log(D)}function q(D,d){var K=document.createElement("div"),L;K.id="less-error-message";K.innerHTML="<h3>"+(D.message||"There is an error in your .less file")+
'</h3><p><a href="'+d+'">'+d+"</a> on line "+D.line+", column "+(D.column+1)+":</p>"+'<div>\n<pre class="ctx"><span>[-1]</span>{0}</pre>\n<pre><span>[0]</span>{current}</pre>\n<pre class="ctx"><span>[1]</span>{2}</pre>\n</div>'.replace(/\[(-?\d)\]/g,function(l,v){return D.line+parseInt(v)}).replace(/\{(\d)\}/g,function(l,v){return D.extract[parseInt(v)]}).replace(/\{current\}/,D.extract[1].slice(0,D.column)+'<span class="error">'+D.extract[1].slice(D.column)+"</span>");o("#less-error-message span {margin-right: 15px;}#less-error-message pre {color: #ee4444;padding: 4px 0;margin: 0;}#less-error-message pre.ctx {color: #dd7777;}#less-error-message h3 {padding: 15px 0 5px 0;margin: 0;}#less-error-message a {color: #10a}#less-error-message .error {color: red;font-weight: bold;padding-bottom: 2px;border-bottom: 1px dashed red;}");
K.style.cssText="font-family: Arial, sans-serif;border: 1px solid #e00;background-color: #eee;border-radius: 5px;color: #e00;padding: 15px;margin-bottom: 15px";if(p.env=="development")L=setInterval(function(){if(document.body){document.body.insertBefore(K,document.body.childNodes[0]);clearInterval(L)}},10)}var r=[];p.env=location.hostname=="127.0.0.1"||location.hostname=="0.0.0.0"||location.hostname=="localhost"||location.protocol=="file:"?"development":"production";var B=setInterval(function(){if(document.body){if(!document.querySelectorAll&&
typeof jQuery==="undefined")j("No selector method found");else r=(document.querySelectorAll||jQuery).call(document,'link[rel="stylesheet/less"]');clearInterval(B);e(function(D,d,K){o(D.toCSS(),d,K.lastModified);K.local?j("less: loading "+d.href+" from local storage."):j("less: parsed "+d.href+" successfully.")})}},10);if(p.env==="development")refreshTimer=setInterval(function(){/!refresh/.test(location.hash)&&e(function(D,d,K){o(D.toCSS(),d,K)})},1E3);p.Parser.importer=function(D,d,K){f({href:D,title:D},
function(L){K(L)})}})()});bespin.tiki.register("::theme_manager_base",{name:"theme_manager_base",dependencies:{}});bespin.tiki.module("theme_manager_base:index",function(){});bespin.tiki.register("::keyboard",{name:"keyboard",dependencies:{canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("keyboard:keyboard",function(A,u){var w=A("bespin:plugins").catalog;A("bespin:console");A("bespin:util/stacktrace");var t=A("bespin:util/util"),p=A("settings").settings,k=A("keyboard:keyutil"),e=A("canon:history"),f=A("canon:request").Request,o=A("environment").env;u.buildFlags=function(h){h.context=o.contexts[0];return h};A=function(){};t.mixin(A.prototype,{_customKeymappingCache:{states:{}},processKeyEvent:function(h,i,j){h=k.commandCodes(h,true)[0];if(t.none(h))return false;
u.buildFlags(j);j.isCommandKey=true;return this._matchCommand(h,i,j)},_matchCommand:function(h,i,j){var q=this._findCommandExtension(h,i,j);if(q&&q.commandExt!=="no command"){j.isTextView&&i.resetKeyBuffers();var r=q.commandExt;r.load(function(B){B=new f({command:B,commandExt:r});e.execute(q.args,B)});return true}return q&&q.commandExt==="no command"?true:false},_buildBindingsRegex:function(h){h.forEach(function(i){if(t.none(i.key))if(Array.isArray(i.regex)){i.key=new RegExp("^"+i.regex[1]+"$");i.regex=
new RegExp(i.regex.join("")+"$")}else i.regex=new RegExp(i.regex+"$");else i.key=new RegExp("^"+i.key+"$")})},_buildKeymappingRegex:function(h){for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true},_findCommandExtension:function(h,i,j){if(j.isTextView){var q=i._keyState;if(!j.isCommandKey||h.indexOf("alt_")===-1){i._keyBuffer+=h.replace(/ctrl_meta|meta/,"ctrl");i._keyMetaBuffer+=h}var r=[this._customKeymappingCache];r=r.concat(w.getExtensions("keymapping"));for(var B=
0;B<r.length;B++)if(!t.none(r[B].states[q])){t.none(r[B]._convertedRegExp)&&this._buildKeymappingRegex(r[B]);var D=this._bindingsMatch(h,j,i,r[B]);if(!t.none(D))return D}}i=w.getExtensions("command");var d=null;q={};h=h.replace(/ctrl_meta|meta/,"ctrl");i.some(function(K){if(this._commandMatches(K,h,j)){d=K;return true}return false}.bind(this));return t.none(d)?null:{commandExt:d,args:q}},_bindingsMatch:function(h,i,j,q){var r,B=null,D={},d;d=t.none(q.hasMetaKey)?j._keyMetaBuffer:j._keyBuffer;if(h.indexOf("alt_")===
0&&i.isCommandKey)d+=h;q.states[j._keyState].some(function(K){if(K.key&&!K.key.test(h))return false;if(K.regex&&!(r=K.regex.exec(d)))return false;if(K.disallowMatches)for(var L=0;L<K.disallowMatches.length;L++)if(r[K.disallowMatches[L]])return true;if(!u.flagsMatch(K.predicates,i))return false;if(K.exec){B=w.getExtensionByKey("command",K.exec);if(t.none(B))throw new Error("Can't find command "+K.exec+" in state="+j._keyState+", symbolicName="+h);if(K.params){var l;K.params.forEach(function(v){l=!t.none(v.match)&&
!t.none(r)?r[v.match]||v.defaultValue:v.defaultValue;if(v.type==="number")l=parseInt(l);D[v.name]=l})}j.resetKeyBuffers()}if(K.then){j._keyState=K.then;j.resetKeyBuffers()}if(t.none(B))B="no command";return true});if(t.none(B))return null;return{commandExt:B,args:D}},_commandMatches:function(h,i,j){var q=h.key;if(!q)return false;if(!u.flagsMatch(h.predicates,j))return false;if(typeof q==="string"){if(q!=i)return false;return true}if(!Array.isArray(q)){q=[q];h.key=q}for(h=0;h<q.length;h++){var r=q[h];
if(typeof r==="string"){if(r==i)return true}else if(r.key==i)return u.flagsMatch(r.predicates,j)}return false},_customKeymappingChanged:function(){var h=this._customKeymappingCache=JSON.parse(p.get("customKeymapping"));h.states=h.states||{};for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true}});u.flagsMatch=function(h,i){if(t.none(h))return true;if(!i)return false;for(var j in h)if(i[j]!==h[j])return false;return true};u.keyboardManager=new A;w.registerExtension("settingChange",
{match:"customKeymapping",pointer:u.keyboardManager._customKeymappingChanged.bind(u.keyboardManager)})});
bespin.tiki.module("keyboard:keyutil",function(A,u){var w=A("bespin:util/util");u.KeyHelper=function(){var p={MODIFIER_KEYS:{16:"shift",17:"ctrl",18:"alt",224:"meta"},FUNCTION_KEYS:{8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},PRINTABLE_KEYS:{32:" ",
48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},PRINTABLE_KEYS_CHARCODE:{},KEY:{}};for(var k in p.PRINTABLE_KEYS){var e=p.PRINTABLE_KEYS[k];p.PRINTABLE_KEYS_CHARCODE[e.charCodeAt(0)]=k;if(e.toUpperCase()!=
e)p.PRINTABLE_KEYS_CHARCODE[e.toUpperCase().charCodeAt(0)]=k}for(k in p.FUNCTION_KEYS){e=p.FUNCTION_KEYS[k].toUpperCase();p.KEY[e]=parseInt(k,10)}return p}();var t=function(p){return!!(p.altKey||p.ctrlKey||p.metaKey||p.charCode!==p.which&&u.KeyHelper.FUNCTION_KEYS[p.which])};u.commandCodes=function(p,k){var e=p._keyCode||p.keyCode,f=p._charCode===undefined?p.charCode:p._charCode,o=null,h=null,i="",j=true;if(e===0&&p.which===0)return false;if(f!==0)return false;if(u.KeyHelper.MODIFIER_KEYS[f])return[u.KeyHelper.MODIFIER_KEYS[f],
null];if(e){o=u.KeyHelper.FUNCTION_KEYS[e];if(!o&&(p.altKey||p.ctrlKey||p.metaKey)){o=u.KeyHelper.PRINTABLE_KEYS[e];if(e>47&&e<58)j=p.altKey}if(o){if(p.altKey)i+="alt_";if(p.ctrlKey)i+="ctrl_";if(p.metaKey)i+="meta_"}else if(p.ctrlKey||p.metaKey)return false}if(!o){e=p.which;h=o=String.fromCharCode(e);e=o.toLowerCase();if(p.metaKey){i="meta_";o=e}else o=null}if(p.shiftKey&&o&&j)i+="shift_";if(o)o=i+o;if(!k&&o)o=o.replace(/ctrl_meta|meta/,"ctrl");return[o,h]};u.addKeyDownListener=function(p,k){var e=
function(f){var o=k(f);o&&w.stopEvent(f);return o};p.addEventListener("keydown",function(f){if(w.isMozilla)if(u.KeyHelper.FUNCTION_KEYS[f.keyCode])return true;else if((f.ctrlKey||f.metaKey)&&u.KeyHelper.PRINTABLE_KEYS[f.keyCode])return true;if(t(f))return e(f);return true},false);p.addEventListener("keypress",function(f){if(w.isMozilla)if(u.KeyHelper.FUNCTION_KEYS[f.keyCode])return e(f);else if((f.ctrlKey||f.metaKey)&&u.KeyHelper.PRINTABLE_KEYS_CHARCODE[f.charCode]){f._keyCode=u.KeyHelper.PRINTABLE_KEYS_CHARCODE[f.charCode];
f._charCode=0;return e(f)}if(f.charCode!==undefined&&f.charCode===0)return true;return e(f)},false)}});bespin.tiki.module("keyboard:index",function(){});bespin.tiki.register("::edit_session",{name:"edit_session",dependencies:{events:"0.0.0"}});
bespin.tiki.module("edit_session:index",function(A,u){A("bespin:promise");A("bespin:plugins");A("bespin:util/util");A("events");u.EditSession=function(){};u.EditSession.prototype={_currentView:null,currentUser:null,history:null,getCompletePath:function(w){if(w==null)w="";if(w==null||w.substring(0,1)!="/"){var t;if(this._currentView&&this._currentView.buffer)t=this._currentView.buffer;var p;if(t)p=t.file;w=p?p.parentdir()+w:"/"+w}return w}};Object.defineProperties(u.EditSession.prototype,{currentView:{set:function(w){if(w!==
this._currentView)this._currentView=w},get:function(){return this._currentView}}});u.createSession=function(w,t){var p=new u.EditSession;if(w)p.currentView=w.textView;if(t)p.currentUser=t;return p}});bespin.tiki.register("::completion",{name:"completion",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("completion:controller",function(A,u){function w(h){this._editorView=h;h.selectionChanged.add(this._selectionChanged.bind(this));h.willChangeBuffer.add(this._willChangeBuffer.bind(this));this._syntaxChanged=this._syntaxChanged.bind(this);this.tags=new p.Tags;this.ui=new e(h.element)}function t(h){return function(){return o.editor.completionController[h](o)}}var p=A("ctags"),k=A("rangeutils:utils/range"),e=A("completion:ui").CompletionUI,f=A("bespin:plugins").catalog,o=A("environment").env;
w.prototype={_buffer:null,_completionEngine:null,_completions:null,_stem:null,_hideCompletions:function(){this.ui.hide()},_selectionChanged:function(h){var i=this._completionEngine;if(!(i==null||!k.isZeroLength(h))){var j=this._buffer.layoutManager,q=j.syntaxManager,r=h.start;h=r.col;r=j.textStorage.lines[r.row];j=r.substring(0,h);h=r.substring(h);i=i.getCompletions(j,h,q);if(i==null)this._hideCompletions();else{q=i.tags;this._stem=i.stem;this._showCompletions(q)}}},_showCompletions:function(h){var i=
this._editorView,j=i.textView.getInsertionPointPosition();j=i.convertTextViewPoint(j);this.ui.show(h,j,i.layoutManager.fontDimension.lineHeight)},_syntaxChanged:function(h){h=f.getExtensionByKey("completion",h);if(h==null)this._completionEngine=null;else h.load().then(function(i){this._completionEngine=new i(this.tags)}.bind(this))},_willChangeBuffer:function(h){var i=this._buffer;i!=null&&i.layoutManager.syntaxManager.syntaxChanged.remove(this._syntaxChanged);h.layoutManager.syntaxManager.syntaxChanged.add(this._syntaxChanged);
this._buffer=h},cancel:function(){this.ui.hide()},complete:function(h){var i=this.ui,j=i.getCompletion().name;h.view.insertText(j.substring(this._stem.length));i.hide()},isCompleting:function(){return this.ui.visible},moveDown:function(){this.ui.move("down")},moveUp:function(){this.ui.move("up")},tags:null};u.CompletionController=w;u.completeCommand=t("complete");u.completeCancelCommand=t("cancel");u.completeDownCommand=t("moveDown");u.completeUpCommand=t("moveUp")});
bespin.tiki.module("completion:ui",function(A,u){function w(o){var h=p.uniqueId("bespin-completion-panel"),i=document.createElement("div");i.id=h;i.className="bespin-completion-panel";i.style.display="none";i.innerHTML='<div class="bespin-completion-pointer"></div><div class="bespin-completion-bubble-outer"><div class="bespin-completion-bubble-inner"><div class="bespin-completion-highlight"></div><ul></ul></div></div>';t(o).append(i);this.panel=t(i);this.parent=t(o)}var t=A("jquery").$,p=A("underscore")._,
k=p.template('<span class="bespin-completion-container"> &mdash; <%= container %></span>'),e=p.template('<div class="bespin-completion-second-row"><%= type %></div>'),f=p.template('<li><div class="bespin-completion-top-row"><span class="bespin-completion-kind bespin-completion-kind-<%= kind %>"><%= kind %></span><span class="bespin-completion-ident"><%= ident %></span><%= container %></div><%= second_row %></li>');w.prototype={_fromBottom:false,_index:0,_tags:null,_getHighlightDimensions:function(o){var h=
o.position(),i=o.outerHeight()-2;o=o.outerWidth()-2;return{left:h.left,top:h.top,height:i,width:o}},_listItemForIndex:function(o){return this.panel.find("li:eq("+o+")")},_populate:function(){var o=p(this._tags).map(function(h){var i=h["class"],j=h.module,q=h.namespace;i=i!=null?i:q!=null?q:"";if(j!=null)i=j+(i!=""?"#"+i:"");j=i==""?"":k({container:i});i=h.type;i=i==null?"":e({type:i});return f({kind:h.kind,ident:h.name,container:j,second_row:i})});this.panel.find("ul").html(o.join("\n"))},panel:null,
visible:false,getCompletion:function(){return this.visible?this._tags[this._index]:null},hide:function(){if(this.visible){this.panel.fadeOut(100);this.visible=false}},move:function(o){var h=this._index,i=this._listItemForIndex(h),j=o==="up"?i.prev():i.next();if(j.length!==0){this._index=h=o==="up"?h-1:h+1;h=t(i).find(".bespin-completion-top-row");var q=t(i).find(".bespin-completion-second-row");i=t(j).find(".bespin-completion-top-row");var r=t(j).find(".bespin-completion-second-row");q.hide();r.show();
var B=this.panel.find(".bespin-completion-highlight");B.stop(true,true);j=this._getHighlightDimensions(j);B.animate(j,100);r.hide();if(o==="down"){o=q.height();i.css("top",o);i.animate({top:0},100)}else{o=r.height();h.css("top",-o);h.animate({top:0},100)}r.fadeIn()}},show:function(o,h,i){this._tags=o=p(o).clone();this._populate();var j=this.visible,q=this.panel;q.stop(true,true);j||q.show();var r=this.parent.offset(),B=r.left,D=B+h.x,d=r.top+h.y;r=q.outerWidth();var K=q.outerHeight(),L=t(window).width(),
l=t(window).height();this._fromBottom=d=d+K+i>l;if(this._index>=o.length)this._index=o.length-1;if(d){d=q.find(".bespin-completion-pointer");d.removeClass("bespin-completion-pointer-up");d.addClass("bespin-completion-pointer-down");q.css({bottom:-h.y,top:""});this._tags.reverse();this._populate();if(!j)this._index=o.length-1}else{d=q.find(".bespin-completion-pointer");d.removeClass("bespin-completion-pointer-down");d.addClass("bespin-completion-pointer-up");q.css({top:h.y+i,bottom:""});if(!j)this._index=
0}if(!j){if(D+h.x+r>L){d.css({left:"",right:32});q.css("left",Math.min(L-r-B,h.x-r+43))}else{d.css({left:32,right:""});q.css("left",Math.max(B,h.x-43))}q.hide().animate({opacity:"show"},100)}o=q.find(".bespin-completion-highlight");o.stop(true,true);h=this._listItemForIndex(this._index);h.find(".bespin-completion-second-row").show();h=this._getHighlightDimensions(h);o.css(h);this.visible=true}};u.CompletionUI=w});bespin.tiki.module("completion:index",function(){});
bespin.tiki.register("::rangeutils",{name:"rangeutils",dependencies:{}});
bespin.tiki.module("rangeutils:utils/range",function(A,u){var w=A("bespin:util/util");u.addPositions=function(t,p){return{row:t.row+p.row,col:t.col+p.col}};u.cloneRange=function(t){var p=t.start;t=t.end;return{start:{row:p.row,col:p.col},end:{row:t.row,col:t.col}}};u.comparePositions=function(t,p){var k=t.row-p.row;return k===0?t.col-p.col:k};u.equal=function(t,p){return u.comparePositions(t.start,p.start)===0&&u.comparePositions(t.end,p.end)===0};u.extendRange=function(t,p){var k=t.end;return{start:t.start,
end:{row:k.row+p.row,col:k.col+p.col}}};u.intersectRangeSets=function(t,p){t=w.clone(t);p=w.clone(p);for(var k=[];t.length>0&&p.length>0;){var e=t.shift(),f=p.shift(),o=u.comparePositions(e.start,f.start),h=u.comparePositions(e.end,f.end);if(u.comparePositions(e.end,f.start)<0){k.push(e);p.unshift(f)}else if(u.comparePositions(f.end,e.start)<0){k.push(f);t.unshift(e)}else if(o<0){k.push({start:e.start,end:f.start});t.unshift({start:f.start,end:e.end});p.unshift(f)}else if(o===0)if(h<0)p.unshift({start:e.end,
end:f.end});else h>0&&t.unshift({start:f.end,end:e.end});else if(o>0){k.push({start:f.start,end:e.start});t.unshift(e);p.unshift({start:e.start,end:f.end})}}return k.concat(t,p)};u.isZeroLength=function(t){return t.start.row===t.end.row&&t.start.col===t.end.col};u.maxPosition=function(t,p){return u.comparePositions(t,p)>0?t:p};u.normalizeRange=function(t){return this.comparePositions(t.start,t.end)<0?t:{start:t.end,end:t.start}};u.rangeSetBoundaries=function(t){return{start:t[0].start,end:t[t.length-
1].end}};u.toString=function(t){var p=t.start;t=t.end;return"[ "+p.row+", "+p.col+" "+t.row+","+ +t.col+" ]"};u.unionRanges=function(t,p){return{start:t.start.row<p.start.row||t.start.row===p.start.row&&t.start.col<p.start.col?t.start:p.start,end:t.end.row>p.end.row||t.end.row===p.end.row&&t.end.col>p.end.col?t.end:p.end}};u.isPosition=function(t){return!w.none(t)&&!w.none(t.row)&&!w.none(t.col)};u.isRange=function(t){return!w.none(t)&&u.isPosition(t.start)&&u.isPosition(t.end)}});
bespin.tiki.module("rangeutils:index",function(){});bespin.tiki.register("::undomanager",{name:"undomanager",dependencies:{}});
bespin.tiki.module("undomanager:index",function(A,u){var w=A("bespin:util/util");A("environment");u.UndoManager=function(){};w.mixin(u.UndoManager.prototype,{_redoStack:[],_undoStack:[],_undoOrRedo:function(t,p,k){if(p.length===0)return false;p=p.pop();if(!p.target[t](p.context)){this._redoStack=[];this._undoStack=[];return false}k.push(p);return true},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(t,p){this._redoStack=[];this._undoStack.push({target:t,
context:p})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});u.global=new u.UndoManager;u.undoManagerCommand=function(t,p){u.global[p.commandExt.name]()}});bespin.tiki.register("::ctags",{name:"ctags",dependencies:{traits:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("ctags:index",function(A,u){var w=A("underscore")._,t=A("./reader").TagReader;A=A("traits").Trait;u.Tags=function(){this.tags=[]};u.Tags.prototype=Object.create(Object.prototype,A.compose(A({_search:function(p,k){var e={name:p};p=this.tags;var f=w(p).sortedIndex(e,function(o){return o.name});for(f=e=f;e>=0&&e<p.length&&k(p[e]);)e--;for(;f>=0&&f<p.length&&k(p[f]);)f++;return p.slice(e+1,f)},add:function(p){var k=this.tags;Array.prototype.push.apply(k,p);k.sort(function(e,f){e=e.name;
f=f.name;if(e<f)return-1;if(e===f)return 0;return 1})},get:function(p){return this._search(p,function(k){return k.name===p})},scan:function(p,k,e){if(e===null||e===undefined)e={};var f=p.split("\n");p=parse(p,k,1);k=new Interpreter(p,k,f,e);k.interpret();this.add(k.tags)},stem:function(p){var k=p.length;return this._search(p,function(e){return e.name.substring(0,k)===p})}}),t))});
bespin.tiki.module("ctags:reader",function(A,u){var w=A("underscore")._;A=A("traits").Trait;u.TagReader=A({readLines:function(t){var p=[];w(t).each(function(k){k=k.split("\t");if(!(k.length<3)){var e=k[0];if(!/^!_TAG_/.test(e)){e={name:e,tagfile:k[1],addr:k[2]};var f;if(k.length>3&&k[3].indexOf(":")===-1){e.kind=k[3];f=4}else f=3;var o={};w(k.slice(f)).each(function(h){h=/^([^:]+):(.*)/.exec(h);o[h[1]]=h[2]});e.fields=o;p.push(e)}}});this.add(p)},readString:function(t){this.readLines(t.split("\n"))}})});
bespin.tiki.register("::theme_manager",{name:"theme_manager",dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"}});
bespin.tiki.module("theme_manager:index",function(A,u){A("bespin:promise");var w=A("bespin:plugins").catalog;A("events");var t=A("themestyles"),p=A("settings").settings,k=null,e=null;u.themestyles=t;u.themeSettingChanged=function(f,o,h){var i=w.getExtensionByKey("theme",h);if(h==="standard"||!h||!i){i=null;if(e!==null)i=w.getExtensionByKey("theme",e)}if(i)i.load().then(function(j){k&&t.unregisterThemeStyles(k);t.currentThemeVariables=j();k=i;t.parseGlobalVariables();t.reparse();i.url&&t.registerThemeStyles(i);
w.publish(u,"themeChange")});else if(k){t.unregisterThemeStyles(k);k=null;t.currentThemeVariables=null;t.parseGlobalVariables();t.reparse();w.publish(this,"themeChange")}};w.registerExtension("settingChange",{match:"theme",pointer:u.themeSettingChanged.bind(u)});u.setStandardTheme=function(f){e=f;f!==p.get("theme")&&u.themeSettingChanged(this)};u.setBasePlugin=function(f){t.basePluginName=f};u.startParsing=function(){t.preventParsing=false;return t.reparse()};u.registerTheme=function(f){var o=p.get("theme");
f.name===o&&u.themeSettingChanged(this,"theme",f.name)};u.unregisterTheme=function(f){f.name===p.get("theme")&&u.themeSettingChanged(this)};u.appLaunched=function(){w.publish(u,"themeChange")}});
bespin.tiki.module("theme_manager:themestyles",function(A,u){var w=A("bespin:util/util"),t=A("bespin:plugins").catalog,p=A("bespin:console").console,k=A("bespin:promise").Promise,e=A("bespin:promise").group,f=A("bespin:proxy"),o=new (A("less").Parser)({optimization:3}),h=1;u.currentThemeVariables=null;u.basePluginName=null;u.preventParsing=true;var i="";u.globalThemeVariables={};var j={},q={},r=function(v){var C={},J=[],P=function(U,X){J.push(U);if(typeof X!="object")C[J.join("_")]=X;else for(prop in X)P(prop,
X[prop]);J.pop()};P("global",v);return C},B={},D={font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",error_color:"#F99",header_color:"white",link_color:"#ACF",control:{color:"#E1B41F",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.2)",active:{color:"#FF9600",border:"1px solid #E1B41F",inset_color:"#ff9600",background:"rgba(0, 0, 0, 0.2)"}},pane:{h1:{font:"'MuseoSans', Helvetica",
font_size:"2.8em",color:"white"},color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",link_color:"white",background:"#45443C",border_radius:".5em"},form:{color:"white",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",font:"'Lucida Sans','Lucida Grande',Verdana,Arial,sans-serif",font_size:"@global_font_size",line_height:"@global_line_height"},button:{color:"white",background:"#3E6CB9"},container:{background:"#1E1916",border:"1px solid black"},selectable:{color:"white",border:"0px solid transparent",background:"transparent",
active:{color:"black",border:"0px solid transparent",background:"#FF8E00"},hover:{color:"black",border:"0px solid transparent",background:"#FF8E00"}},hint:{color:"#AAA",active:{color:"black"},hover:{color:"black"}},accelerator:{color:"#996633",active:{color:"black"},hover:{color:"black"}},menu:{border_color:"black",inset_color_right:"#1E1916",inset_color_top_left:"#3E3936",background:"transparent"}};D=r(D);u.getPluginThemeVariables=function(v){var C=t.plugins[v];if(!C)return null;var J={};if(u.currentThemeVariables&&
u.currentThemeVariables[v])J=u.currentThemeVariables[v];C.provides.forEach(function(P){if(P.ep==="themevariable"){var U=P.name;J[U]=J[U]||P.defaultValue}});return J};u.parseGlobalVariables=function(){var v={},C="",J=u.currentThemeVariables;w.mixin(v,D);J&&J.global&&w.mixin(v,r(J.global));u.globalThemeVariables=v;for(prop in v)C+="@"+prop+":"+v[prop]+";";i=C};u.parseGlobalVariables();var d=function(v,C,J){if(j[C])styleElem=document.getElementById("_bespin_theme_style_"+j[C]);else{styleElem=document.createElement("style");
styleElem.setAttribute("id","_bespin_theme_style_"+h);j[C]=h;h++;document.body.appendChild(styleElem)}o.parse(i+J+q[C],function(P,U){if(P){P="Error less parsing "+C+" "+P.message;p.error(P);v.reject(P)}else{try{var X=U.toCSS()}catch(aa){P="Error less parsing "+C+" "+aa;p.error(P);v.reject(P);return}if(styleElem&&styleElem.firstChild)styleElem.firstChild.textContent=X;else{P=document.createTextNode(X);styleElem.appendChild(P)}v.resolve()}})},K={};u.parsePlugin=function(v){if(u.preventParsing)return(new k).resolve();
var C=t.plugins[v];if(!C)throw"reparsePlugin: plugin "+v+" is not defined!";if(!K[v]){K[v]=new k;setTimeout(function(){var J=u.getPluginThemeVariables(v),P="";for(prop in J)P+="@"+prop+":"+J[prop]+";";J=new k;J.then(function(U){K[this.name].resolve(U);K[this.name]=null}.bind(this),function(){K[this.name].reject(data);K[this.name]=null}.bind(this));d(J,v,P)}.bind(C),0)}return K[v]};var L=function(v,C,J,P){J=J.replace(/url\(['"]*([^'")]*)(['"]*)\)/g,"url("+v+"$1)");q[C]+=J;P&&P.resolve()},l=null;u.registerThemeStyles=
function(v){var C=v.getPluginName(),J=t.getResourceURL(C);if(!(v.url instanceof Array))v.url=[v.url];q[C]="";var P=[],U=u.preventParsing;v.url.forEach(function(X){if(B[C]&&B[C][X])L(J,C,B[C][X]);else{var aa=new k;P.push(aa);var ba=J+X+"?"+(new Date).getTime();f.xhr("GET",ba,true,function($){$.overrideMimeType("text/plain")}).then(function($){L(J,C,$,aa)},function(){p.error("registerLessFile: Could not load "+J+X);aa.resolve()})}});if(P.length===0)u.parsePlugin(C);else{U||e(P).then(function(){u.parsePlugin(C)});
if(l!==null)P=P.concat(l);l=e(P)}};u.reparse=function(){var v=new k;if(u.preventParsing)return v.resolve();l?l.then(function(){var C=[],J=u.basePluginName;J!==null&&q[J]&&C.push(u.parsePlugin(J));for(var P in q)P!==J&&C.push(u.parsePlugin(P));e(C).then(v.resolve.bind(v),v.reject.bind(v))},function(C){v.reject(C)}):v.resolve();return v};u.unregisterThemeStyles=function(v){v=v.getPluginName();if(j[v]){var C=document.getElementById("_bespin_theme_style_"+j[v]);C.parentNode.removeChild(C);delete j[v];
delete q[v]}}});bespin.tiki.register("::whitetheme",{name:"whitetheme",dependencies:{theme_manager:"0.0.0"}});
bespin.tiki.module("whitetheme:index",function(A,u){u.whiteTheme=function(){return{global:{font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#2E2E3D",text_shadow:"1px 1px white",error_color:"#C03A38",header_color:"#222222",link_color:"#597BAC",pane:{h1:{font:"'MuseoSans', Helvetica",font_size:"2.8em",color:"#2C3480"},link_color:"@global_link_color",background:"#DFDFDF",border_radius:".5em",color:"#2E2E3D",text_shadow:"1px 1px #DDD"},form:{font:"@global_font",
font_size:"@global_font_size",line_height:"@global_line_height",color:"black",text_shadow:"0px 0px transparent"},control:{color:"#222",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.1)",active:{color:"#000",border:"1px solid #597BAC",inset_color:"#597BAC",background:"rgba(0, 0, 0, 0.1)"}},button:{color:"white",background:"#3E6CB9"},container:{background:"#F8F8F8",border:"1px solid black"},menu:{border_color:"black",inset_color:"#999",background:"transparent"},
selectable:{color:"black",border:"0px solid transparent",background:"transparent",active:{color:"white",border:"0px solid transparent",background:"#6780E4"},hover:{color:"white",border:"0px solid transparent",background:"#6780E4"}},hint:{color:"#78788D",active:{color:"white"},hover:{color:"white"}},accelerator:{color:"#344DB1",active:{color:"white"},hover:{color:"white"}}},text_editor:{gutter:{color:"#888888",backgroundColor:"#d2d2d2"},editor:{color:"#3D3D3D",backgroundColor:"#ffffff",cursorColor:"#000000",
selectedTextBackgroundColor:"#BDD9FC",unfocusedCursorColor:"#57A1FF",unfocusedCursorBackgroundColor:"#D9E9FC"},highlighterFG:{plain:"rgb(0,0,0)",comment:"rgb(63,95,191)",directive:"lime",error:"rgb(255,0,0)",identifier:"pink",keyword:"rgb(63,127,127)",operator:"#477ABE",string:"rgb(0,0,127)",addition:"#ffffff",deletion:"#ffffff"},highlighterBG:{addition:"#008000",deletion:"#800000"},scroller:{padding:5,thickness:17,backgroundStyle:"#2A211C",fullAlpha:1,particalAlpha:0.3,nibStyle:"rgb(150, 150, 150)",
nibArrowStyle:"rgb(255, 255, 255)",nibStrokeStyle:"white",trackFillStyle:"rgba(50, 50, 50, 0.2)",trackStrokeStyle:"rgb(150, 150, 150)",barFillStyle:"rgb(60, 60, 60)",barFillGradientTopStart:"rgb(150, 150, 150)",barFillGradientTopStop:"rgb(100, 100, 100)",barFillGradientBottomStart:"rgb(82, 82, 82)",barFillGradientBottomStop:"rgb(104, 104, 104)"}}}}});bespin.tiki.register("::jquery",{name:"jquery",dependencies:{}});
bespin.tiki.module("jquery:index",function(A,u){function w(){if(!d.isReady){try{l.documentElement.doScroll("left")}catch(a){setTimeout(w,1);return}d.ready()}}function t(a,b){b.src?d.ajax({url:b.src,async:false,dataType:"script"}):d.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function p(a,b,g,n,m,y){var z=a.length;if(typeof b==="object"){for(var I in b)p(a,I,b[I],n,m,g);return a}if(g!==undefined){n=!y&&n&&d.isFunction(g);for(I=0;I<z;I++)m(a[I],b,n?g.call(a[I],
I,m(a[I],b)):g,y);return a}return z?m(a[0],b):undefined}function k(){return(new Date).getTime()}function e(){return false}function f(){return true}function o(a,b,g){g[0].type=a;return d.event.handle.apply(b,g)}function h(a){var b,g=[],n=[],m=arguments,y,z,I,E,H,O;z=d.data(this,"events");if(!(a.liveFired===this||!z||!z.live||a.button&&a.type==="click")){a.liveFired=this;var R=z.live.slice(0);for(E=0;E<R.length;E++){z=R[E];z.origType.replace(na,"")===a.type?n.push(z.selector):R.splice(E--,1)}y=d(a.target).closest(n,
a.currentTarget);H=0;for(O=y.length;H<O;H++)for(E=0;E<R.length;E++){z=R[E];if(y[H].selector===z.selector){I=y[H].elem;n=null;if(z.preType==="mouseenter"||z.preType==="mouseleave")n=d(a.relatedTarget).closest(z.selector)[0];if(!n||n!==I)g.push({elem:I,handleObj:z})}}H=0;for(O=g.length;H<O;H++){y=g[H];a.currentTarget=y.elem;a.data=y.handleObj.data;a.handleObj=y.handleObj;if(y.handleObj.origHandler.apply(y.elem,m)===false){b=false;break}}return b}}function i(a,b){return"live."+(a&&a!=="*"?a+".":"")+
b.replace(/\./g,"`").replace(/ /g,"&")}function j(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function q(a,b){var g=0;b.each(function(){if(this.nodeName===(a[g]&&a[g].nodeName)){var n=d.data(a[g++]),m=d.data(this,n);if(n=n&&n.events){delete m.handle;m.events={};for(var y in n)for(var z in n[y])d.event.add(this,y,n[y][z],n[y][z].data)}}})}function r(a,b,g){var n,m,y;b=b&&b[0]?b[0].ownerDocument||b[0]:l;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===l&&!Da.test(a[0])&&(d.support.checkClone||
!Ea.test(a[0]))){m=true;if(y=d.fragments[a[0]])if(y!==1)n=y}if(!n){n=b.createDocumentFragment();d.clean(a,b,n,g)}if(m)d.fragments[a[0]]=y?n:1;return{fragment:n,cacheable:m}}function B(a,b){var g={};d.each(Fa.concat.apply([],Fa.slice(0,b)),function(){g[this]=a});return g}function D(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var d=function(a,b){return new d.fn.init(a,b)},K=window.jQuery,L=window.$,l=window.document,v,C=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,
J=/^.[^:#\[\.,]*$/,P=/\S/,U=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,X=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;A=navigator.userAgent;var aa=false,ba=[],$,fa=Object.prototype.toString,ja=Object.prototype.hasOwnProperty,ka=Array.prototype.push,oa=Array.prototype.slice,Ga=Array.prototype.indexOf;d.fn=d.prototype={init:function(a,b){var g,n;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!b){this.context=l;this[0]=l.body;this.selector="body";this.length=1;return this}if(typeof a===
"string")if((g=C.exec(a))&&(g[1]||!b))if(g[1]){n=b?b.ownerDocument||b:l;if(a=X.exec(a))if(d.isPlainObject(b)){a=[l.createElement(a[1])];d.fn.attr.call(a,b,true)}else a=[n.createElement(a[1])];else{a=r([g[1]],[n]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return d.merge(this,a)}else{if(b=l.getElementById(g[2])){if(b.id!==g[2])return v.find(a);this.length=1;this[0]=b}this.context=l;this.selector=a;return this}else if(!b&&/^\w+$/.test(a)){this.selector=a;this.context=l;a=l.getElementsByTagName(a);
return d.merge(this,a)}else return!b||b.jquery?(b||v).find(a):d(b).find(a);else if(d.isFunction(a))return v.ready(a);if(a.selector!==undefined){this.selector=a.selector;this.context=a.context}return d.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return oa.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,b,g){var n=d();d.isArray(a)?ka.apply(n,a):d.merge(n,a);n.prevObject=this;
n.context=this.context;if(b==="find")n.selector=this.selector+(this.selector?" ":"")+g;else if(b)n.selector=this.selector+"."+b+"("+g+")";return n},each:function(a,b){return d.each(this,a,b)},ready:function(a){d.bindReady();if(d.isReady)a.call(l,d);else ba&&ba.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(oa.apply(this,arguments),"slice",oa.call(arguments).join(","))},
map:function(a){return this.pushStack(d.map(this,function(b,g){return a.call(b,g,b)}))},end:function(){return this.prevObject||d(null)},push:ka,sort:[].sort,splice:[].splice};d.fn.init.prototype=d.fn;d.extend=d.fn.extend=function(){var a=arguments[0]||{},b=1,g=arguments.length,n=false,m,y,z,I;if(typeof a==="boolean"){n=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(g===b){a=this;--b}for(;b<g;b++)if((m=arguments[b])!=null)for(y in m){z=a[y];I=m[y];if(a!==I)if(n&&I&&(d.isPlainObject(I)||
d.isArray(I))){z=z&&(d.isPlainObject(z)||d.isArray(z))?z:d.isArray(I)?[]:{};a[y]=d.extend(n,z,I)}else if(I!==undefined)a[y]=I}return a};d.extend({noConflict:function(a){window.$=L;if(a)window.jQuery=K;return d},isReady:false,ready:function(){if(!d.isReady){if(!l.body)return setTimeout(d.ready,13);d.isReady=true;if(ba){for(var a,b=0;a=ba[b++];)a.call(l,d);ba=null}d.fn.triggerHandler&&d(l).triggerHandler("ready")}},bindReady:function(){if(!aa){aa=true;if(l.readyState==="complete")return d.ready();if(l.addEventListener){l.addEventListener("DOMContentLoaded",
$,false);window.addEventListener("load",d.ready,false)}else if(l.attachEvent){l.attachEvent("onreadystatechange",$);window.attachEvent("onload",d.ready);var a=false;try{a=window.frameElement==null}catch(b){}l.documentElement.doScroll&&a&&w()}}},isFunction:function(a){return fa.call(a)==="[object Function]"},isArray:function(a){return fa.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||fa.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!ja.call(a,"constructor")&&
!ja.call(a.constructor.prototype,"isPrototypeOf"))return false;var b;for(b in a);return b===undefined||ja.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=d.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return window.JSON&&window.JSON.parse?
window.JSON.parse(a):(new Function("return "+a))();else d.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&P.test(a)){var b=l.getElementsByTagName("head")[0]||l.documentElement,g=l.createElement("script");g.type="text/javascript";if(d.support.scriptEval)g.appendChild(l.createTextNode(a));else g.text=a;b.insertBefore(g,b.firstChild);b.removeChild(g)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,g){var n,m=0,y=a.length,
z=y===undefined||d.isFunction(a);if(g)if(z)for(n in a){if(b.apply(a[n],g)===false)break}else for(;m<y;){if(b.apply(a[m++],g)===false)break}else if(z)for(n in a){if(b.call(a[n],n,a[n])===false)break}else for(g=a[0];m<y&&b.call(g,m,g)!==false;g=a[++m]);return a},trim:function(a){return(a||"").replace(U,"")},makeArray:function(a,b){b=b||[];if(a!=null)a.length==null||typeof a==="string"||d.isFunction(a)||typeof a!=="function"&&a.setInterval?ka.call(b,a):d.merge(b,a);return b},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);
for(var g=0,n=b.length;g<n;g++)if(b[g]===a)return g;return-1},merge:function(a,b){var g=a.length,n=0;if(typeof b.length==="number")for(var m=b.length;n<m;n++)a[g++]=b[n];else for(;b[n]!==undefined;)a[g++]=b[n++];a.length=g;return a},grep:function(a,b,g){for(var n=[],m=0,y=a.length;m<y;m++)!g!==!b(a[m],m)&&n.push(a[m]);return n},map:function(a,b,g){for(var n=[],m,y=0,z=a.length;y<z;y++){m=b(a[y],y,g);if(m!=null)n[n.length]=m}return n.concat.apply([],n)},guid:1,proxy:function(a,b,g){if(arguments.length===
2)if(typeof b==="string"){g=a;a=g[b];b=undefined}else if(b&&!d.isFunction(b)){g=b;b=undefined}if(!b&&a)b=function(){return a.apply(g||this,arguments)};if(a)b.guid=a.guid=a.guid||b.guid||d.guid++;return b},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});A=d.uaMatch(A);if(A.browser){d.browser[A.browser]=
true;d.browser.version=A.version}if(d.browser.webkit)d.browser.safari=true;if(Ga)d.inArray=function(a,b){return Ga.call(b,a)};v=d(l);if(l.addEventListener)$=function(){l.removeEventListener("DOMContentLoaded",$,false);d.ready()};else if(l.attachEvent)$=function(){if(l.readyState==="complete"){l.detachEvent("onreadystatechange",$);d.ready()}};(function(){d.support={};var a=l.documentElement,b=l.createElement("script"),g=l.createElement("div"),n="script"+k();g.style.display="none";g.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
var m=g.getElementsByTagName("*"),y=g.getElementsByTagName("a")[0];if(!(!m||!m.length||!y)){d.support={leadingWhitespace:g.firstChild.nodeType===3,tbody:!g.getElementsByTagName("tbody").length,htmlSerialize:!!g.getElementsByTagName("link").length,style:/red/.test(y.getAttribute("style")),hrefNormalized:y.getAttribute("href")==="/a",opacity:/^0.55$/.test(y.style.opacity),cssFloat:!!y.style.cssFloat,checkOn:g.getElementsByTagName("input")[0].value==="on",optSelected:l.createElement("select").appendChild(l.createElement("option")).selected,
parentNode:g.removeChild(g.appendChild(l.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};b.type="text/javascript";try{b.appendChild(l.createTextNode("window."+n+"=1;"))}catch(z){}a.insertBefore(b,a.firstChild);if(window[n]){d.support.scriptEval=true;delete window[n]}try{delete b.test}catch(I){d.support.deleteExpando=false}a.removeChild(b);if(g.attachEvent&&g.fireEvent){g.attachEvent("onclick",function E(){d.support.noCloneEvent=
false;g.detachEvent("onclick",E)});g.cloneNode(true).fireEvent("onclick")}g=l.createElement("div");g.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=l.createDocumentFragment();a.appendChild(g.firstChild);d.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;d(function(){var E=l.createElement("div");E.style.width=E.style.paddingLeft="1px";l.body.appendChild(E);d.boxModel=d.support.boxModel=E.offsetWidth===2;l.body.removeChild(E).style.display="none"});a=function(E){var H=
l.createElement("div");E="on"+E;var O=E in H;if(!O){H.setAttribute(E,"return;");O=typeof H[E]==="function"}return O};d.support.submitBubbles=a("submit");d.support.changeBubbles=a("change");a=b=g=m=y=null}})();d.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var ga="jQuery"+k(),Ya=0,Ha={};d.extend({cache:{},expando:ga,noData:{embed:true,
object:true,applet:true},data:function(a,b,g){if(!(a.nodeName&&d.noData[a.nodeName.toLowerCase()])){a=a==window?Ha:a;var n=a[ga],m=d.cache;if(!n&&typeof b==="string"&&g===undefined)return null;n||(n=++Ya);if(typeof b==="object"){a[ga]=n;m[n]=d.extend(true,{},b)}else if(!m[n]){a[ga]=n;m[n]={}}a=m[n];if(g!==undefined)a[b]=g;return typeof b==="string"?a[b]:a}},removeData:function(a,b){if(!(a.nodeName&&d.noData[a.nodeName.toLowerCase()])){a=a==window?Ha:a;var g=a[ga],n=d.cache,m=n[g];if(b){if(m){delete m[b];
d.isEmptyObject(m)&&d.removeData(a)}}else{if(d.support.deleteExpando)delete a[d.expando];else a.removeAttribute&&a.removeAttribute(d.expando);delete n[g]}}}});d.fn.extend({data:function(a,b){if(typeof a==="undefined"&&this.length)return d.data(this[0]);else if(typeof a==="object")return this.each(function(){d.data(this,a)});var g=a.split(".");g[1]=g[1]?"."+g[1]:"";if(b===undefined){var n=this.triggerHandler("getData"+g[1]+"!",[g[0]]);if(n===undefined&&this.length)n=d.data(this[0],a);return n===undefined&&
g[1]?this.data(g[0]):n}else return this.trigger("setData"+g[1]+"!",[g[0],b]).each(function(){d.data(this,a,b)})},removeData:function(a){return this.each(function(){d.removeData(this,a)})}});d.extend({queue:function(a,b,g){if(a){b=(b||"fx")+"queue";var n=d.data(a,b);if(!g)return n||[];if(!n||d.isArray(g))n=d.data(a,b,d.makeArray(g));else n.push(g);return n}},dequeue:function(a,b){b=b||"fx";var g=d.queue(a,b),n=g.shift();if(n==="inprogress")n=g.shift();if(n){b==="fx"&&g.unshift("inprogress");n.call(a,
function(){d.dequeue(a,b)})}}});d.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===undefined)return d.queue(this[0],a);return this.each(function(){var g=d.queue(this,a,b);a==="fx"&&g[0]!=="inprogress"&&d.dequeue(this,a)})},dequeue:function(a){return this.each(function(){d.dequeue(this,a)})},delay:function(a,b){a=d.fx?d.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var g=this;setTimeout(function(){d.dequeue(g,b)},a)})},clearQueue:function(a){return this.queue(a||
"fx",[])}});var Ia=/[\n\t]/g,ta=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,cb=/^(a|area)$/i,Ja=/radio|checkbox/;d.fn.extend({attr:function(a,b){return p(this,a,b,true,d.attr)},removeAttr:function(a){return this.each(function(){d.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(d.isFunction(a))return this.each(function(H){var O=d(this);O.addClass(a.call(this,H,O.attr("class")))});if(a&&typeof a==="string")for(var b=
(a||"").split(ta),g=0,n=this.length;g<n;g++){var m=this[g];if(m.nodeType===1)if(m.className){for(var y=" "+m.className+" ",z=m.className,I=0,E=b.length;I<E;I++)if(y.indexOf(" "+b[I]+" ")<0)z+=" "+b[I];m.className=d.trim(z)}else m.className=a}return this},removeClass:function(a){if(d.isFunction(a))return this.each(function(E){var H=d(this);H.removeClass(a.call(this,E,H.attr("class")))});if(a&&typeof a==="string"||a===undefined)for(var b=(a||"").split(ta),g=0,n=this.length;g<n;g++){var m=this[g];if(m.nodeType===
1&&m.className)if(a){for(var y=(" "+m.className+" ").replace(Ia," "),z=0,I=b.length;z<I;z++)y=y.replace(" "+b[z]+" "," ");m.className=d.trim(y)}else m.className=""}return this},toggleClass:function(a,b){var g=typeof a,n=typeof b==="boolean";if(d.isFunction(a))return this.each(function(m){var y=d(this);y.toggleClass(a.call(this,m,y.attr("class"),b),b)});return this.each(function(){if(g==="string")for(var m,y=0,z=d(this),I=b,E=a.split(ta);m=E[y++];){I=n?I:!z.hasClass(m);z[I?"addClass":"removeClass"](m)}else if(g===
"undefined"||g==="boolean"){this.className&&d.data(this,"__className__",this.className);this.className=this.className||a===false?"":d.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,g=this.length;b<g;b++)if((" "+this[b].className+" ").replace(Ia," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===undefined){var b=this[0];if(b){if(d.nodeName(b,"option"))return(b.attributes.value||{}).specified?b.value:b.text;if(d.nodeName(b,"select")){var g=b.selectedIndex,
n=[],m=b.options;b=b.type==="select-one";if(g<0)return null;var y=b?g:0;for(g=b?g+1:m.length;y<g;y++){var z=m[y];if(z.selected){a=d(z).val();if(b)return a;n.push(a)}}return n}if(Ja.test(b.type)&&!d.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Za,"")}}else{var I=d.isFunction(a);return this.each(function(E){var H=d(this),O=a;if(this.nodeType===1){if(I)O=a.call(this,E,H.val());if(typeof O==="number")O+="";if(d.isArray(O)&&Ja.test(this.type))this.checked=
d.inArray(H.val(),O)>=0;else if(d.nodeName(this,"select")){var R=d.makeArray(O);d("option",this).each(function(){this.selected=d.inArray(d(this).val(),R)>=0});if(!R.length)this.selectedIndex=-1}else this.value=O}})}}});d.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,b,g,n){if(!(!a||a.nodeType===3||a.nodeType===8)){if(n&&b in d.attrFn)return d(a)[b](g);n=a.nodeType!==1||!d.isXMLDoc(a);var m=g!==undefined;b=n&&d.props[b]||b;if(a.nodeType===
1){var y=$a.test(b);if(b in a&&n&&!y){if(m){b==="type"&&ab.test(a.nodeName)&&a.parentNode&&d.error("type property can't be changed");a[b]=g}if(d.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&b.specified?b.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:undefined;return a[b]}if(!d.support.style&&n&&b==="style"){if(m)a.style.cssText=""+g;return a.style.cssText}m&&a.setAttribute(b,""+g);a=!d.support.hrefNormalized&&
n&&y?a.getAttribute(b,2):a.getAttribute(b);return a===null?undefined:a}return d.style(a,b,g)}}});var na=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,function(b){return"\\"+b})};d.event={add:function(a,b,g,n){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==window&&!a.frameElement)a=window;var m,y;if(g.handler){m=g;g=m.handler}if(!g.guid)g.guid=d.guid++;if(y=d.data(a)){var z=y.events=y.events||{},I=y.handle;if(!I)y.handle=I=function(){return typeof d!=="undefined"&&!d.event.triggered?
d.event.handle.apply(I.elem,arguments):undefined};I.elem=a;b=b.split(" ");for(var E,H=0,O;E=b[H++];){y=m?d.extend({},m):{handler:g,data:n};if(E.indexOf(".")>-1){O=E.split(".");E=O.shift();y.namespace=O.slice(0).sort().join(".")}else{O=[];y.namespace=""}y.type=E;y.guid=g.guid;var R=z[E],W=d.event.special[E]||{};if(!R){R=z[E]=[];if(!W.setup||W.setup.call(a,n,O,I)===false)if(a.addEventListener)a.addEventListener(E,I,false);else a.attachEvent&&a.attachEvent("on"+E,I)}if(W.add){W.add.call(a,y);if(!y.handler.guid)y.handler.guid=
g.guid}R.push(y);d.event.global[E]=true}a=null}}},global:{},remove:function(a,b,g,n){if(!(a.nodeType===3||a.nodeType===8)){var m,y=0,z,I,E,H,O,R,W=d.data(a),Z=W&&W.events;if(W&&Z){if(b&&b.type){g=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(m in Z)d.event.remove(a,m+b)}else{for(b=b.split(" ");m=b[y++];){H=m;z=m.indexOf(".")<0;I=[];if(!z){I=m.split(".");m=I.shift();E=new RegExp("(^|\\.)"+d.map(I.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(O=Z[m])if(g){H=
d.event.special[m]||{};for(Y=n||0;Y<O.length;Y++){R=O[Y];if(g.guid===R.guid){if(z||E.test(R.namespace)){n==null&&O.splice(Y--,1);H.remove&&H.remove.call(a,R)}if(n!=null)break}}if(O.length===0||n!=null&&O.length===1){if(!H.teardown||H.teardown.call(a,I)===false)Ka(a,m,W.handle);delete Z[m]}}else for(var Y=0;Y<O.length;Y++){R=O[Y];if(z||E.test(R.namespace)){d.event.remove(a,H,R.handler,Y);O.splice(Y--,1)}}}if(d.isEmptyObject(Z)){if(b=W.handle)b.elem=null;delete W.events;delete W.handle;d.isEmptyObject(W)&&
d.removeData(a)}}}}},trigger:function(a,b,g,n){var m=a.type||a;if(!n){a=typeof a==="object"?a[ga]?a:d.extend(d.Event(m),a):d.Event(m);if(m.indexOf("!")>=0){a.type=m=m.slice(0,-1);a.exclusive=true}if(!g){a.stopPropagation();d.event.global[m]&&d.each(d.cache,function(){this.events&&this.events[m]&&d.event.trigger(a,b,this.handle.elem)})}if(!g||g.nodeType===3||g.nodeType===8)return;a.result=undefined;a.target=g;b=d.makeArray(b);b.unshift(a)}a.currentTarget=g;(n=d.data(g,"handle"))&&n.apply(g,b);n=g.parentNode||
g.ownerDocument;try{if(!(g&&g.nodeName&&d.noData[g.nodeName.toLowerCase()]))if(g["on"+m]&&g["on"+m].apply(g,b)===false)a.result=false}catch(y){}if(!a.isPropagationStopped()&&n)d.event.trigger(a,b,n,true);else if(!a.isDefaultPrevented()){n=a.target;var z,I=d.nodeName(n,"a")&&m==="click",E=d.event.special[m]||{};if((!E._default||E._default.call(g,a)===false)&&!I&&!(n&&n.nodeName&&d.noData[n.nodeName.toLowerCase()])){try{if(n[m]){if(z=n["on"+m])n["on"+m]=null;d.event.triggered=true;n[m]()}}catch(H){}if(z)n["on"+
m]=z;d.event.triggered=false}}},handle:function(a){var b,g,n,m;a=arguments[0]=d.event.fix(a||window.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;if(!b){g=a.type.split(".");a.type=g.shift();n=new RegExp("(^|\\.)"+g.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}m=d.data(this,"events");g=m[a.type];if(m&&g){g=g.slice(0);m=0;for(var y=g.length;m<y;m++){var z=g[m];if(b||n.test(z.namespace)){a.handler=z.handler;a.data=z.data;a.handleObj=z;z=z.handler.apply(this,arguments);if(z!==
undefined){a.result=z;if(z===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[ga])return a;
var b=a;a=d.Event(b);for(var g=this.props.length,n;g;){n=this.props[--g];a[n]=b[n]}if(!a.target)a.target=a.srcElement||l;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=l.documentElement;g=l.body;a.pageX=a.clientX+(b&&b.scrollLeft||g&&g.scrollLeft||0)-(b&&b.clientLeft||g&&g.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||g&&g.scrollTop||0)-(b&&b.clientTop||
g&&g.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==undefined)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:d.proxy,special:{ready:{setup:d.bindReady,teardown:d.noop},live:{add:function(a){d.event.add(this,a.origType,d.extend({},a,{handler:h}))},remove:function(a){var b=true,g=a.origType.replace(na,"");d.each(d.data(this,"events").live||[],function(){if(g===
this.origType.replace(na,""))return b=false});b&&d.event.remove(this,a.origType,h)}},beforeunload:{setup:function(a,b,g){if(this.setInterval)this.onbeforeunload=g;return false},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};var Ka=l.removeEventListener?function(a,b,g){a.removeEventListener(b,g,false)}:function(a,b,g){a.detachEvent("on"+b,g)};d.Event=function(a){if(!this.preventDefault)return new d.Event(a);if(a&&a.type){this.originalEvent=a;this.type=a.type}else this.type=
a;this.timeStamp=k();this[ga]=true};d.Event.prototype={preventDefault:function(){this.isDefaultPrevented=f;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=f;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=f;this.stopPropagation()},isDefaultPrevented:e,isPropagationStopped:e,isImmediatePropagationStopped:e};
var La=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;d.event.handle.apply(this,arguments)}}catch(g){}},Ma=function(a){a.type=a.data;d.event.handle.apply(this,arguments)};d.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){d.event.special[a]={setup:function(g){d.event.add(this,b,g&&g.selector?Ma:La,a)},teardown:function(g){d.event.remove(this,b,g&&g.selector?Ma:La)}}});if(!d.support.submitBubbles)d.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!==
"form"){d.event.add(this,"click.specialSubmit",function(a){var b=a.target,g=b.type;if((g==="submit"||g==="image")&&d(b).closest("form").length)return o("submit",this,arguments)});d.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,g=b.type;if((g==="text"||g==="password")&&d(b).closest("form").length&&a.keyCode===13)return o("submit",this,arguments)})}else return false},teardown:function(){d.event.remove(this,".specialSubmit")}};if(!d.support.changeBubbles){var ua=/textarea|input|select/i,
va,Na=function(a){var b=a.type,g=a.value;if(b==="radio"||b==="checkbox")g=a.checked;else if(b==="select-multiple")g=a.selectedIndex>-1?d.map(a.options,function(n){return n.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")g=a.selectedIndex;return g},wa=function(a,b){var g=a.target,n,m;if(!(!ua.test(g.nodeName)||g.readOnly)){n=d.data(g,"_change_data");m=Na(g);if(a.type!=="focusout"||g.type!=="radio")d.data(g,"_change_data",m);if(!(n===undefined||m===n))if(n!=null||m){a.type="change";
return d.event.trigger(a,b,g)}}};d.event.special.change={filters:{focusout:wa,click:function(a){var b=a.target,g=b.type;if(g==="radio"||g==="checkbox"||b.nodeName.toLowerCase()==="select")return wa.call(this,a)},keydown:function(a){var b=a.target,g=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(g==="checkbox"||g==="radio")||g==="select-multiple")return wa.call(this,a)},beforeactivate:function(a){a=a.target;d.data(a,"_change_data",Na(a))}},setup:function(){if(this.type===
"file")return false;for(var a in va)d.event.add(this,a+".specialChange",va[a]);return ua.test(this.nodeName)},teardown:function(){d.event.remove(this,".specialChange");return ua.test(this.nodeName)}};va=d.event.special.change.filters}l.addEventListener&&d.each({focus:"focusin",blur:"focusout"},function(a,b){function g(n){n=d.event.fix(n);n.type=b;return d.event.handle.call(this,n)}d.event.special[b]={setup:function(){this.addEventListener(a,g,true)},teardown:function(){this.removeEventListener(a,
g,true)}}});d.each(["bind","one"],function(a,b){d.fn[b]=function(g,n,m){if(typeof g==="object"){for(var y in g)this[b](y,n,g[y],m);return this}if(d.isFunction(n)){m=n;n=undefined}var z=b==="one"?d.proxy(m,function(E){d(this).unbind(E,z);return m.apply(this,arguments)}):m;if(g==="unload"&&b!=="one")this.one(g,n,m);else{y=0;for(var I=this.length;y<I;y++)d.event.add(this[y],g,z,n)}return this}});d.fn.extend({unbind:function(a,b){if(typeof a==="object"&&!a.preventDefault)for(var g in a)this.unbind(g,
a[g]);else{g=0;for(var n=this.length;g<n;g++)d.event.remove(this[g],a,b)}return this},delegate:function(a,b,g,n){return this.live(b,g,n,a)},undelegate:function(a,b,g){return arguments.length===0?this.unbind("live"):this.die(b,null,g,a)},trigger:function(a,b){return this.each(function(){d.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){a=d.Event(a);a.preventDefault();a.stopPropagation();d.event.trigger(a,b,this[0]);return a.result}},toggle:function(a){for(var b=arguments,g=1;g<
b.length;)d.proxy(a,b[g++]);return this.click(d.proxy(a,function(n){var m=(d.data(this,"lastToggle"+a.guid)||0)%g;d.data(this,"lastToggle"+a.guid,m+1);n.preventDefault();return b[m].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Oa={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};d.each(["live","die"],function(a,b){d.fn[b]=function(g,n,m,y){var z,I=0,E,H,O=y||this.selector,R=y?this:d(this.context);if(d.isFunction(n)){m=
n;n=undefined}for(g=(g||"").split(" ");(z=g[I++])!=null;){y=na.exec(z);E="";if(y){E=y[0];z=z.replace(na,"")}if(z==="hover")g.push("mouseenter"+E,"mouseleave"+E);else{H=z;if(z==="focus"||z==="blur"){g.push(Oa[z]+E);z+=E}else z=(Oa[z]||z)+E;b==="live"?R.each(function(){d.event.add(this,i(z,O),{data:n,selector:O,handler:m,origType:z,origHandler:m,preType:H})}):R.unbind(i(z,O),m)}}return this}});d.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,b){d.fn[b]=function(g){return g?this.bind(b,g):this.trigger(b)};if(d.attrFn)d.attrFn[b]=true});window.attachEvent&&!window.addEventListener&&window.attachEvent("onunload",function(){for(var a in d.cache)if(d.cache[a].handle)try{d.event.remove(d.cache[a].handle.elem)}catch(b){}});(function(){function a(s){for(var x="",F,G=0;s[G];G++){F=s[G];if(F.nodeType===3||F.nodeType===4)x+=F.nodeValue;else if(F.nodeType!==8)x+=a(F.childNodes)}return x}function b(s,x,F,G,N,M){N=0;for(var S=G.length;N<
S;N++){var Q=G[N];if(Q){Q=Q[s];for(var V=false;Q;){if(Q.sizcache===F){V=G[Q.sizset];break}if(Q.nodeType===1&&!M){Q.sizcache=F;Q.sizset=N}if(Q.nodeName.toLowerCase()===x){V=Q;break}Q=Q[s]}G[N]=V}}}function g(s,x,F,G,N,M){N=0;for(var S=G.length;N<S;N++){var Q=G[N];if(Q){Q=Q[s];for(var V=false;Q;){if(Q.sizcache===F){V=G[Q.sizset];break}if(Q.nodeType===1){if(!M){Q.sizcache=F;Q.sizset=N}if(typeof x!=="string"){if(Q===x){V=true;break}}else if(E.filter(x,[Q]).length>0){V=Q;break}}Q=Q[s]}G[N]=V}}}var n=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
m=0,y=Object.prototype.toString,z=false,I=true;[0,0].sort(function(){I=false;return 0});var E=function(s,x,F,G){F=F||[];var N=x=x||l;if(x.nodeType!==1&&x.nodeType!==9)return[];if(!s||typeof s!=="string")return F;for(var M=[],S,Q,V,pa,ha=true,la=T(x),ia=s;(n.exec(""),S=n.exec(ia))!==null;){ia=S[3];M.push(S[1]);if(S[2]){pa=S[3];break}}if(M.length>1&&O.exec(s))if(M.length===2&&H.relative[M[0]])Q=xa(M[0]+M[1],x);else for(Q=H.relative[M[0]]?[x]:E(M.shift(),x);M.length;){s=M.shift();if(H.relative[s])s+=
M.shift();Q=xa(s,Q)}else{if(!G&&M.length>1&&x.nodeType===9&&!la&&H.match.ID.test(M[0])&&!H.match.ID.test(M[M.length-1])){S=E.find(M.shift(),x,la);x=S.expr?E.filter(S.expr,S.set)[0]:S.set[0]}if(x){S=G?{expr:M.pop(),set:W(G)}:E.find(M.pop(),M.length===1&&(M[0]==="~"||M[0]==="+")&&x.parentNode?x.parentNode:x,la);Q=S.expr?E.filter(S.expr,S.set):S.set;if(M.length>0)V=W(Q);else ha=false;for(;M.length;){var ca=M.pop();S=ca;if(H.relative[ca])S=M.pop();else ca="";if(S==null)S=x;H.relative[ca](V,S,la)}}else V=
[]}V||(V=Q);V||E.error(ca||s);if(y.call(V)==="[object Array]")if(ha)if(x&&x.nodeType===1)for(s=0;V[s]!=null;s++){if(V[s]&&(V[s]===true||V[s].nodeType===1&&da(x,V[s])))F.push(Q[s])}else for(s=0;V[s]!=null;s++)V[s]&&V[s].nodeType===1&&F.push(Q[s]);else F.push.apply(F,V);else W(V,F);if(pa){E(pa,N,F,G);E.uniqueSort(F)}return F};E.uniqueSort=function(s){if(Y){z=I;s.sort(Y);if(z)for(var x=1;x<s.length;x++)s[x]===s[x-1]&&s.splice(x--,1)}return s};E.matches=function(s,x){return E(s,null,null,x)};E.find=function(s,
x,F){var G,N;if(!s)return[];for(var M=0,S=H.order.length;M<S;M++){var Q=H.order[M];if(N=H.leftMatch[Q].exec(s)){var V=N[1];N.splice(1,1);if(V.substr(V.length-1)!=="\\"){N[1]=(N[1]||"").replace(/\\/g,"");G=H.find[Q](N,x,F);if(G!=null){s=s.replace(H.match[Q],"");break}}}}G||(G=x.getElementsByTagName("*"));return{set:G,expr:s}};E.filter=function(s,x,F,G){for(var N=s,M=[],S=x,Q,V,pa=x&&x[0]&&T(x[0]);s&&x.length;){for(var ha in H.filter)if((Q=H.leftMatch[ha].exec(s))!=null&&Q[2]){var la=H.filter[ha],ia,
ca;ca=Q[1];V=false;Q.splice(1,1);if(ca.substr(ca.length-1)!=="\\"){if(S===M)M=[];if(H.preFilter[ha])if(Q=H.preFilter[ha](Q,S,F,M,G,pa)){if(Q===true)continue}else V=ia=true;if(Q)for(var qa=0;(ca=S[qa])!=null;qa++)if(ca){ia=la(ca,Q,qa,S);var Pa=G^!!ia;if(F&&ia!=null)if(Pa)V=true;else S[qa]=false;else if(Pa){M.push(ca);V=true}}if(ia!==undefined){F||(S=M);s=s.replace(H.match[ha],"");if(!V)return[];break}}}if(s===N)if(V==null)E.error(s);else break;N=s}return S};E.error=function(s){throw"Syntax error, unrecognized expression: "+
s;};var H=E.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},
leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(s){return s.getAttribute("href")}},relative:{"+":function(s,x){var F=typeof x==="string",G=F&&!/\W/.test(x);F=F&&!G;if(G)x=x.toLowerCase();G=0;for(var N=s.length,M;G<N;G++)if(M=s[G]){for(;(M=M.previousSibling)&&M.nodeType!==1;);s[G]=F||M&&M.nodeName.toLowerCase()===x?M||false:M===x}F&&E.filter(x,s,true)},">":function(s,x){var F=typeof x==="string";if(F&&!/\W/.test(x)){x=x.toLowerCase();for(var G=0,N=s.length;G<N;G++){var M=
s[G];if(M){F=M.parentNode;s[G]=F.nodeName.toLowerCase()===x?F:false}}}else{G=0;for(N=s.length;G<N;G++)if(M=s[G])s[G]=F?M.parentNode:M.parentNode===x;F&&E.filter(x,s,true)}},"":function(s,x,F){var G=m++,N=g;if(typeof x==="string"&&!/\W/.test(x)){var M=x=x.toLowerCase();N=b}N("parentNode",x,G,s,M,F)},"~":function(s,x,F){var G=m++,N=g;if(typeof x==="string"&&!/\W/.test(x)){var M=x=x.toLowerCase();N=b}N("previousSibling",x,G,s,M,F)}},find:{ID:function(s,x,F){if(typeof x.getElementById!=="undefined"&&
!F)return(s=x.getElementById(s[1]))?[s]:[]},NAME:function(s,x){if(typeof x.getElementsByName!=="undefined"){var F=[];x=x.getElementsByName(s[1]);for(var G=0,N=x.length;G<N;G++)x[G].getAttribute("name")===s[1]&&F.push(x[G]);return F.length===0?null:F}},TAG:function(s,x){return x.getElementsByTagName(s[1])}},preFilter:{CLASS:function(s,x,F,G,N,M){s=" "+s[1].replace(/\\/g,"")+" ";if(M)return s;M=0;for(var S;(S=x[M])!=null;M++)if(S)if(N^(S.className&&(" "+S.className+" ").replace(/[\t\n]/g," ").indexOf(s)>=
0))F||G.push(S);else if(F)x[M]=false;return false},ID:function(s){return s[1].replace(/\\/g,"")},TAG:function(s){return s[1].toLowerCase()},CHILD:function(s){if(s[1]==="nth"){var x=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(s[2]==="even"&&"2n"||s[2]==="odd"&&"2n+1"||!/\D/.test(s[2])&&"0n+"+s[2]||s[2]);s[2]=x[1]+(x[2]||1)-0;s[3]=x[3]-0}s[0]=m++;return s},ATTR:function(s,x,F,G,N,M){x=s[1].replace(/\\/g,"");if(!M&&H.attrMap[x])s[1]=H.attrMap[x];if(s[2]==="~=")s[4]=" "+s[4]+" ";return s},PSEUDO:function(s,x,F,G,
N){if(s[1]==="not")if((n.exec(s[3])||"").length>1||/^\w/.test(s[3]))s[3]=E(s[3],null,null,x);else{s=E.filter(s[3],x,F,true^N);F||G.push.apply(G,s);return false}else if(H.match.POS.test(s[0])||H.match.CHILD.test(s[0]))return true;return s},POS:function(s){s.unshift(true);return s}},filters:{enabled:function(s){return s.disabled===false&&s.type!=="hidden"},disabled:function(s){return s.disabled===true},checked:function(s){return s.checked===true},selected:function(s){return s.selected===true},parent:function(s){return!!s.firstChild},
empty:function(s){return!s.firstChild},has:function(s,x,F){return!!E(F[3],s).length},header:function(s){return/h\d/i.test(s.nodeName)},text:function(s){return"text"===s.type},radio:function(s){return"radio"===s.type},checkbox:function(s){return"checkbox"===s.type},file:function(s){return"file"===s.type},password:function(s){return"password"===s.type},submit:function(s){return"submit"===s.type},image:function(s){return"image"===s.type},reset:function(s){return"reset"===s.type},button:function(s){return"button"===
s.type||s.nodeName.toLowerCase()==="button"},input:function(s){return/input|select|textarea|button/i.test(s.nodeName)}},setFilters:{first:function(s,x){return x===0},last:function(s,x,F,G){return x===G.length-1},even:function(s,x){return x%2===0},odd:function(s,x){return x%2===1},lt:function(s,x,F){return x<F[3]-0},gt:function(s,x,F){return x>F[3]-0},nth:function(s,x,F){return F[3]-0===x},eq:function(s,x,F){return F[3]-0===x}},filter:{PSEUDO:function(s,x,F,G){var N=x[1],M=H.filters[N];if(M)return M(s,
F,x,G);else if(N==="contains")return(s.textContent||s.innerText||a([s])||"").indexOf(x[3])>=0;else if(N==="not"){x=x[3];F=0;for(G=x.length;F<G;F++)if(x[F]===s)return false;return true}else E.error("Syntax error, unrecognized expression: "+N)},CHILD:function(s,x){var F=x[1],G=s;switch(F){case "only":case "first":for(;G=G.previousSibling;)if(G.nodeType===1)return false;if(F==="first")return true;G=s;case "last":for(;G=G.nextSibling;)if(G.nodeType===1)return false;return true;case "nth":F=x[2];var N=
x[3];if(F===1&&N===0)return true;x=x[0];var M=s.parentNode;if(M&&(M.sizcache!==x||!s.nodeIndex)){var S=0;for(G=M.firstChild;G;G=G.nextSibling)if(G.nodeType===1)G.nodeIndex=++S;M.sizcache=x}s=s.nodeIndex-N;return F===0?s===0:s%F===0&&s/F>=0}},ID:function(s,x){return s.nodeType===1&&s.getAttribute("id")===x},TAG:function(s,x){return x==="*"&&s.nodeType===1||s.nodeName.toLowerCase()===x},CLASS:function(s,x){return(" "+(s.className||s.getAttribute("class"))+" ").indexOf(x)>-1},ATTR:function(s,x){var F=
x[1];s=H.attrHandle[F]?H.attrHandle[F](s):s[F]!=null?s[F]:s.getAttribute(F);F=s+"";var G=x[2];x=x[4];return s==null?G==="!=":G==="="?F===x:G==="*="?F.indexOf(x)>=0:G==="~="?(" "+F+" ").indexOf(x)>=0:!x?F&&s!==false:G==="!="?F!==x:G==="^="?F.indexOf(x)===0:G==="$="?F.substr(F.length-x.length)===x:G==="|="?F===x||F.substr(0,x.length+1)===x+"-":false},POS:function(s,x,F,G){var N=H.setFilters[x[2]];if(N)return N(s,F,x,G)}}},O=H.match.POS;for(var R in H.match){H.match[R]=new RegExp(H.match[R].source+/(?![^\[]*\])(?![^\(]*\))/.source);
H.leftMatch[R]=new RegExp(/(^(?:.|\r|\n)*?)/.source+H.match[R].source.replace(/\\(\d+)/g,function(s,x){return"\\"+(x-0+1)}))}var W=function(s,x){s=Array.prototype.slice.call(s,0);if(x){x.push.apply(x,s);return x}return s};try{Array.prototype.slice.call(l.documentElement.childNodes,0)}catch(Z){W=function(s,x){x=x||[];if(y.call(s)==="[object Array]")Array.prototype.push.apply(x,s);else if(typeof s.length==="number")for(var F=0,G=s.length;F<G;F++)x.push(s[F]);else for(F=0;s[F];F++)x.push(s[F]);return x}}var Y;
if(l.documentElement.compareDocumentPosition)Y=function(s,x){if(!s.compareDocumentPosition||!x.compareDocumentPosition){if(s==x)z=true;return s.compareDocumentPosition?-1:1}s=s.compareDocumentPosition(x)&4?-1:s===x?0:1;if(s===0)z=true;return s};else if("sourceIndex"in l.documentElement)Y=function(s,x){if(!s.sourceIndex||!x.sourceIndex){if(s==x)z=true;return s.sourceIndex?-1:1}s=s.sourceIndex-x.sourceIndex;if(s===0)z=true;return s};else if(l.createRange)Y=function(s,x){if(!s.ownerDocument||!x.ownerDocument){if(s==
x)z=true;return s.ownerDocument?-1:1}var F=s.ownerDocument.createRange(),G=x.ownerDocument.createRange();F.setStart(s,0);F.setEnd(s,0);G.setStart(x,0);G.setEnd(x,0);s=F.compareBoundaryPoints(Range.START_TO_END,G);if(s===0)z=true;return s};(function(){var s=l.createElement("div"),x="script"+(new Date).getTime();s.innerHTML="<a name='"+x+"'/>";var F=l.documentElement;F.insertBefore(s,F.firstChild);if(l.getElementById(x)){H.find.ID=function(G,N,M){if(typeof N.getElementById!=="undefined"&&!M)return(N=
N.getElementById(G[1]))?N.id===G[1]||typeof N.getAttributeNode!=="undefined"&&N.getAttributeNode("id").nodeValue===G[1]?[N]:undefined:[]};H.filter.ID=function(G,N){var M=typeof G.getAttributeNode!=="undefined"&&G.getAttributeNode("id");return G.nodeType===1&&M&&M.nodeValue===N}}F.removeChild(s);F=s=null})();(function(){var s=l.createElement("div");s.appendChild(l.createComment(""));if(s.getElementsByTagName("*").length>0)H.find.TAG=function(x,F){F=F.getElementsByTagName(x[1]);if(x[1]==="*"){x=[];
for(var G=0;F[G];G++)F[G].nodeType===1&&x.push(F[G]);F=x}return F};s.innerHTML="<a href='#'></a>";if(s.firstChild&&typeof s.firstChild.getAttribute!=="undefined"&&s.firstChild.getAttribute("href")!=="#")H.attrHandle.href=function(x){return x.getAttribute("href",2)};s=null})();l.querySelectorAll&&function(){var s=E,x=l.createElement("div");x.innerHTML="<p class='TEST'></p>";if(!(x.querySelectorAll&&x.querySelectorAll(".TEST").length===0)){E=function(G,N,M,S){N=N||l;if(!S&&N.nodeType===9&&!T(N))try{return W(N.querySelectorAll(G),
M)}catch(Q){}return s(G,N,M,S)};for(var F in s)E[F]=s[F];x=null}}();(function(){var s=l.createElement("div");s.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!s.getElementsByClassName||s.getElementsByClassName("e").length===0)){s.lastChild.className="e";if(s.getElementsByClassName("e").length!==1){H.order.splice(1,0,"CLASS");H.find.CLASS=function(x,F,G){if(typeof F.getElementsByClassName!=="undefined"&&!G)return F.getElementsByClassName(x[1])};s=null}}})();var da=l.compareDocumentPosition?
function(s,x){return!!(s.compareDocumentPosition(x)&16)}:function(s,x){return s!==x&&(s.contains?s.contains(x):true)},T=function(s){return(s=(s?s.ownerDocument||s:0).documentElement)?s.nodeName!=="HTML":false},xa=function(s,x){var F=[],G="",N;for(x=x.nodeType?[x]:x;N=H.match.PSEUDO.exec(s);){G+=N[0];s=s.replace(H.match.PSEUDO,"")}s=H.relative[s]?s+"*":s;N=0;for(var M=x.length;N<M;N++)E(s,x[N],F);return E.filter(G,F)};d.find=E;d.expr=E.selectors;d.expr[":"]=d.expr.filters;d.unique=E.uniqueSort;d.text=
a;d.isXMLDoc=T;d.contains=da})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,gb=/,/;oa=Array.prototype.slice;var Qa=function(a,b,g){if(d.isFunction(b))return d.grep(a,function(m,y){return!!b.call(m,y,m)===g});else if(b.nodeType)return d.grep(a,function(m){return m===b===g});else if(typeof b==="string"){var n=d.grep(a,function(m){return m.nodeType===1});if(J.test(b))return d.filter(b,n,!g);else b=d.filter(b,n)}return d.grep(a,function(m){return d.inArray(m,b)>=0===g})};d.fn.extend({find:function(a){for(var b=
this.pushStack("","find",a),g=0,n=0,m=this.length;n<m;n++){g=b.length;d.find(a,this[n],b);if(n>0)for(var y=g;y<b.length;y++)for(var z=0;z<g;z++)if(b[z]===b[y]){b.splice(y--,1);break}}return b},has:function(a){var b=d(a);return this.filter(function(){for(var g=0,n=b.length;g<n;g++)if(d.contains(this,b[g]))return true})},not:function(a){return this.pushStack(Qa(this,a,false),"not",a)},filter:function(a){return this.pushStack(Qa(this,a,true),"filter",a)},is:function(a){return!!a&&d.filter(a,this).length>
0},closest:function(a,b){if(d.isArray(a)){var g=[],n=this[0],m,y={},z;if(n&&a.length){m=0;for(var I=a.length;m<I;m++){z=a[m];y[z]||(y[z]=d.expr.match.POS.test(z)?d(z,b||this.context):z)}for(;n&&n.ownerDocument&&n!==b;){for(z in y){m=y[z];if(m.jquery?m.index(n)>-1:d(n).is(m)){g.push({selector:z,elem:n});delete y[z]}}n=n.parentNode}}return g}var E=d.expr.match.POS.test(a)?d(a,b||this.context):null;return this.map(function(H,O){for(;O&&O.ownerDocument&&O!==b;){if(E?E.index(O)>-1:d(O).is(a))return O;
O=O.parentNode}return null})},index:function(a){if(!a||typeof a==="string")return d.inArray(this[0],a?d(a):this.parent().children());return d.inArray(a.jquery?a[0]:a,this)},add:function(a,b){a=typeof a==="string"?d(a,b||this.context):d.makeArray(a);b=d.merge(this.get(),a);return this.pushStack(j(a[0])||j(b[0])?b:d.unique(b))},andSelf:function(){return this.add(this.prevObject)}});d.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return d.dir(a,"parentNode")},
parentsUntil:function(a,b,g){return d.dir(a,"parentNode",g)},next:function(a){return d.nth(a,2,"nextSibling")},prev:function(a){return d.nth(a,2,"previousSibling")},nextAll:function(a){return d.dir(a,"nextSibling")},prevAll:function(a){return d.dir(a,"previousSibling")},nextUntil:function(a,b,g){return d.dir(a,"nextSibling",g)},prevUntil:function(a,b,g){return d.dir(a,"previousSibling",g)},siblings:function(a){return d.sibling(a.parentNode.firstChild,a)},children:function(a){return d.sibling(a.firstChild)},
contents:function(a){return d.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:d.makeArray(a.childNodes)}},function(a,b){d.fn[a]=function(g,n){var m=d.map(this,b,g);eb.test(a)||(n=g);if(n&&typeof n==="string")m=d.filter(n,m);m=this.length>1?d.unique(m):m;if((this.length>1||gb.test(n))&&fb.test(a))m=m.reverse();return this.pushStack(m,a,oa.call(arguments).join(","))}});d.extend({filter:function(a,b,g){if(g)a=":not("+a+")";return d.find.matches(a,b)},dir:function(a,b,g){var n=[];for(a=
a[b];a&&a.nodeType!==9&&(g===undefined||a.nodeType!==1||!d(a).is(g));){a.nodeType===1&&n.push(a);a=a[b]}return n},nth:function(a,b,g){b=b||1;for(var n=0;a;a=a[g])if(a.nodeType===1&&++n===b)break;return a},sibling:function(a,b){for(var g=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&g.push(a);return g}});var Ra=/ jQuery\d+="(?:\d+|null)"/g,ra=/^\s+/,Sa=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,Ta=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,Da=/<script|<object|<embed|<option|<style/i,
Ea=/checked\s*(?:[^=]|=\s*.checked.)/i,Ua=function(a,b,g){return hb.test(g)?a:b+"></"+g+">"},ea={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};ea.optgroup=ea.option;ea.tbody=ea.tfoot=ea.colgroup=ea.caption=ea.thead;ea.th=
ea.td;if(!d.support.htmlSerialize)ea._default=[1,"div<div>","</div>"];d.fn.extend({text:function(a){if(d.isFunction(a))return this.each(function(b){var g=d(this);g.text(a.call(this,b,g.text()))});if(typeof a!=="object"&&a!==undefined)return this.empty().append((this[0]&&this[0].ownerDocument||l).createTextNode(a));return d.text(this)},wrapAll:function(a){if(d.isFunction(a))return this.each(function(g){d(this).wrapAll(a.call(this,g))});if(this[0]){var b=d(a,this[0].ownerDocument).eq(0).clone(true);
this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var g=this;g.firstChild&&g.firstChild.nodeType===1;)g=g.firstChild;return g}).append(this)}return this},wrapInner:function(a){if(d.isFunction(a))return this.each(function(b){d(this).wrapInner(a.call(this,b))});return this.each(function(){var b=d(this),g=b.contents();g.length?g.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){d(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){d.nodeName(this,
"body")||d(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=d(arguments[0]);a.push.apply(a,this.toArray());
return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,d(arguments[0]).toArray());return a}},remove:function(a,b){for(var g=0,n;(n=this[g])!=null;g++)if(!a||d.filter(a,[n]).length){if(!b&&n.nodeType===1){d.cleanData(n.getElementsByTagName("*"));d.cleanData([n])}n.parentNode&&
n.parentNode.removeChild(n)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&d.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(a){var b=this.map(function(){if(!d.support.noCloneEvent&&!d.isXMLDoc(this)){var g=this.outerHTML,n=this.ownerDocument;if(!g){g=n.createElement("div");g.appendChild(this.cloneNode(true));g=g.innerHTML}return d.clean([g.replace(Ra,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(ra,
"")],n)[0]}else return this.cloneNode(true)});if(a===true){q(this,b);q(this.find("*"),b.find("*"))}return b},html:function(a){if(a===undefined)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ra,""):null;else if(typeof a==="string"&&!Da.test(a)&&(d.support.leadingWhitespace||!ra.test(a))&&!ea[(Ta.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Sa,Ua);try{for(var b=0,g=this.length;b<g;b++)if(this[b].nodeType===1){d.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(n){this.empty().append(a)}}else d.isFunction(a)?
this.each(function(m){var y=d(this),z=y.html();y.empty().append(function(){return a.call(this,m,z)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(d.isFunction(a))return this.each(function(b){var g=d(this),n=g.html();g.replaceWith(a.call(this,b,n))});if(typeof a!=="string")a=d(a).detach();return this.each(function(){var b=this.nextSibling,g=this.parentNode;d(this).remove();b?d(b).before(a):d(g).append(a)})}else return this.pushStack(d(d.isFunction(a)?
a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,g){function n(R){return d.nodeName(R,"table")?R.getElementsByTagName("tbody")[0]||R.appendChild(R.ownerDocument.createElement("tbody")):R}var m,y,z=a[0],I=[],E;if(!d.support.checkClone&&arguments.length===3&&typeof z==="string"&&Ea.test(z))return this.each(function(){d(this).domManip(a,b,g,true)});if(d.isFunction(z))return this.each(function(R){var W=d(this);a[0]=z.call(this,R,b?W.html():undefined);W.domManip(a,
b,g)});if(this[0]){m=z&&z.parentNode;m=d.support.parentNode&&m&&m.nodeType===11&&m.childNodes.length===this.length?{fragment:m}:r(a,this,I);E=m.fragment;if(y=E.childNodes.length===1?(E=E.firstChild):E.firstChild){b=b&&d.nodeName(y,"tr");for(var H=0,O=this.length;H<O;H++)g.call(b?n(this[H],y):this[H],H>0||m.cacheable||this.length>1?E.cloneNode(true):E)}I.length&&d.each(I,t)}return this}});d.fragments={};d.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},
function(a,b){d.fn[a]=function(g){var n=[];g=d(g);var m=this.length===1&&this[0].parentNode;if(m&&m.nodeType===11&&m.childNodes.length===1&&g.length===1){g[b](this[0]);return this}else{m=0;for(var y=g.length;m<y;m++){var z=(m>0?this.clone(true):this).get();d.fn[b].apply(d(g[m]),z);n=n.concat(z)}return this.pushStack(n,a,g.selector)}}});d.extend({clean:function(a,b,g,n){b=b||l;if(typeof b.createElement==="undefined")b=b.ownerDocument||b[0]&&b[0].ownerDocument||l;for(var m=[],y=0,z;(z=a[y])!=null;y++){if(typeof z===
"number")z+="";if(z){if(typeof z==="string"&&!jb.test(z))z=b.createTextNode(z);else if(typeof z==="string"){z=z.replace(Sa,Ua);var I=(Ta.exec(z)||["",""])[1].toLowerCase(),E=ea[I]||ea._default,H=E[0],O=b.createElement("div");for(O.innerHTML=E[1]+z+E[2];H--;)O=O.lastChild;if(!d.support.tbody){H=ib.test(z);I=I==="table"&&!H?O.firstChild&&O.firstChild.childNodes:E[1]==="<table>"&&!H?O.childNodes:[];for(E=I.length-1;E>=0;--E)d.nodeName(I[E],"tbody")&&!I[E].childNodes.length&&I[E].parentNode.removeChild(I[E])}!d.support.leadingWhitespace&&
ra.test(z)&&O.insertBefore(b.createTextNode(ra.exec(z)[0]),O.firstChild);z=O.childNodes}if(z.nodeType)m.push(z);else m=d.merge(m,z)}}if(g)for(y=0;m[y];y++)if(n&&d.nodeName(m[y],"script")&&(!m[y].type||m[y].type.toLowerCase()==="text/javascript"))n.push(m[y].parentNode?m[y].parentNode.removeChild(m[y]):m[y]);else{m[y].nodeType===1&&m.splice.apply(m,[y+1,0].concat(d.makeArray(m[y].getElementsByTagName("script"))));g.appendChild(m[y])}return m},cleanData:function(a){for(var b,g,n=d.cache,m=d.event.special,
y=d.support.deleteExpando,z=0,I;(I=a[z])!=null;z++)if(g=I[d.expando]){b=n[g];if(b.events)for(var E in b.events)m[E]?d.event.remove(I,E):Ka(I,E,b.handle);if(y)delete I[d.expando];else I.removeAttribute&&I.removeAttribute(d.expando);delete n[g]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Va=/alpha\([^)]*\)/,Wa=/opacity=([^)]*)/,ya=/float/i,za=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],
qb=["Top","Bottom"],rb=l.defaultView&&l.defaultView.getComputedStyle,Xa=d.support.cssFloat?"cssFloat":"styleFloat",Aa=function(a,b){return b.toUpperCase()};d.fn.css=function(a,b){return p(this,a,b,true,function(g,n,m){if(m===undefined)return d.curCSS(g,n);if(typeof m==="number"&&!kb.test(n))m+="px";d.style(g,n,m)})};d.extend({style:function(a,b,g){if(!(!a||a.nodeType===3||a.nodeType===8)){if((b==="width"||b==="height")&&parseFloat(g)<0)g=undefined;var n=a.style||a,m=g!==undefined;if(!d.support.opacity&&
b==="opacity"){if(m){n.zoom=1;b=parseInt(g,10)+""==="NaN"?"":"alpha(opacity="+g*100+")";a=n.filter||d.curCSS(a,"filter")||"";n.filter=Va.test(a)?a.replace(Va,b):b}return n.filter&&n.filter.indexOf("opacity=")>=0?parseFloat(Wa.exec(n.filter)[1])/100+"":""}if(ya.test(b))b=Xa;b=b.replace(za,Aa);if(m)n[b]=g;return n[b]}},css:function(a,b,g,n){if(b==="width"||b==="height"){var m,y=b==="width"?pb:qb;g=function(){m=b==="width"?a.offsetWidth:a.offsetHeight;n!=="border"&&d.each(y,function(){n||(m-=parseFloat(d.curCSS(a,
"padding"+this,true))||0);if(n==="margin")m+=parseFloat(d.curCSS(a,"margin"+this,true))||0;else m-=parseFloat(d.curCSS(a,"border"+this+"Width",true))||0})};a.offsetWidth!==0?g():d.swap(a,ob,g);return Math.max(0,Math.round(m))}return d.curCSS(a,b,g)},curCSS:function(a,b,g){var n,m=a.style;if(!d.support.opacity&&b==="opacity"&&a.currentStyle){n=Wa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return n===""?"1":n}if(ya.test(b))b=Xa;if(!g&&m&&m[b])n=m[b];else if(rb){if(ya.test(b))b=
"float";b=b.replace(lb,"-$1").toLowerCase();m=a.ownerDocument.defaultView;if(!m)return null;if(a=m.getComputedStyle(a,null))n=a.getPropertyValue(b);if(b==="opacity"&&n==="")n="1"}else if(a.currentStyle){g=b.replace(za,Aa);n=a.currentStyle[b]||a.currentStyle[g];if(!mb.test(n)&&nb.test(n)){b=m.left;var y=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;m.left=g==="fontSize"?"1em":n||0;n=m.pixelLeft+"px";m.left=b;a.runtimeStyle.left=y}}return n},swap:function(a,b,g){var n={};for(var m in b){n[m]=
a.style[m];a.style[m]=b[m]}g.call(a);for(m in b)a.style[m]=n[m]}});if(d.expr&&d.expr.filters){d.expr.filters.hidden=function(a){var b=a.offsetWidth,g=a.offsetHeight,n=a.nodeName.toLowerCase()==="tr";return b===0&&g===0&&!n?true:b>0&&g>0&&!n?false:d.curCSS(a,"display")==="none"};d.expr.filters.visible=function(a){return!d.expr.filters.hidden(a)}}var sb=k(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,
ma=/=\?(&|$)/,Ba=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=d.fn.load;d.fn.extend({load:function(a,b,g){if(typeof a!=="string")return zb.call(this,a);else if(!this.length)return this;var n=a.indexOf(" ");if(n>=0){var m=a.slice(n,a.length);a=a.slice(0,n)}n="GET";if(b)if(d.isFunction(b)){g=b;b=null}else if(typeof b==="object"){b=d.param(b,d.ajaxSettings.traditional);n="POST"}var y=this;d.ajax({url:a,type:n,dataType:"html",data:b,complete:function(z,I){if(I==="success"||I===
"notmodified")y.html(m?d("<div />").append(z.responseText.replace(tb,"")).find(m):z.responseText);g&&y.each(g,[z.responseText,I,z])}});return this},serialize:function(){return d.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?d.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,b){a=d(this).val();return a==null?null:d.isArray(a)?d.map(a,
function(g){return{name:b.name,value:g}}):{name:b.name,value:a}}).get()}});d.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){d.fn[b]=function(g){return this.bind(b,g)}});d.extend({get:function(a,b,g,n){if(d.isFunction(b)){n=n||g;g=b;b=null}return d.ajax({type:"GET",url:a,data:b,success:g,dataType:n})},getScript:function(a,b){return d.get(a,null,b,"script")},getJSON:function(a,b,g){return d.get(a,b,g,"json")},post:function(a,b,g,n){if(d.isFunction(b)){n=
n||g;g=b;b={}}return d.ajax({type:"POST",url:a,data:b,success:g,dataType:n})},ajaxSetup:function(a){d.extend(d.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",
html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function b(){m.success&&m.success.call(E,I,z,T);m.global&&n("ajaxSuccess",[T,m])}function g(){m.complete&&m.complete.call(E,T,z);m.global&&n("ajaxComplete",[T,m]);m.global&&!--d.active&&d.event.trigger("ajaxStop")}function n(N,M){(m.context?d(m.context):d.event).trigger(N,M)}var m=d.extend(true,{},d.ajaxSettings,a),y,
z,I,E=a&&a.context||m,H=m.type.toUpperCase();if(m.data&&m.processData&&typeof m.data!=="string")m.data=d.param(m.data,m.traditional);if(m.dataType==="jsonp"){if(H==="GET")ma.test(m.url)||(m.url+=(Ba.test(m.url)?"&":"?")+(m.jsonp||"callback")+"=?");else if(!m.data||!ma.test(m.data))m.data=(m.data?m.data+"&":"")+(m.jsonp||"callback")+"=?";m.dataType="json"}if(m.dataType==="json"&&(m.data&&ma.test(m.data)||ma.test(m.url))){y=m.jsonpCallback||"jsonp"+sb++;if(m.data)m.data=(m.data+"").replace(ma,"="+y+
"$1");m.url=m.url.replace(ma,"="+y+"$1");m.dataType="script";window[y]=window[y]||function(N){I=N;b();g();window[y]=undefined;try{delete window[y]}catch(M){}W&&W.removeChild(Z)}}if(m.dataType==="script"&&m.cache===null)m.cache=false;if(m.cache===false&&H==="GET"){var O=k(),R=m.url.replace(wb,"$1_="+O+"$2");m.url=R+(R===m.url?(Ba.test(m.url)?"&":"?")+"_="+O:"")}if(m.data&&H==="GET")m.url+=(Ba.test(m.url)?"&":"?")+m.data;m.global&&!d.active++&&d.event.trigger("ajaxStart");O=(O=xb.exec(m.url))&&(O[1]&&
O[1]!==location.protocol||O[2]!==location.host);if(m.dataType==="script"&&H==="GET"&&O){var W=l.getElementsByTagName("head")[0]||l.documentElement,Z=l.createElement("script");Z.src=m.url;if(m.scriptCharset)Z.charset=m.scriptCharset;if(!y){var Y=false;Z.onload=Z.onreadystatechange=function(){if(!Y&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){Y=true;b();g();Z.onload=Z.onreadystatechange=null;W&&Z.parentNode&&W.removeChild(Z)}}}W.insertBefore(Z,W.firstChild)}else{var da=
false,T=m.xhr();if(T){m.username?T.open(H,m.url,m.async,m.username,m.password):T.open(H,m.url,m.async);try{if(m.data||a&&a.contentType)T.setRequestHeader("Content-Type",m.contentType);if(m.ifModified){d.lastModified[m.url]&&T.setRequestHeader("If-Modified-Since",d.lastModified[m.url]);d.etag[m.url]&&T.setRequestHeader("If-None-Match",d.etag[m.url])}O||T.setRequestHeader("X-Requested-With","XMLHttpRequest");T.setRequestHeader("Accept",m.dataType&&m.accepts[m.dataType]?m.accepts[m.dataType]+", */*":
m.accepts._default)}catch(xa){}if(m.beforeSend&&m.beforeSend.call(E,T,m)===false){m.global&&!--d.active&&d.event.trigger("ajaxStop");T.abort();return false}m.global&&n("ajaxSend",[T,m]);var s=T.onreadystatechange=function(N){if(!T||T.readyState===0||N==="abort"){da||g();da=true;if(T)T.onreadystatechange=d.noop}else if(!da&&T&&(T.readyState===4||N==="timeout")){da=true;T.onreadystatechange=d.noop;z=N==="timeout"?"timeout":!d.httpSuccess(T)?"error":m.ifModified&&d.httpNotModified(T,m.url)?"notmodified":
"success";var M;if(z==="success")try{I=d.httpData(T,m.dataType,m)}catch(S){z="parsererror";M=S}if(z==="success"||z==="notmodified")y||b();else d.handleError(m,T,z,M);g();N==="timeout"&&T.abort();if(m.async)T=null}};try{var x=T.abort;T.abort=function(){T&&x.call(T);s("abort")}}catch(F){}m.async&&m.timeout>0&&setTimeout(function(){T&&!da&&s("timeout")},m.timeout);try{T.send(H==="POST"||H==="PUT"||H==="DELETE"?m.data:null)}catch(G){d.handleError(m,T,null,G);g()}m.async||s();return T}}},handleError:function(a,
b,g,n){if(a.error)a.error.call(a.context||a,b,g,n);if(a.global)(a.context?d(a.context):d.event).trigger("ajaxError",[b,a,n])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223||a.status===0}catch(b){}return false},httpNotModified:function(a,b){var g=a.getResponseHeader("Last-Modified"),n=a.getResponseHeader("Etag");if(g)d.lastModified[b]=g;if(n)d.etag[b]=n;return a.status===304||a.status===0},httpData:function(a,
b,g){var n=a.getResponseHeader("content-type")||"",m=b==="xml"||!b&&n.indexOf("xml")>=0;a=m?a.responseXML:a.responseText;m&&a.documentElement.nodeName==="parsererror"&&d.error("parsererror");if(g&&g.dataFilter)a=g.dataFilter(a,b);if(typeof a==="string")if(b==="json"||!b&&n.indexOf("json")>=0)a=d.parseJSON(a);else if(b==="script"||!b&&n.indexOf("javascript")>=0)d.globalEval(a);return a},param:function(a,b){function g(z,I){if(d.isArray(I))d.each(I,function(E,H){b||/\[\]$/.test(z)?n(z,H):g(z+"["+(typeof H===
"object"||d.isArray(H)?E:"")+"]",H)});else!b&&I!=null&&typeof I==="object"?d.each(I,function(E,H){g(z+"["+E+"]",H)}):n(z,I)}function n(z,I){I=d.isFunction(I)?I():I;m[m.length]=encodeURIComponent(z)+"="+encodeURIComponent(I)}var m=[];if(b===undefined)b=d.ajaxSettings.traditional;if(d.isArray(a)||a.jquery)d.each(a,function(){n(this.name,this.value)});else for(var y in a)g(y,a[y]);return m.join("&").replace(yb,"+")}});var Ca={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,sa,Fa=[["height","marginTop",
"marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];d.fn.extend({show:function(a,b){if(a||a===0)return this.animate(B("show",3),a,b);else{a=0;for(b=this.length;a<b;a++){var g=d.data(this[a],"olddisplay");this[a].style.display=g||"";if(d.css(this[a],"display")==="none"){g=this[a].nodeName;var n;if(Ca[g])n=Ca[g];else{var m=d("<"+g+" />").appendTo("body");n=m.css("display");if(n==="none")n="block";m.remove();Ca[g]=n}d.data(this[a],
"olddisplay",n)}}a=0;for(b=this.length;a<b;a++)this[a].style.display=d.data(this[a],"olddisplay")||"";return this}},hide:function(a,b){if(a||a===0)return this.animate(B("hide",3),a,b);else{a=0;for(b=this.length;a<b;a++){var g=d.data(this[a],"olddisplay");!g&&g!=="none"&&d.data(this[a],"olddisplay",d.css(this[a],"display"))}a=0;for(b=this.length;a<b;a++)this[a].style.display="none";return this}},_toggle:d.fn.toggle,toggle:function(a,b){var g=typeof a==="boolean";if(d.isFunction(a)&&d.isFunction(b))this._toggle.apply(this,
arguments);else a==null||g?this.each(function(){var n=g?a:d(this).is(":hidden");d(this)[n?"show":"hide"]()}):this.animate(B("toggle",3),a,b);return this},fadeTo:function(a,b,g){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,g)},animate:function(a,b,g,n){var m=d.speed(b,g,n);if(d.isEmptyObject(a))return this.each(m.complete);return this[m.queue===false?"each":"queue"](function(){var y=d.extend({},m),z,I=this.nodeType===1&&d(this).is(":hidden"),E=this;for(z in a){var H=
z.replace(za,Aa);if(z!==H){a[H]=a[z];delete a[z];z=H}if(a[z]==="hide"&&I||a[z]==="show"&&!I)return y.complete.call(this);if((z==="height"||z==="width")&&this.style){y.display=d.css(this,"display");y.overflow=this.style.overflow}if(d.isArray(a[z])){(y.specialEasing=y.specialEasing||{})[z]=a[z][1];a[z]=a[z][0]}}if(y.overflow!=null)this.style.overflow="hidden";y.curAnim=d.extend({},a);d.each(a,function(O,R){var W=new d.fx(E,y,O);if(Ab.test(R))W[R==="toggle"?I?"show":"hide":R](a);else{var Z=Bb.exec(R),
Y=W.cur(true)||0;if(Z){R=parseFloat(Z[2]);var da=Z[3]||"px";if(da!=="px"){E.style[O]=(R||1)+da;Y=(R||1)/W.cur(true)*Y;E.style[O]=Y+da}if(Z[1])R=(Z[1]==="-="?-1:1)*R+Y;W.custom(Y,R,da)}else W.custom(Y,R,"")}});return true})},stop:function(a,b){var g=d.timers;a&&this.queue([]);this.each(function(){for(var n=g.length-1;n>=0;n--)if(g[n].elem===this){b&&g[n](true);g.splice(n,1)}});b||this.dequeue();return this}});d.each({slideDown:B("show",1),slideUp:B("hide",1),slideToggle:B("toggle",1),fadeIn:{opacity:"show"},
fadeOut:{opacity:"hide"}},function(a,b){d.fn[a]=function(g,n){return this.animate(b,g,n)}});d.extend({speed:function(a,b,g){var n=a&&typeof a==="object"?a:{complete:g||!g&&b||d.isFunction(a)&&a,duration:a,easing:g&&b||b&&!d.isFunction(b)&&b};n.duration=d.fx.off?0:typeof n.duration==="number"?n.duration:d.fx.speeds[n.duration]||d.fx.speeds._default;n.old=n.complete;n.complete=function(){n.queue!==false&&d(this).dequeue();d.isFunction(n.old)&&n.old.call(this)};return n},easing:{linear:function(a,b,
g,n){return g+n*a},swing:function(a,b,g,n){return(-Math.cos(a*Math.PI)/2+0.5)*n+g}},timers:[],fx:function(a,b,g){this.options=b;this.elem=a;this.prop=g;if(!b.orig)b.orig={}}});d.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(d.fx.step[this.prop]||d.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==
null))return this.elem[this.prop];return(a=parseFloat(d.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(d.curCSS(this.elem,this.prop))||0},custom:function(a,b,g){function n(y){return m.step(y)}this.startTime=k();this.start=a;this.end=b;this.unit=g||this.unit||"px";this.now=this.start;this.pos=this.state=0;var m=this;n.elem=this.elem;if(n()&&d.timers.push(n)&&!sa)sa=setInterval(d.fx.tick,13)},show:function(){this.options.orig[this.prop]=d.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop===
"width"||this.prop==="height"?1:0,this.cur());d(this.elem).show()},hide:function(){this.options.orig[this.prop]=d.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var b=k(),g=true;if(a||b>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var n in this.options.curAnim)if(this.options.curAnim[n]!==true)g=false;if(g){if(this.options.display!=null){this.elem.style.overflow=
this.options.overflow;a=d.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(d.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&d(this.elem).hide();if(this.options.hide||this.options.show)for(var m in this.options.curAnim)d.style(this.elem,m,this.options.orig[m]);this.options.complete.call(this.elem)}return false}else{m=b-this.startTime;this.state=m/this.options.duration;a=this.options.easing||(d.easing.swing?"swing":"linear");this.pos=
d.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,m,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};d.extend(d.fx,{tick:function(){for(var a=d.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||d.fx.stop()},stop:function(){clearInterval(sa);sa=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){d.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=
null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(d.expr&&d.expr.filters)d.expr.filters.animated=function(a){return d.grep(d.timers,function(b){return a===b.elem}).length};d.fn.offset="getBoundingClientRect"in l.documentElement?function(a){var b=this[0];if(a)return this.each(function(m){d.offset.setOffset(this,a,m)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return d.offset.bodyOffset(b);var g=b.getBoundingClientRect(),
n=b.ownerDocument;b=n.body;n=n.documentElement;return{top:g.top+(self.pageYOffset||d.support.boxModel&&n.scrollTop||b.scrollTop)-(n.clientTop||b.clientTop||0),left:g.left+(self.pageXOffset||d.support.boxModel&&n.scrollLeft||b.scrollLeft)-(n.clientLeft||b.clientLeft||0)}}:function(a){var b=this[0];if(a)return this.each(function(O){d.offset.setOffset(this,a,O)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return d.offset.bodyOffset(b);d.offset.initialize();var g=b.offsetParent,n=
b,m=b.ownerDocument,y,z=m.documentElement,I=m.body;n=(m=m.defaultView)?m.getComputedStyle(b,null):b.currentStyle;for(var E=b.offsetTop,H=b.offsetLeft;(b=b.parentNode)&&b!==I&&b!==z;){if(d.offset.supportsFixedPosition&&n.position==="fixed")break;y=m?m.getComputedStyle(b,null):b.currentStyle;E-=b.scrollTop;H-=b.scrollLeft;if(b===g){E+=b.offsetTop;H+=b.offsetLeft;if(d.offset.doesNotAddBorder&&!(d.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(b.nodeName))){E+=parseFloat(y.borderTopWidth)||
0;H+=parseFloat(y.borderLeftWidth)||0}n=g;g=b.offsetParent}if(d.offset.subtractsBorderForOverflowNotVisible&&y.overflow!=="visible"){E+=parseFloat(y.borderTopWidth)||0;H+=parseFloat(y.borderLeftWidth)||0}n=y}if(n.position==="relative"||n.position==="static"){E+=I.offsetTop;H+=I.offsetLeft}if(d.offset.supportsFixedPosition&&n.position==="fixed"){E+=Math.max(z.scrollTop,I.scrollTop);H+=Math.max(z.scrollLeft,I.scrollLeft)}return{top:E,left:H}};d.offset={initialize:function(){var a=l.body,b=l.createElement("div"),
g,n,m,y=parseFloat(d.curCSS(a,"marginTop",true))||0;d.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";a.insertBefore(b,a.firstChild);
g=b.firstChild;n=g.firstChild;m=g.nextSibling.firstChild.firstChild;this.doesNotAddBorder=n.offsetTop!==5;this.doesAddBorderForTableAndCells=m.offsetTop===5;n.style.position="fixed";n.style.top="20px";this.supportsFixedPosition=n.offsetTop===20||n.offsetTop===15;n.style.position=n.style.top="";g.style.overflow="hidden";g.style.position="relative";this.subtractsBorderForOverflowNotVisible=n.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==y;a.removeChild(b);d.offset.initialize=d.noop},
bodyOffset:function(a){var b=a.offsetTop,g=a.offsetLeft;d.offset.initialize();if(d.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(d.curCSS(a,"marginTop",true))||0;g+=parseFloat(d.curCSS(a,"marginLeft",true))||0}return{top:b,left:g}},setOffset:function(a,b,g){if(/static/.test(d.curCSS(a,"position")))a.style.position="relative";var n=d(a),m=n.offset(),y=parseInt(d.curCSS(a,"top",true),10)||0,z=parseInt(d.curCSS(a,"left",true),10)||0;if(d.isFunction(b))b=b.call(a,g,m);g={top:b.top-m.top+y,left:b.left-
m.left+z};"using"in b?b.using.call(a,g):n.css(g)}};d.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),g=this.offset(),n=/^body|html$/i.test(b[0].nodeName)?{top:0,left:0}:b.offset();g.top-=parseFloat(d.curCSS(a,"marginTop",true))||0;g.left-=parseFloat(d.curCSS(a,"marginLeft",true))||0;n.top+=parseFloat(d.curCSS(b[0],"borderTopWidth",true))||0;n.left+=parseFloat(d.curCSS(b[0],"borderLeftWidth",true))||0;return{top:g.top-n.top,left:g.left-n.left}},offsetParent:function(){return this.map(function(){for(var a=
this.offsetParent||l.body;a&&!/^body|html$/i.test(a.nodeName)&&d.css(a,"position")==="static";)a=a.offsetParent;return a})}});d.each(["Left","Top"],function(a,b){var g="scroll"+b;d.fn[g]=function(n){var m=this[0],y;if(!m)return null;if(n!==undefined)return this.each(function(){if(y=D(this))y.scrollTo(!a?n:d(y).scrollLeft(),a?n:d(y).scrollTop());else this[g]=n});else return(y=D(m))?"pageXOffset"in y?y[a?"pageYOffset":"pageXOffset"]:d.support.boxModel&&y.document.documentElement[g]||y.document.body[g]:
m[g]}});d.each(["Height","Width"],function(a,b){var g=b.toLowerCase();d.fn["inner"+b]=function(){return this[0]?d.css(this[0],g,false,"padding"):null};d.fn["outer"+b]=function(n){return this[0]?d.css(this[0],g,false,n?"margin":"border"):null};d.fn[g]=function(n){var m=this[0];if(!m)return n==null?null:this;if(d.isFunction(n))return this.each(function(y){var z=d(this);z[g](n.call(this,y,z[g]()))});return"scrollTo"in m&&m.document?m.document.compatMode==="CSS1Compat"&&m.document.documentElement["client"+
b]||m.document.body["client"+b]:m.nodeType===9?Math.max(m.documentElement["client"+b],m.body["scroll"+b],m.documentElement["scroll"+b],m.body["offset"+b],m.documentElement["offset"+b]):n===undefined?d.css(m,g):this.css(g,typeof n==="string"?n:n+"px")}});u.$=u.jQuery=d});bespin.tiki.register("::embedded",{name:"embedded",dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"}});bespin.tiki.module("embedded:index",function(){});
bespin.tiki.register("::appconfig",{name:"appconfig",dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("appconfig:index",function(A,u){var w=A("jquery").$;A("underscore");var t=A("settings").settings,p=A("bespin:promise").group,k=A("bespin:promise").Promise,e=A("bespin:console").console,f=A("bespin:util/stacktrace").Trace,o=A("bespin:util/util"),h=true;u.launch=function(q){var r=new k;w("#_bespin_loading").remove();var B;if(h){B=bespin.tiki.require;h=false}else B=(new (bespin.tiki.require("bespin:sandbox").Sandbox)).createRequire({id:"index",ownerPackage:bespin.tiki.loader.anonymousPackage});
var D=B("bespin:plugins").catalog;q=q||{};u.normalizeConfig(D,q);var d=q.objects;for(var K in d)D.registerObject(K,d[K]);for(var L in q.settings)t.set(L,q.settings[L]);var l=function(){var C=B("environment").env,J=C.editor;if(J){q.lineNumber&&J.setLineNumber(q.lineNumber);if(q.stealFocus)J.focus=true;if(q.readOnly)J.readOnly=q.readOnly;if(q.syntax)J.syntax=q.syntax}if(J=D.getObject("commandLine"))C.commandLine=J;D.publish(this,"appLaunched");r.resolve(C)}.bind(this),v=new k;v.then(function(){d.loginController?
D.createObject("loginController").then(function(C){C.showLogin().then(function(J){q.objects.session.arguments.push(J);u.launchEditor(D,q).then(l,r.reject.bind(r))})}):u.launchEditor(D,q).then(l,r.reject.bind(r))},function(C){r.reject(C)});D.plugins.theme_manager?bespin.tiki.require.ensurePackage("::theme_manager",function(){var C=B("theme_manager");q.theme.basePlugin&&C.setBasePlugin(q.theme.basePlugin);q.theme.standard&&C.setStandardTheme(q.theme.standard);C.startParsing().then(function(){v.resolve()},
function(J){v.reject(J)})}):v.resolve();return r};u.normalizeConfig=function(q,r){if(r.objects===undefined)r.objects={};if(r.autoload===undefined)r.autoload=[];if(r.theme===undefined)r.theme={};if(!r.theme.basePlugin&&q.plugins.screen_theme)r.theme.basePlugin="screen_theme";if(!r.initialContent)r.initialContent="";if(!r.settings)r.settings={};if(!r.objects.notifier&&q.plugins.notifier)r.objects.notifier={};if(!r.objects.loginController&&q.plugins.userident)r.objects.loginController={};if(!r.objects.fileHistory&&
q.plugins.file_history)r.objects.fileHistory={factory:"file_history",arguments:["session"],objects:{"0":"session"}};if(!r.objects.server&&q.plugins.bespin_server){r.objects.server={factory:"bespin_server"};r.objects.filesource={factory:"bespin_filesource",arguments:["server"],objects:{"0":"server"}}}if(!r.objects.files&&q.plugins.filesystem&&r.objects.filesource)r.objects.files={arguments:["filesource"],objects:{"0":"filesource"}};if(!r.objects.editor)r.objects.editor={factory:"text_editor",arguments:[r.initialContent]};
if(!r.objects.session)r.objects.session={arguments:["editor"],objects:{"0":"editor"}};if(!r.objects.commandLine&&q.plugins.command_line)r.objects.commandLine={};if(!r.objects.toolbar&&q.plugins.toolbar)r.objects.toolbar={};if(r.gui===undefined)r.gui={};q={};for(var B in r.gui){var D=r.gui[B];if(D.component)q[D.component]=true}if(!r.gui.north&&r.objects.toolbar&&!q.toolbar)r.gui.north={component:"toolbar"};if(!r.gui.center&&r.objects.editor&&!q.editor)r.gui.center={component:"editor"};if(!r.gui.south&&
r.objects.commandLine&&!q.commandLine)r.gui.south={component:"commandLine"}};u.launchEditor=function(q,r){var B=new k;if(r===null){e.error("Cannot start editor without a configuration!");B.reject("Cannot start editor without a configuration!");return B}i(q,r).then(function(){j(q,r,B)},function(D){e.error("Error while creating objects");(new f(D)).log();B.reject(D)});return B};var i=function(q,r){var B=[];for(var D in r.objects)B.push(q.createObject(D));return p(B)},j=function(q,r,B){var D=document.createElement("div");
D.setAttribute("class","container");var d=document.createElement("div");d.setAttribute("class","center-container");var K=false,L=r.element||document.body;o.addClass(L,"bespin");L.appendChild(D);try{["north","west","center","east","south"].forEach(function(v){var C=r.gui[v];if(C){var J=q.getObject(C.component);if(!J)throw"Cannot find object "+C.component+" to attach to the Bespin UI";L=J.element;if(!L)throw"Component "+C.component+' does not have an "element" attribute to attach to the Bespin UI';
w(L).addClass(v);if(v=="west"||v=="east"||v=="center"){if(!K){D.appendChild(d);K=true}d.appendChild(L)}else D.appendChild(L)}});["north","west","east","south","center"].forEach(function(v){if(v=r.gui[v]){v=q.getObject(v.component);v.elementAppended!=null&&v.elementAppended()}});B.resolve()}catch(l){e.error(l);B.reject(l)}}});bespin.tiki.register("::screen_theme",{name:"screen_theme",dependencies:{theme_manager:"0.0.0"}});bespin.tiki.module("screen_theme:index",function(){});
(function(){var A=bespin.tiki.require("jquery").$;A(document).ready(function(){bespin.tiki.require("bespin:plugins").catalog.registerMetadata({text_editor:{resourceURL:"resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"},testmodules:["tests\\controllers\\testLayoutmanager",
"tests\\models\\testTextstorage","tests\\testScratchcanvas","tests\\utils\\testRect"],provides:[{action:"new",pointer:"views/editor#EditorView",ep:"factory",name:"text_editor"},{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",key:"ctrl_d",predicates:{isTextView:true},pointer:"commands/editing#deleteLines",
ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{description:"Join the current line with the following",key:"ctrl_shift_j",predicates:{isTextView:true},pointer:"commands/editing#joinLines",ep:"command",name:"joinline"},{params:[{defaultValue:"",type:"text",name:"text",description:"The text to insert"}],pointer:"commands/editing#insertText",
ep:"command",name:"insertText"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},pointer:"commands/editing#untab",ep:"command",key:"shift_tab",name:"untab"},{predicates:{isTextView:true},ep:"command",name:"move"},{description:"Repeat the last search (forward)",pointer:"commands/editor#findNextCommand",
ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},{predicates:{isTextView:true},pointer:"commands/movement#moveRight",ep:"command",key:"right",
name:"move right"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",
ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",
ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home","ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",
ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",
ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},
pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",
description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",
params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",
ep:"command",key:["ctrl_z"],name:"undo"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",
defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"},{defaultValue:{color:"#e5c138",paddingLeft:5,backgroundColor:"#4c4a41",paddingRight:10},ep:"themevariable",name:"gutter"},{defaultValue:{color:"#e6e6e6",selectedTextBackgroundColor:"#526da5",backgroundColor:"#2a211c",cursorColor:"#879aff",unfocusedCursorBackgroundColor:"#73171e",unfocusedCursorColor:"#ff0033"},ep:"themevariable",name:"editor"},{defaultValue:{comment:"#666666",directive:"#999999",keyword:"#42A8ED",
addition:"#FFFFFF",plain:"#e6e6e6",module:"#BA4946",specialmodule:"#C741BB",builtin:"#307BAD",deletion:"#FFFFFF",error:"#ff0000",operator:"#88BBFF",identifier:"#D841FF",string:"#039A0A"},ep:"themevariable",name:"highlighterFG"},{defaultValue:{addition:"#008000",deletion:"#800000"},ep:"themevariable",name:"highlighterBG"},{defaultValue:{nibStrokeStyle:"rgb(150, 150, 150)",fullAlpha:1,barFillStyle:"rgb(0, 0, 0)",particalAlpha:0.3,barFillGradientBottomStop:"rgb(44, 44, 44)",backgroundStyle:"#2A211C",
thickness:17,padding:5,trackStrokeStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",barFillGradientBottomStart:"rgb(22, 22, 22)",barFillGradientTopStop:"rgb(40, 40, 40)",barFillGradientTopStart:"rgb(90, 90, 90)",nibStyle:"rgb(100, 100, 100)",trackFillStyle:"rgba(50, 50, 50, 0.8)"},ep:"themevariable",name:"scroller"},{description:"Event: Notify when something within the editor changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever a change happened."}],
ep:"extensionpoint",name:"editorChange"},{description:"Decoration for the gutter",ep:"extensionpoint",name:"gutterDecoration"},{description:"Line number decoration for the gutter",pointer:"views/gutter#lineNumbers",ep:"gutterDecoration",name:"lineNumbers"}],type:"plugins\\supported",name:"text_editor"},cs_syntax:{resourceURL:"resources/cs_syntax/",name:"cs_syntax",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#CSSyntax",ep:"syntax",fileexts:["cs"],
name:"cs"}],type:"plugins\\thirdparty",description:"C# syntax highlighter"},less:{resourceURL:"resources/less/",description:"Leaner CSS",contributors:[],author:"Alexis Sellier <self@cloudhead.net>",url:"http://lesscss.org",version:"1.0.11",dependencies:{},testmodules:[],provides:[],keywords:["css","parser","lesscss","browser"],type:"plugins\\thirdparty",name:"less"},theme_manager_base:{resourceURL:"resources/theme_manager_base/",name:"theme_manager_base",share:true,environments:{main:true},dependencies:{},
testmodules:[],provides:[{description:"(Less)files holding the CSS style information for the UI.",params:[{required:true,name:"url",description:"Name of the ThemeStylesFile - can also be an array of files."}],ep:"extensionpoint",name:"themestyles"},{description:"Event: Notify when the theme(styles) changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever the theme is changed."}],ep:"extensionpoint",name:"themeChange"},{indexOn:"name",description:"A theme is a way change the look of the application.",
params:[{required:false,name:"url",description:"Name of a ThemeStylesFile that holds theme specific CSS rules - can also be an array of files."},{required:true,name:"pointer",description:"Function that returns the ThemeData"}],ep:"extensionpoint",name:"theme"}],type:"plugins\\supported",description:"Defines extension points required for theming"},keyboard:{resourceURL:"resources/keyboard/",description:"Keyboard shortcuts",dependencies:{canon:"0.0",settings:"0.0"},testmodules:["tests\\testKeyboard"],
provides:[{description:"A keymapping defines how keystrokes are interpreted.",params:[{required:true,name:"states",description:"Holds the states and all the informations about the keymapping. See docs: pluginguide/keymapping"}],ep:"extensionpoint",name:"keymapping"}],type:"plugins\\supported",name:"keyboard"},edit_session:{resourceURL:"resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{events:"0.0.0"},testmodules:["tests\\testSession"],
provides:[{action:"call",pointer:"#createSession",ep:"factory",name:"session"}],type:"plugins\\supported",name:"edit_session"},completion:{resourceURL:"resources/completion/",description:"Code completion support",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"Code completion support for specific languages",ep:"extensionpoint",name:"completion"},{description:"Accept the chosen completion",key:["return",
"tab"],predicates:{completing:true},pointer:"controller#completeCommand",ep:"command",name:"complete"},{description:"Abandon the completion",key:"escape",predicates:{completing:true},pointer:"controller#completeCancelCommand",ep:"command",name:"complete cancel"},{description:"Choose the completion below",key:"down",predicates:{completing:true},pointer:"controller#completeDownCommand",ep:"command",name:"complete down"},{description:"Choose the completion above",key:"up",predicates:{completing:true},
pointer:"controller#completeUpCommand",ep:"command",name:"complete up"}],type:"plugins\\supported",name:"completion"},undomanager:{resourceURL:"resources/undomanager/",description:"Manages undoable events",testmodules:["tests\\testUndomanager"],provides:[{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins\\supported",name:"undomanager"},rangeutils:{testmodules:["tests\\test"],type:"plugins\\supported",
resourceURL:"resources/rangeutils/",description:"Utility functions for dealing with ranges of text",name:"rangeutils"},stylesheet:{resourceURL:"resources/stylesheet/",name:"stylesheet",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#CSSSyntax",ep:"syntax",fileexts:["css","less"],name:"css"}],type:"plugins\\supported",description:"CSS syntax highlighter"},js_syntax:{resourceURL:"resources/js_syntax/",name:"js_syntax",environments:{worker:true},
dependencies:{standard_syntax:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{settings:["specialmodules"],pointer:"#JSSyntax",ep:"syntax",fileexts:["js","json"],name:"js"},{description:"Regex that matches special modules",defaultValue:"^jetpack\\.[^\"']+",type:"text",ep:"setting",name:"specialmodules"}],type:"plugins\\supported",description:"JavaScript syntax highlighter"},ctags:{resourceURL:"resources/ctags/",description:"Reads and writes tag files",dependencies:{traits:"0.0.0",underscore:"0.0.0"},
testmodules:[],type:"plugins\\supported",name:"ctags"},theme_manager:{resourceURL:"resources/theme_manager/",name:"theme_manager",share:true,environments:{main:true,worker:false},dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"},testmodules:[],provides:[{unregister:"themestyles#unregisterThemeStyles",register:"themestyles#registerThemeStyles",ep:"extensionhandler",name:"themestyles"},{unregister:"index#unregisterTheme",register:"index#registerTheme",ep:"extensionhandler",
name:"theme"},{defaultValue:"standard",description:"The theme plugin's name to use. If set to 'standard' no theme will be used",type:"text",ep:"setting",name:"theme"},{pointer:"#appLaunched",ep:"appLaunched"}],type:"plugins\\supported",description:"Handles colors in Bespin"},whitetheme:{resourceURL:"resources/whitetheme/",description:"Provides a white theme for Bespin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],description:"A basic white theme",pointer:"index#whiteTheme",
ep:"theme",name:"white"}],type:"plugins\\supported",name:"whitetheme"},standard_syntax:{resourceURL:"resources/standard_syntax/",description:"Easy-to-use basis for syntax engines",environments:{worker:true},dependencies:{syntax_worker:"0.0.0",syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins\\supported",name:"standard_syntax"},jquery:{testmodules:[],resourceURL:"resources/jquery/",name:"jquery",type:"plugins\\thirdparty"},embedded:{testmodules:[],dependencies:{theme_manager:"0.0.0",
text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"},resourceURL:"resources/embedded/",name:"embedded",type:"plugins\\supported"},sql_syntax:{resourceURL:"resources/sql_syntax/",name:"sql_syntax",environments:{worker:true},dependencies:{syntax_manager:"0.0.0"},testmodules:[],provides:[{pointer:"#SQLSyntax",ep:"syntax",fileexts:["sql"],name:"sql"}],type:"plugins\\thirdparty",description:"Python syntax highlighter"},appconfig:{resourceURL:"resources/appconfig/",description:"Instantiates components and displays the GUI based on configuration.",
dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{description:"Event: Fired when the app is completely launched.",ep:"extensionpoint",name:"appLaunched"}],type:"plugins\\supported",name:"appconfig"},syntax_worker:{resourceURL:"resources/syntax_worker/",description:"Coordinates multiple syntax engines",environments:{worker:true},dependencies:{syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins\\supported",name:"syntax_worker"},
c1_html:{resourceURL:"resources/c1_html/",name:"c1_html",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#HTMLSyntax",ep:"syntax",fileexts:["htm","html"],name:"html"}],type:"plugins\\supported",description:"C1 HTML syntax highlighter"},screen_theme:{resourceURL:"resources/screen_theme/",description:"Bespins standard theme basePlugin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],ep:"themestyles"},{defaultValue:"@global_font",
ep:"themevariable",name:"container_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"container_font_size"},{defaultValue:"@global_container_background",ep:"themevariable",name:"container_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"container_color"},{defaultValue:"@global_line_height",ep:"themevariable",name:"container_line_height"},{defaultValue:"@global_pane_background",ep:"themevariable",name:"pane_bg"},{defaultValue:"@global_pane_border_radius",ep:"themevariable",
name:"pane_border_radius"},{defaultValue:"@global_form_font",ep:"themevariable",name:"form_font"},{defaultValue:"@global_form_font_size",ep:"themevariable",name:"form_font_size"},{defaultValue:"@global_form_line_height",ep:"themevariable",name:"form_line_height"},{defaultValue:"@global_form_color",ep:"themevariable",name:"form_color"},{defaultValue:"@global_form_text_shadow",ep:"themevariable",name:"form_text_shadow"},{defaultValue:"@global_pane_link_color",ep:"themevariable",name:"pane_a_color"},
{defaultValue:"@global_font",ep:"themevariable",name:"pane_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"pane_font_size"},{defaultValue:"@global_pane_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_pane_h1_font",ep:"themevariable",name:"pane_h1_font"},{defaultValue:"@global_pane_h1_font_size",ep:"themevariable",name:"pane_h1_font_size"},{defaultValue:"@global_pane_h1_color",ep:"themevariable",name:"pane_h1_color"},{defaultValue:"@global_font_size * 1.8",
ep:"themevariable",name:"pane_line_height"},{defaultValue:"@global_pane_color",ep:"themevariable",name:"pane_color"},{defaultValue:"@global_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_font",ep:"themevariable",name:"button_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"button_font_size"},{defaultValue:"@global_button_color",ep:"themevariable",name:"button_color"},{defaultValue:"@global_button_background",ep:"themevariable",name:"button_bg"},{defaultValue:"@button_bg - #063A27",
ep:"themevariable",name:"button_bg2"},{defaultValue:"@button_bg - #194A5E",ep:"themevariable",name:"button_border"},{defaultValue:"@global_control_background",ep:"themevariable",name:"control_bg"},{defaultValue:"@global_control_color",ep:"themevariable",name:"control_color"},{defaultValue:"@global_control_border",ep:"themevariable",name:"control_border"},{defaultValue:"@global_control_border_radius",ep:"themevariable",name:"control_border_radius"},{defaultValue:"@global_control_active_background",
ep:"themevariable",name:"control_active_bg"},{defaultValue:"@global_control_active_border",ep:"themevariable",name:"control_active_border"},{defaultValue:"@global_control_active_color",ep:"themevariable",name:"control_active_color"},{defaultValue:"@global_control_active_inset_color",ep:"themevariable",name:"control_active_inset_color"}],type:"plugins\\supported",name:"screen_theme"}})})})();
(function(){var A=bespin.tiki.require("bespin:promise").Promise,u=bespin.tiki.require("bespin:promise").group,w=bespin.tiki.require("jquery").$;bespin.loaded=new A;bespin.initialized=new A;var t=function(p,k,e){p=p.style[e]||document.defaultView.getComputedStyle(p,"").getPropertyValue(e);if(!p||p=="auto"||p=="intrinsic")p=k.style[e];return p};bespin.useBespin=function(p,k){var e=bespin.tiki.require("bespin:util/util"),f={},o=f.settings;k=k||{};for(var h in k)f[h]=k[h];k=f.settings;if(o!==undefined)for(h in o)if(k[h]===
undefined)f.settings[h]=o[h];var i=null,j=new A;bespin.tiki.require.ensurePackage("::appconfig",function(){var q=bespin.tiki.require("appconfig");if(e.isString(p))p=document.getElementById(p);if(e.none(f.initialContent))f.initialContent=p.value||p.innerHTML;p.innerHTML="";if(p.type=="textarea"){var r=p.parentNode,B=document.createElement("div"),D=function(){var K="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(v){K+=v+":"+t(p,B,v)+";"});var L=t(p,
B,"width"),l=t(p,B,"height");K+="height:"+l+";width:"+L+";";K+="display:inline-block;";B.setAttribute("style",K)};window.addEventListener("resize",D,false);D();for(p.nextSibling?r.insertBefore(B,p.nextSibling):r.appendChild(B);r!==document;){if(r.tagName.toUpperCase()==="FORM"){var d=r.onsubmit;r.onsubmit=function(K){p.value=i.editor.value;p.innerHTML=i.editor.value;d&&d.call(this,K)};break}r=r.parentNode}p.style.display="none";f.element=B;if(!e.none(p.getAttribute("readonly")))f.readOnly=true}else f.element=
p;q.launch(f).then(function(K){i=K;j.resolve(K)})});return j};w(document).ready(function(){bespin.loaded.resolve();for(var p=[],k=document.querySelectorAll(".bespin"),e=0;e<k.length;e++){var f=k[e],o=f.getAttribute("data-bespinoptions")||"{}";o=bespin.useBespin(f,JSON.parse(o));o.then(function(h){f.bespin=h},function(h){throw new Error("Launch failed: "+h);});p.push(o)}u(p).then(function(){bespin.initialized.resolve();window.onBespinLoad&&window.onBespinLoad()},function(h){bespin.initialized.reject("At least one Bespin failed to launch!"+
h)})})})();
